var rf=Object.defineProperty;var sf=(r,e,t)=>e in r?rf(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var T=(r,e,t)=>(sf(r,typeof e!="symbol"?e+"":e,t),t),ra=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var mt=(r,e,t)=>(ra(r,e,"read from private field"),t?t.call(r):e.get(r)),Fr=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},rr=(r,e,t,s)=>(ra(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t);var sa=(r,e,t)=>(ra(r,e,"access private method"),t);import{s as nf,e as wc,i as af,d as of,r as yc,u as ze,v as cf,w as lf,x as df,y as uf}from"../chunks/scheduler.7420d6ca.js";import{h as hf,u as pf}from"../chunks/await_block.08f6cb26.js";import{S as ff,i as mf,a as Dd,t as Ed}from"../chunks/index.637134e4.js";import{g as kd}from"../chunks/navigation.d17f622b.js";import{e as Od}from"../chunks/singletons.084b249e.js";import{g as Qs,c as v}from"../chunks/_commonjsHelpers.725317a4.js";import{P as gf,a as _f,m as Ur}from"../chunks/util.d5ec8d73.js";import{s as En}from"../chunks/context.92045884.js";import{D as wf}from"../chunks/util.883c3f21.js";import{s as yf,a as bf,c as vf,v as Sf}from"../chunks/context.645f4abc.js";import{r as Rf}from"../chunks/i18n.6566f26d.js";import{w as na}from"../chunks/index.5b89e149.js";import{d as Tf,u as Zs}from"../chunks/index.esm.4b6e8736.js";function Cf(r,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in r)){const i=Object.getOwnPropertyDescriptor(s,n);i&&Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}const Df=!0,Ef=!1,VR=Object.freeze(Object.defineProperty({__proto__:null,prerender:Df,ssr:Ef},Symbol.toStringTag,{value:"Module"}));class kf{constructor(e){T(this,"cache",{channels:new Map,emojis:new Map,members:new Map,servers:new Map,users:new Map});T(this,"token");e&&(this.token=e)}async req(e,t,s){const n=await fetch(`https://api.revolt.chat${t}`,{method:e,body:s,headers:this.token==null?this.token:{"x-session-token":this.token}});return n.status==401&&(localStorage.removeItem("session"),await kd(`${Od}/login`)),n}async login(e){return this.req("POST","/auth/session/login",JSON.stringify(e)).then(t=>t.json())}async logout(){await this.req("POST","/auth/session/logout")}async revokeSession(e){await this.req("DELETE",`/auth/session/${e}`)}async revokeAllSessions(e){await this.req("DELETE",`/auth/session/all?revoke_self=${e}`)}async createServer(e){return this.req("POST","/servers/create",JSON.stringify(e)).then(t=>t.json())}async changeUsername(e,t){return this.req("PATCH","/users/@me/username",JSON.stringify({username:e,password:t})).then(s=>s.json())}async openDM(e){return this.req("GET",`/users/${e}/dm`).then(t=>t.json())}async joinCall(e){return this.req("POST",`/channels/${e}/join_call`).then(t=>t.json()).then(({token:t})=>t)}async acceptFriend(e){return this.req("PUT",`/channels/${e}/friend`).then(t=>t.json())}async removeFriend(e){return this.req("DELETE",`/users/${e}/friend`).then(t=>t.json())}async editServer(e,t){return this.req("PATCH",`/servers/${e}`,JSON.stringify(t)).then(s=>s.json())}async fetchChannel(e){const t=this.cache.channels.get(e);if(t==null){const s=await this.req("GET",`/channels/${e}`).then(n=>n.json());return this.cache.channels.set(s._id,s),s}return t}async fetchDirectMessages(){return this.req("GET","/users/dms").then(e=>e.json())}async ackMessage(e,t){await this.req("PUT",`/channels/${e}/ack/${t}`)}async fetchSettings(e){return this.req("POST","/sync/settings/fetch",JSON.stringify({keys:e})).then(t=>t.json())}async fetchUnreads(){return this.req("GET","/sync/unreads").then(e=>e.json())}async setSettings(e,t=Date.now()){for(const[s,n]of Object.entries(e))e[s]=typeof n=="string"?n:JSON.stringify(n);await this.req("POST",`/sync/settings/set?timestamp=${t}`,JSON.stringify(e))}async fetchMembers(e,t=!1){return await this.req("GET",`/servers/${e}/members?exclude_offline=${t}`).then(s=>s.json())}async fetchMessage(e,t){return this.req("GET",`/channels/${e}/messages/${t}`).then(s=>s.json())}async queryMessages(e,t){const s="?"+new URLSearchParams(Object.entries(t).flatMap(([n,i])=>i==null?[]:[[n,i.toString()]]));return this.req("GET",`/channels/${e}/messages${s}`).then(n=>n.json())}async sendMessage(e,t){return this.req("POST",`/channels/${e}/messages`,JSON.stringify(t)).then(s=>s.json())}async editMessage(e,t,s){return this.req("PATCH",`/channels/${e}/messages/${t}`,JSON.stringify(s)).then(n=>n.json())}async deleteMessage(e,t){await this.req("DELETE",`/channels/${e}/messages/${t}`)}async fetchServer(e){const t=this.cache.servers.get(e);if(t==null){const s=await this.req("GET",`/servers/${e}`).then(n=>n.json());return this.cache.servers.set(s._id,s),s}return t}async fetchSessions(){return this.req("GET","/auth/session/all").then(e=>e.json())}async fetchUser(e){const t=this.cache.users.get(e);if(t==null){const s=await this.req("GET",`/users/${e}`).then(n=>n.json());return this.cache.users.set(s._id,s),s}return t}async fetchUserProfile(e){return this.req("GET",`/users/${e}/profile`).then(t=>t.json())}}class Of{async uploadFile(e,t="attachments"){const s=new FormData;s.append("file",e);const{id:n}=await fetch(`https://autumn.revolt.chat/${t}`,{method:"POST",body:s}).then(i=>i.json());return n}}var xd={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function i(c,u,l,d,h){if(typeof l!="function")throw new TypeError("The listener must be a function");var p=new n(l,d||c,h),f=t?t+u:u;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],p]:c._events[f].push(p):(c._events[f]=p,c._eventsCount++),c}function a(c,u){--c._eventsCount===0?c._events=new s:delete c._events[u]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],l,d;if(this._eventsCount===0)return u;for(d in l=this._events)e.call(l,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(u){var l=t?t+u:u,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,p=d.length,f=new Array(p);h<p;h++)f[h]=d[h].fn;return f},o.prototype.listenerCount=function(u){var l=t?t+u:u,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,l,d,h,p,f){var _=t?t+u:u;if(!this._events[_])return!1;var g=this._events[_],k=arguments.length,P,D;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),k){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,l),!0;case 3:return g.fn.call(g.context,l,d),!0;case 4:return g.fn.call(g.context,l,d,h),!0;case 5:return g.fn.call(g.context,l,d,h,p),!0;case 6:return g.fn.call(g.context,l,d,h,p,f),!0}for(D=1,P=new Array(k-1);D<k;D++)P[D-1]=arguments[D];g.fn.apply(g.context,P)}else{var C=g.length,y;for(D=0;D<C;D++)switch(g[D].once&&this.removeListener(u,g[D].fn,void 0,!0),k){case 1:g[D].fn.call(g[D].context);break;case 2:g[D].fn.call(g[D].context,l);break;case 3:g[D].fn.call(g[D].context,l,d);break;case 4:g[D].fn.call(g[D].context,l,d,h);break;default:if(!P)for(y=1,P=new Array(k-1);y<k;y++)P[y-1]=arguments[y];g[D].fn.apply(g[D].context,P)}}return!0},o.prototype.on=function(u,l,d){return i(this,u,l,d,!1)},o.prototype.once=function(u,l,d){return i(this,u,l,d,!0)},o.prototype.removeListener=function(u,l,d,h){var p=t?t+u:u;if(!this._events[p])return this;if(!l)return a(this,p),this;var f=this._events[p];if(f.fn)f.fn===l&&(!h||f.once)&&(!d||f.context===d)&&a(this,p);else{for(var _=0,g=[],k=f.length;_<k;_++)(f[_].fn!==l||h&&!f[_].once||d&&f[_].context!==d)&&g.push(f[_]);g.length?this._events[p]=g.length===1?g[0]:g:a(this,p)}return this},o.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&a(this,l)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o})(xd);var xf=xd.exports;const Xs=Qs(xf);var at,Js,Ks,Er,Td;let Pf=(Td=class extends Xs{constructor(){super();Fr(this,at,void 0);Fr(this,Js,void 0);Fr(this,Ks,void 0);Fr(this,Er,"idle")}get connectionState(){return mt(this,Er)}authenticate(t){rr(this,at,new WebSocket(`wss://ws.revolt.chat?token=${t}`)),rr(this,Er,"connecting"),mt(this,at).onopen=()=>{rr(this,Js,setInterval(()=>{this.send({type:"Ping",data:Date.now()}),rr(this,Ks,setTimeout(()=>this.disconnect(),gf*1e3))},_f*1e3))},mt(this,at).onmessage=s=>this.handleMessage(JSON.parse(s.data.toString())),mt(this,at).onclose=()=>this.disconnect()}handleMessage(t){switch(t.type){case"Ping":this.send({type:"Pong",data:t.data});return;case"Pong":clearTimeout(mt(this,Ks));return;case"Error":this.emit("error",t),this.disconnect();return}switch(this.connectionState){case"connecting":if(t.type=="Ready")this.emit("serverEvent",t),rr(this,Er,"connected");else if(t.type!="Authenticated")throw new Error(`Received ${t.type} event from server in connecting state.`);break;case"connected":if(t.type=="Authenticated"||t.type=="Ready")throw new Error(`Received ${t.type} in connecting state.`);this.emit("serverEvent",t);break;default:throw new Error(`Received ${t.type} in ${this.connectionState} state.`)}}send(t){if(!mt(this,at))throw new Error("Tried to send WS message when the connection was disconnected.");mt(this,at).send(JSON.stringify(t))}disconnect(){if(!mt(this,at))return;clearInterval(mt(this,Js));const t=mt(this,at);rr(this,at,void 0),t.close(),rr(this,Er,"disconnected")}},at=new WeakMap,Js=new WeakMap,Ks=new WeakMap,Er=new WeakMap,Td);var Ys,Ka,Cd;let Mf=(Cd=class extends Xs{constructor(){super(...arguments);Fr(this,Ys);T(this,"api",new kf);T(this,"websocket",new Pf);T(this,"autumn",new Of);T(this,"unreads",new Map);T(this,"user")}get ready(){return this.api.cache!=null}authenticate(t){this.api.token=t,this.websocket.authenticate(t),this.api.fetchUser("@me").then(s=>this.user=s),this.api.fetchUnreads().then(s=>this.unreads=Ur(s,n=>n.channel)),this.websocket.on("serverEvent",s=>sa(this,Ys,Ka).call(this,s))}async destroy(){await this.api.logout(),this.websocket.disconnect(),this.api.token=void 0,this.user=void 0,this.unreads=new Map,this.api.cache={channels:new Map,emojis:new Map,members:new Map,servers:new Map,users:new Map}}},Ys=new WeakSet,Ka=function(t){switch(t.type){case"Bulk":{for(const s of t.v)sa(this,Ys,Ka).call(this,s);break}case"Ready":{this.api.cache.users=Ur(t.users),this.api.cache.channels=Ur(t.channels),this.api.cache.servers=Ur(t.servers),this.api.cache.members=Ur(t.members),this.api.cache.emojis=Ur(t.emojis),this.emit("Ready",t);break}case"ChannelCreate":{this.api.cache.channels.set(t._id,t),this.emit("ChannelCreate",t);break}case"ChannelDelete":{this.api.cache.channels.delete(t.id)&&this.emit("ChannelDelete",t);break}case"ChannelUpdate":{const s=this.api.cache.channels.get(t.id);if(s==null)return;if(t.clear!=null)for(const n of t.clear){if(s.channel_type!="Group"&&s.channel_type!="TextChannel"&&s.channel_type!="VoiceChannel")break;switch(n){case"Description":s.description=void 0;break;case"Icon":s.icon=void 0;break;case"DefaultPermissions":s.channel_type!="Group"&&(s.default_permissions=void 0);break}}for(const[n,i]of Object.entries(t.data))s[n]=i;this.api.cache.channels.set(t.id,s),this.emit("ChannelUpdate",t);break}case"ServerCreate":{for(const s of t.channels)this.api.cache.channels.set(s._id,s);this.api.cache.servers.set(t.id,t.server),this.emit("ServerCreate",t);break}case"ServerDelete":{const s=this.api.cache.servers.get(t.id);if(s==null)return;for(const n of s.channels)this.api.cache.channels.delete(n);this.api.cache.servers.delete(s._id),this.emit("ServerDelete",t);break}case"ServerUpdate":{const s=this.api.cache.servers.get(t.id);if(s==null)return;if(t.clear!=null)for(const n of t.clear)switch(n){case"Description":s.description=void 0;break;case"Icon":s.icon=void 0;break;case"Categories":s.categories=void 0;break;case"SystemMessages":s.system_messages=void 0;break;case"Banner":s.banner=void 0;break}for(const[n,i]of Object.entries(t.data))s[n]=i;this.api.cache.servers.set(t.id,s),this.emit("ServerUpdate",t);break}case"ChannelGroupJoin":{const s=this.api.cache.channels.get(t.id);if(s==null||s.channel_type!="Group")return;s.recipients.push(t.user),this.api.cache.channels.set(t.id,s),this.emit("ChannelGroupJoin",t);break}case"ChannelGroupLeave":{const s=this.api.cache.channels.get(t.id);if(s==null||s.channel_type!="Group")return;s.recipients=s.recipients.filter(n=>n!=t.user),this.api.cache.channels.set(t.id,s),this.emit("ChannelGroupLeave",t);break}case"ServerMemberUpdate":{const s=this.api.cache.members.get(t.id);if(s==null)return;if(t.clear!=null)for(const n of t.clear)switch(n){case"Nickname":s.nickname=void 0;break;case"Avatar":s.avatar=void 0;break;case"Roles":s.roles=void 0;break;case"Timeout":s.timeout=void 0}for(const[n,i]of Object.entries(t.data))s[n]=i;this.api.cache.members.set(s._id,s),this.emit("ServerMemberUpdate",t);break}case"ServerRoleUpdate":{const s=this.api.cache.servers.get(t.id);if(s==null||s.roles==null)return;for(const[n,i]of Object.entries(t.data))s.roles[n]=i;this.api.cache.servers.set(t.id,s);break}case"ServerRoleDelete":{const s=this.api.cache.servers.get(t.id);if(s==null||s.roles==null)return;s.roles=Object.fromEntries(Object.entries(s.roles).filter(([n])=>n!=t.role_id)),this.api.cache.servers.set(t.id,s),this.emit("ServerRoleDelete",t);break}case"UserUpdate":{const s=this.api.cache.users.get(t.id);if(s==null)return;if(t.clear!=null)for(const n of t.clear)switch(n){case"Avatar":{s.avatar=void 0;break}case"StatusText":{s.status!=null&&(s.status.text=void 0);break}case"StatusPresence":{s.status!=null&&(s.status.presence=void 0);break}case"ProfileContent":{s.profile!=null&&(s.profile.content=void 0);break}case"ProfileBackground":{s.profile!=null&&(s.profile.background=void 0);break}case"DisplayName":{s.display_name=void 0;break}}for(const[n,i]of Object.entries(t.data))s[n]=i;this.api.cache.users.set(t.id,s),this.emit("UserUpdate",t);break}case"UserRelationship":{this.api.cache.users.set(t.user._id,t.user),this.emit("UserRelationship",t);break}case"UserPresence":{const s=this.api.cache.users.get(t.id);if(s==null)return;s.online=t.online,this.api.cache.users.set(t.id,s),this.emit("UserPresence",t);break}case"UserPlatformWipe":{const s=this.api.cache.users.get(t.user_id);if(s==null)return;s.flags=t.flags,this.api.cache.users.set(t.user_id,s),this.emit("UserPlatformWipe",t);break}case"EmojiCreate":{this.api.cache.emojis.set(t._id,t),this.emit("EmojiCreate",t);break}case"EmojiDelete":{this.api.cache.emojis.delete(t.id)&&this.emit("EmojiDelete",t);break}case"Auth":case"UserSettingsUpdate":case"ServerMemberJoin":case"ServerMemberLeave":case"Message":case"MessageUpdate":case"MessageAppend":case"MessageDelete":case"MessageReact":case"MessageUnreact":case"MessageRemoveReaction":case"BulkMessageDelete":case"ChannelStartTyping":case"ChannelStopTyping":case"ChannelAck":this.emit(t.type,t);break}},Cd);var ui={},Ya={exports:{}},ia,bc;function If(){if(bc)return ia;bc=1;var r=1e3,e=r*60,t=e*60,s=t*24,n=s*7,i=s*365.25;ia=function(l,d){d=d||{};var h=typeof l;if(h==="string"&&l.length>0)return a(l);if(h==="number"&&isFinite(l))return d.long?c(l):o(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function a(l){if(l=String(l),!(l.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(d){var h=parseFloat(d[1]),p=(d[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*i;case"weeks":case"week":case"w":return h*n;case"days":case"day":case"d":return h*s;case"hours":case"hour":case"hrs":case"hr":case"h":return h*t;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function o(l){var d=Math.abs(l);return d>=s?Math.round(l/s)+"d":d>=t?Math.round(l/t)+"h":d>=e?Math.round(l/e)+"m":d>=r?Math.round(l/r)+"s":l+"ms"}function c(l){var d=Math.abs(l);return d>=s?u(l,d,s,"day"):d>=t?u(l,d,t,"hour"):d>=e?u(l,d,e,"minute"):d>=r?u(l,d,r,"second"):l+" ms"}function u(l,d,h,p){var f=d>=h*1.5;return Math.round(l/h)+" "+p+(f?"s":"")}return ia}function Lf(r){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=n,t.enabled=a,t.humanize=If(),t.destroy=u,Object.keys(r).forEach(l=>{t[l]=r[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let d=0;for(let h=0;h<l.length;h++)d=(d<<5)-d+l.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(l){let d,h=null,p,f;function _(...g){if(!_.enabled)return;const k=_,P=Number(new Date),D=P-(d||P);k.diff=D,k.prev=d,k.curr=P,d=P,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let C=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(R,Y)=>{if(R==="%%")return"%";C++;const de=t.formatters[Y];if(typeof de=="function"){const Me=g[C];R=de.call(k,Me),g.splice(C,1),C--}return R}),t.formatArgs.call(k,g),(k.log||t.log).apply(k,g)}return _.namespace=l,_.useColors=t.useColors(),_.color=t.selectColor(l),_.extend=s,_.destroy=t.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==t.namespaces&&(p=t.namespaces,f=t.enabled(l)),f),set:g=>{h=g}}),typeof t.init=="function"&&t.init(_),_}function s(l,d){const h=t(this.namespace+(typeof d>"u"?":":d)+l);return h.log=this.log,h}function n(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let d;const h=(typeof l=="string"?l:"").split(/[\s,]+/),p=h.length;for(d=0;d<p;d++)h[d]&&(l=h[d].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function i(){const l=[...t.names.map(o),...t.skips.map(o).map(d=>"-"+d)].join(",");return t.enable(""),l}function a(l){if(l[l.length-1]==="*")return!0;let d,h;for(d=0,h=t.skips.length;d<h;d++)if(t.skips[d].test(l))return!1;for(d=0,h=t.names.length;d<h;d++)if(t.names[d].test(l))return!0;return!1}function o(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Nf=Lf;(function(r,e){e.formatArgs=s,e.save=n,e.load=i,e.useColors=t,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let l=0,d=0;c[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(l++,h==="%c"&&(d=l))}),c.splice(d,0,u)}e.log=console.debug||console.log||(()=>{});function n(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function i(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c={}.DEBUG),c}function a(){try{return localStorage}catch{}}r.exports=Nf(e);const{formatters:o}=r.exports;o.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Ya,Ya.exports);var hi=Ya.exports,Or={},Qa={exports:{}};(function(r,e){(function(t,s){var n="1.0.36",i="",a="?",o="function",c="undefined",u="object",l="string",d="major",h="model",p="name",f="type",_="vendor",g="version",k="architecture",P="console",D="mobile",C="tablet",y="smarttv",R="wearable",Y="embedded",de=350,Me="Amazon",_e="Apple",pe="ASUS",ue="BlackBerry",tt="Browser",Ge="Chrome",Cs="Edge",Xt="Firefox",Bt="Google",U="Huawei",I="LG",fe="Microsoft",Le="Motorola",Dt="Opera",H="Samsung",pt="Sharp",er="Sony",rt="Xiaomi",Lr="Zebra",tr="Facebook",Ds="Chromium OS",Nr="Mac OS",bn=function(V,ie){var q={};for(var ae in V)ie[ae]&&ie[ae].length%2===0?q[ae]=ie[ae].concat(V[ae]):q[ae]=V[ae];return q},mr=function(V){for(var ie={},q=0;q<V.length;q++)ie[V[q].toUpperCase()]=V[q];return ie},Es=function(V,ie){return typeof V===l?gr(ie).indexOf(gr(V))!==-1:!1},gr=function(V){return V.toLowerCase()},zi=function(V){return typeof V===l?V.replace(/[^\d\.]/g,i).split(".")[0]:s},ks=function(V,ie){if(typeof V===l)return V=V.replace(/^\s\s*/,i),typeof ie===c?V:V.substring(0,de)},_r=function(V,ie){for(var q=0,ae,ft,Ze,X,$,We;q<ie.length&&!$;){var xs=ie[q],vn=ie[q+1];for(ae=ft=0;ae<xs.length&&!$&&xs[ae];)if($=xs[ae++].exec(V),$)for(Ze=0;Ze<vn.length;Ze++)We=$[++ft],X=vn[Ze],typeof X===u&&X.length>0?X.length===2?typeof X[1]==o?this[X[0]]=X[1].call(this,We):this[X[0]]=X[1]:X.length===3?typeof X[1]===o&&!(X[1].exec&&X[1].test)?this[X[0]]=We?X[1].call(this,We,X[2]):s:this[X[0]]=We?We.replace(X[1],X[2]):s:X.length===4&&(this[X[0]]=We?X[3].call(this,We.replace(X[1],X[2])):s):this[X]=We||s;q+=2}},Os=function(V,ie){for(var q in ie)if(typeof ie[q]===u&&ie[q].length>0){for(var ae=0;ae<ie[q].length;ae++)if(Es(ie[q][ae],V))return q===a?s:q}else if(Es(ie[q],V))return q===a?s:q;return V},Vi={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},wr={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ar={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,g],[/opios[\/ ]+([\w\.]+)/i],[g,[p,Dt+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[p,Dt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[p,"UC"+tt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[g,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+tt],g],[/\bfocus\/([\w\.]+)/i],[g,[p,Xt+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[p,Dt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[p,Dt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[p,"MIUI "+tt]],[/fxios\/([-\w\.]+)/i],[g,[p,Xt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+tt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+tt],g],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,tr],g],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[p,Ge+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,Ge+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[p,"Android "+tt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[g,Os,Vi]],[/(webkit|khtml)\/([\w\.]+)/i],[p,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[p,Xt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,g],[/(cobalt)\/([\w\.]+)/i],[p,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[k,"amd64"]],[/(ia32(?=;))/i],[[k,gr]],[/((?:i[346]|x)86)[;\)]/i],[[k,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[k,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[k,"armhf"]],[/windows (ce|mobile); ppc;/i],[[k,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[k,/ower/,i,gr]],[/(sun4\w)[;\)]/i],[[k,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[k,gr]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[_,H],[f,C]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[_,H],[f,D]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[_,_e],[f,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[_,_e],[f,C]],[/(macintosh);/i],[h,[_,_e]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[_,pt],[f,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[_,U],[f,C]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[_,U],[f,D]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[_,rt],[f,D]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[_,rt],[f,C]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[_,"OPPO"],[f,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[_,"Vivo"],[f,D]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[_,"Realme"],[f,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[_,Le],[f,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[_,Le],[f,C]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[_,I],[f,C]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[_,I],[f,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[_,"Lenovo"],[f,C]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[_,"Nokia"],[f,D]],[/(pixel c)\b/i],[h,[_,Bt],[f,C]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[_,Bt],[f,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[_,er],[f,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[_,er],[f,C]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[_,"OnePlus"],[f,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[_,Me],[f,C]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[_,Me],[f,D]],[/(playbook);[-\w\),; ]+(rim)/i],[h,_,[f,C]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[_,ue],[f,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[_,pe],[f,C]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[_,pe],[f,D]],[/(nexus 9)/i],[h,[_,"HTC"],[f,C]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[h,/_/g," "],[f,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[_,"Acer"],[f,C]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[_,"Meizu"],[f,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,h,[f,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,h,[f,C]],[/(surface duo)/i],[h,[_,fe],[f,C]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[_,"Fairphone"],[f,D]],[/(u304aa)/i],[h,[_,"AT&T"],[f,D]],[/\bsie-(\w*)/i],[h,[_,"Siemens"],[f,D]],[/\b(rct\w+) b/i],[h,[_,"RCA"],[f,C]],[/\b(venue[\d ]{2,7}) b/i],[h,[_,"Dell"],[f,C]],[/\b(q(?:mv|ta)\w+) b/i],[h,[_,"Verizon"],[f,C]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[_,"Barnes & Noble"],[f,C]],[/\b(tm\d{3}\w+) b/i],[h,[_,"NuVision"],[f,C]],[/\b(k88) b/i],[h,[_,"ZTE"],[f,C]],[/\b(nx\d{3}j) b/i],[h,[_,"ZTE"],[f,D]],[/\b(gen\d{3}) b.+49h/i],[h,[_,"Swiss"],[f,D]],[/\b(zur\d{3}) b/i],[h,[_,"Swiss"],[f,C]],[/\b((zeki)?tb.*\b) b/i],[h,[_,"Zeki"],[f,C]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],h,[f,C]],[/\b(ns-?\w{0,9}) b/i],[h,[_,"Insignia"],[f,C]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[_,"NextBook"],[f,C]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],h,[f,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],h,[f,D]],[/\b(ph-1) /i],[h,[_,"Essential"],[f,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[_,"Envizen"],[f,C]],[/\b(trio[-\w\. ]+) b/i],[h,[_,"MachSpeed"],[f,C]],[/\btu_(1491) b/i],[h,[_,"Rotor"],[f,C]],[/(shield[\w ]+) b/i],[h,[_,"Nvidia"],[f,C]],[/(sprint) (\w+)/i],[_,h,[f,D]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[_,fe],[f,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[_,Lr],[f,C]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[_,Lr],[f,D]],[/smart-tv.+(samsung)/i],[_,[f,y]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[_,H],[f,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,I],[f,y]],[/(apple) ?tv/i],[_,[h,_e+" TV"],[f,y]],[/crkey/i],[[h,Ge+"cast"],[_,Bt],[f,y]],[/droid.+aft(\w+)( bui|\))/i],[h,[_,Me],[f,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[_,pt],[f,y]],[/(bravia[\w ]+)( bui|\))/i],[h,[_,er],[f,y]],[/(mitv-\w{5}) bui/i],[h,[_,rt],[f,y]],[/Hbbtv.*(technisat) (.*);/i],[_,h,[f,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,ks],[h,ks],[f,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,h,[f,P]],[/droid.+; (shield) bui/i],[h,[_,"Nvidia"],[f,P]],[/(playstation [345portablevi]+)/i],[h,[_,er],[f,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[_,fe],[f,P]],[/((pebble))app/i],[_,h,[f,R]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[_,_e],[f,R]],[/droid.+; (glass) \d/i],[h,[_,Bt],[f,R]],[/droid.+; (wt63?0{2,3})\)/i],[h,[_,Lr],[f,R]],[/(quest( 2| pro)?)/i],[h,[_,tr],[f,R]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[f,Y]],[/(aeobc)\b/i],[h,[_,Me],[f,Y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[f,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[f,C]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,C]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,D]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[p,Cs+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[g,Os,wr]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[g,Os,wr]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,Nr],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,g],[/\(bb(10);/i],[g,[p,ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[p,Xt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[p,Ge+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,Ds],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,g],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,g]]},Ne=function(V,ie){if(typeof V===u&&(ie=V,V=s),!(this instanceof Ne))return new Ne(V,ie).getResult();var q=typeof t!==c&&t.navigator?t.navigator:s,ae=V||(q&&q.userAgent?q.userAgent:i),ft=q&&q.userAgentData?q.userAgentData:s,Ze=ie?bn(Ar,ie):Ar,X=q&&q.userAgent==ae;return this.getBrowser=function(){var $={};return $[p]=s,$[g]=s,_r.call($,ae,Ze.browser),$[d]=zi($[g]),X&&q&&q.brave&&typeof q.brave.isBrave==o&&($[p]="Brave"),$},this.getCPU=function(){var $={};return $[k]=s,_r.call($,ae,Ze.cpu),$},this.getDevice=function(){var $={};return $[_]=s,$[h]=s,$[f]=s,_r.call($,ae,Ze.device),X&&!$[f]&&ft&&ft.mobile&&($[f]=D),X&&$[h]=="Macintosh"&&q&&typeof q.standalone!==c&&q.maxTouchPoints&&q.maxTouchPoints>2&&($[h]="iPad",$[f]=C),$},this.getEngine=function(){var $={};return $[p]=s,$[g]=s,_r.call($,ae,Ze.engine),$},this.getOS=function(){var $={};return $[p]=s,$[g]=s,_r.call($,ae,Ze.os),X&&!$[p]&&ft&&ft.platform!="Unknown"&&($[p]=ft.platform.replace(/chrome os/i,Ds).replace(/macos/i,Nr)),$},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ae},this.setUA=function($){return ae=typeof $===l&&$.length>de?ks($,de):$,this},this.setUA(ae),this};Ne.VERSION=n,Ne.BROWSER=mr([p,g,d]),Ne.CPU=mr([k]),Ne.DEVICE=mr([h,_,f,P,D,y,C,R,Y]),Ne.ENGINE=Ne.OS=mr([p,g]),r.exports&&(e=r.exports=Ne),e.UAParser=Ne;var Ae=typeof t!==c&&(t.jQuery||t.Zepto);if(Ae&&!Ae.ua){var yr=new Ne;Ae.ua=yr.getResult(),Ae.ua.get=function(){return yr.getUA()},Ae.ua.set=function(V){yr.setUA(V);var ie=yr.getResult();for(var q in ie)Ae.ua[q]=ie[q]}}})(typeof window=="object"?window:v)})(Qa,Qa.exports);var Af=Qa.exports,ve={},jf=v&&v.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ve,"__esModule",{value:!0});ve.Logger=void 0;const qr=jf(hi),Br="mediasoup-client";let $f=class{constructor(e){e?(this._debug=(0,qr.default)(`${Br}:${e}`),this._warn=(0,qr.default)(`${Br}:WARN:${e}`),this._error=(0,qr.default)(`${Br}:ERROR:${e}`)):(this._debug=(0,qr.default)(Br),this._warn=(0,qr.default)(`${Br}:WARN`),this._error=(0,qr.default)(`${Br}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};ve.Logger=$f;var $t={},bo={exports:{}},ds=typeof Reflect=="object"?Reflect:null,vc=ds&&typeof ds.apply=="function"?ds.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)},Wn;ds&&typeof ds.ownKeys=="function"?Wn=ds.ownKeys:Object.getOwnPropertySymbols?Wn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Wn=function(e){return Object.getOwnPropertyNames(e)};function Ff(r){console&&console.warn&&console.warn(r)}var Pd=Number.isNaN||function(e){return e!==e};function he(){he.init.call(this)}bo.exports=he;bo.exports.once=zf;he.EventEmitter=he;he.prototype._events=void 0;he.prototype._eventsCount=0;he.prototype._maxListeners=void 0;var Sc=10;function pi(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(he,"defaultMaxListeners",{enumerable:!0,get:function(){return Sc},set:function(r){if(typeof r!="number"||r<0||Pd(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Sc=r}});he.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};he.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Pd(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Md(r){return r._maxListeners===void 0?he.defaultMaxListeners:r._maxListeners}he.prototype.getMaxListeners=function(){return Md(this)};he.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var n=e==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=i[e];if(c===void 0)return!1;if(typeof c=="function")vc(c,this,t);else for(var u=c.length,l=jd(c,u),s=0;s<u;++s)vc(l[s],this,t);return!0};function Id(r,e,t,s){var n,i,a;if(pi(t),i=r._events,i===void 0?(i=r._events=Object.create(null),r._eventsCount=0):(i.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),i=r._events),a=i[e]),a===void 0)a=i[e]=t,++r._eventsCount;else if(typeof a=="function"?a=i[e]=s?[t,a]:[a,t]:s?a.unshift(t):a.push(t),n=Md(r),n>0&&a.length>n&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=e,o.count=a.length,Ff(o)}return r}he.prototype.addListener=function(e,t){return Id(this,e,t,!1)};he.prototype.on=he.prototype.addListener;he.prototype.prependListener=function(e,t){return Id(this,e,t,!0)};function Uf(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ld(r,e,t){var s={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},n=Uf.bind(s);return n.listener=t,s.wrapFn=n,n}he.prototype.once=function(e,t){return pi(t),this.on(e,Ld(this,e,t)),this};he.prototype.prependOnceListener=function(e,t){return pi(t),this.prependListener(e,Ld(this,e,t)),this};he.prototype.removeListener=function(e,t){var s,n,i,a,o;if(pi(t),n=this._events,n===void 0)return this;if(s=n[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(i=-1,a=s.length-1;a>=0;a--)if(s[a]===t||s[a].listener===t){o=s[a].listener,i=a;break}if(i<0)return this;i===0?s.shift():qf(s,i),s.length===1&&(n[e]=s[0]),n.removeListener!==void 0&&this.emit("removeListener",e,o||t)}return this};he.prototype.off=he.prototype.removeListener;he.prototype.removeAllListeners=function(e){var t,s,n;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var i=Object.keys(s),a;for(n=0;n<i.length;++n)a=i[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function Nd(r,e,t){var s=r._events;if(s===void 0)return[];var n=s[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?Bf(n):jd(n,n.length)}he.prototype.listeners=function(e){return Nd(this,e,!0)};he.prototype.rawListeners=function(e){return Nd(this,e,!1)};he.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):Ad.call(r,e)};he.prototype.listenerCount=Ad;function Ad(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}he.prototype.eventNames=function(){return this._eventsCount>0?Wn(this._events):[]};function jd(r,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=r[s];return t}function qf(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function Bf(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function zf(r,e){return new Promise(function(t,s){function n(a){r.removeListener(e,i),s(a)}function i(){typeof r.removeListener=="function"&&r.removeListener("error",n),t([].slice.call(arguments))}$d(r,e,i,{once:!0}),e!=="error"&&Vf(r,n,{once:!0})})}function Vf(r,e,t){typeof r.on=="function"&&$d(r,"error",e,t)}function $d(r,e,t,s){if(typeof r.on=="function")s.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function n(i){s.once&&r.removeEventListener(e,n),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var Hf=bo.exports;Object.defineProperty($t,"__esModule",{value:!0});$t.EnhancedEventEmitter=void 0;const Gf=Hf,Zf=ve,Wf=new Zf.Logger("EnhancedEventEmitter");class Jf extends Gf.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){const s=super.listenerCount(e);try{return super.emit(e,...t)}catch(n){return Wf.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,n),!!s}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}}$t.EnhancedEventEmitter=Jf;var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.InvalidStateError=Pe.UnsupportedError=void 0;class vo extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,vo):this.stack=new Error(e).stack}}Pe.UnsupportedError=vo;class So extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,So):this.stack=new Error(e).stack}}Pe.InvalidStateError=So;var Se={};Object.defineProperty(Se,"__esModule",{value:!0});Se.generateRandomNumber=Se.clone=void 0;function Kf(r){if(r!==void 0)return Number.isNaN(r)?NaN:typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}Se.clone=Kf;function Yf(){return Math.round(Math.random()*1e7)}Se.generateRandomNumber=Yf;var M={},Fd={};(function(r){const e=hi("h264-profile-level-id");e.log=console.info.bind(console);const t=1,s=2,n=3,i=4,a=5;r.ProfileConstrainedBaseline=t,r.ProfileBaseline=s,r.ProfileMain=n,r.ProfileConstrainedHigh=i,r.ProfileHigh=a;const o=0,c=10,u=11,l=12,d=13,h=20,p=21,f=22,_=30,g=31,k=32,P=40,D=41,C=42,y=50,R=51,Y=52;r.Level1_b=o,r.Level1=c,r.Level1_1=u,r.Level1_2=l,r.Level1_3=d,r.Level2=h,r.Level2_1=p,r.Level2_2=f,r.Level3=_,r.Level3_1=g,r.Level3_2=k,r.Level4=P,r.Level4_1=D,r.Level4_2=C,r.Level5=y,r.Level5_1=R,r.Level5_2=Y;class de{constructor(I,fe){this.profile=I,this.level=fe}}r.ProfileLevelId=de;const Me=new de(t,g),_e=16;class pe{constructor(I){this._mask=~Ge("x",I),this._maskedValue=Ge("1",I)}isMatch(I){return this._maskedValue===(I&this._mask)}}class ue{constructor(I,fe,Le){this.profile_idc=I,this.profile_iop=fe,this.profile=Le}}const tt=[new ue(66,new pe("x1xx0000"),t),new ue(77,new pe("1xxx0000"),t),new ue(88,new pe("11xx0000"),t),new ue(66,new pe("x0xx0000"),s),new ue(88,new pe("10xx0000"),s),new ue(77,new pe("0x0x0000"),n),new ue(100,new pe("00000000"),a),new ue(100,new pe("00001100"),i)];r.parseProfileLevelId=function(U){if(typeof U!="string"||U.length!==6)return null;const I=parseInt(U,16);if(I===0)return null;const fe=I&255,Le=I>>8&255,Dt=I>>16&255;let H;switch(fe){case u:{H=Le&_e?o:u;break}case c:case l:case d:case h:case p:case f:case _:case g:case k:case P:case D:case C:case y:case R:case Y:{H=fe;break}default:return e("parseProfileLevelId() | unrecognized level_idc:%s",fe),null}for(const pt of tt)if(Dt===pt.profile_idc&&pt.profile_iop.isMatch(Le))return new de(pt.profile,H);return e("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},r.profileLevelIdToString=function(U){if(U.level==o)switch(U.profile){case t:return"42f00b";case s:return"42100b";case n:return"4d100b";default:return e("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",U.profile),null}let I;switch(U.profile){case t:{I="42e0";break}case s:{I="4200";break}case n:{I="4d00";break}case i:{I="640c";break}case a:{I="6400";break}default:return e("profileLevelIdToString() | unrecognized profile:%s",U.profile),null}let fe=U.level.toString(16);return fe.length===1&&(fe=`0${fe}`),`${I}${fe}`},r.parseSdpProfileLevelId=function(U={}){const I=U["profile-level-id"];return I?r.parseProfileLevelId(I):Me},r.isSameProfile=function(U={},I={}){const fe=r.parseSdpProfileLevelId(U),Le=r.parseSdpProfileLevelId(I);return!!(fe&&Le&&fe.profile===Le.profile)},r.generateProfileLevelIdForAnswer=function(U={},I={}){if(!U["profile-level-id"]&&!I["profile-level-id"])return e("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const fe=r.parseSdpProfileLevelId(U),Le=r.parseSdpProfileLevelId(I);if(!fe)throw new TypeError("invalid local_profile_level_id");if(!Le)throw new TypeError("invalid remote_profile_level_id");if(fe.profile!==Le.profile)throw new TypeError("H264 Profile mismatch");const Dt=Bt(U)&&Bt(I),H=fe.level,pt=Le.level,er=Xt(H,pt),rt=Dt?H:er;return e("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",fe.profile,rt),r.profileLevelIdToString(new de(fe.profile,rt))};function Ge(U,I){return(I[0]===U)<<7|(I[1]===U)<<6|(I[2]===U)<<5|(I[3]===U)<<4|(I[4]===U)<<3|(I[5]===U)<<2|(I[6]===U)<<1|(I[7]===U)<<0}function Cs(U,I){return U===o?I!==c&&I!==o:I===o?U!==c:U<I}function Xt(U,I){return Cs(U,I)?U:I}function Bt(U={}){const I=U["level-asymmetry-allowed"];return I===1||I==="1"}})(Fd);var Qf=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Xf=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Ud=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Qf(e,r,t);return Xf(e,r),e};Object.defineProperty(M,"__esModule",{value:!0});M.canReceive=M.canSend=M.generateProbatorRtpParameters=M.reduceCodecs=M.getSendingRemoteRtpParameters=M.getSendingRtpParameters=M.getRecvRtpCapabilities=M.getExtendedRtpCapabilities=M.validateSctpStreamParameters=M.validateSctpParameters=M.validateNumSctpStreams=M.validateSctpCapabilities=M.validateRtcpParameters=M.validateRtpEncodingParameters=M.validateRtpHeaderExtensionParameters=M.validateRtpCodecParameters=M.validateRtpParameters=M.validateRtpHeaderExtension=M.validateRtcpFeedback=M.validateRtpCodecCapability=M.validateRtpCapabilities=void 0;const Rc=Ud(Fd),em=Ud(Se),tm="probator",rm=1234,sm=127;function nm(r){if(typeof r!="object")throw new TypeError("caps is not an object");if(r.codecs&&!Array.isArray(r.codecs))throw new TypeError("caps.codecs is not an array");r.codecs||(r.codecs=[]);for(const e of r.codecs)qd(e);if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);for(const e of r.headerExtensions)Bd(e)}M.validateRtpCapabilities=nm;function qd(r){const e=new RegExp("^(audio|video)/(.+)","i");if(typeof r!="object")throw new TypeError("codec is not an object");if(!r.mimeType||typeof r.mimeType!="string")throw new TypeError("missing codec.mimeType");const t=e.exec(r.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(r.kind=t[1].toLowerCase(),r.preferredPayloadType&&typeof r.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof r.clockRate!="number")throw new TypeError("missing codec.clockRate");r.kind==="audio"?typeof r.channels!="number"&&(r.channels=1):delete r.channels,(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(const s of Object.keys(r.parameters)){let n=r.parameters[s];if(n===void 0&&(r.parameters[s]="",n=""),typeof n!="string"&&typeof n!="number")throw new TypeError(`invalid codec parameter [key:${s}s, value:${n}]`);if(s==="apt"&&typeof n!="number")throw new TypeError("invalid codec apt parameter")}(!r.rtcpFeedback||!Array.isArray(r.rtcpFeedback))&&(r.rtcpFeedback=[]);for(const s of r.rtcpFeedback)Ro(s)}M.validateRtpCodecCapability=qd;function Ro(r){if(typeof r!="object")throw new TypeError("fb is not an object");if(!r.type||typeof r.type!="string")throw new TypeError("missing fb.type");(!r.parameter||typeof r.parameter!="string")&&(r.parameter="")}M.validateRtcpFeedback=Ro;function Bd(r){if(typeof r!="object")throw new TypeError("ext is not an object");if(r.kind!=="audio"&&r.kind!=="video")throw new TypeError("invalid ext.kind");if(!r.uri||typeof r.uri!="string")throw new TypeError("missing ext.uri");if(typeof r.preferredId!="number")throw new TypeError("missing ext.preferredId");if(r.preferredEncrypt&&typeof r.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(r.preferredEncrypt||(r.preferredEncrypt=!1),r.direction&&typeof r.direction!="string")throw new TypeError("invalid ext.direction");r.direction||(r.direction="sendrecv")}M.validateRtpHeaderExtension=Bd;function To(r){if(typeof r!="object")throw new TypeError("params is not an object");if(r.mid&&typeof r.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(r.codecs))throw new TypeError("missing params.codecs");for(const e of r.codecs)zd(e);if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("params.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);for(const e of r.headerExtensions)Vd(e);if(r.encodings&&!Array.isArray(r.encodings))throw new TypeError("params.encodings is not an array");r.encodings||(r.encodings=[]);for(const e of r.encodings)Hd(e);if(r.rtcp&&typeof r.rtcp!="object")throw new TypeError("params.rtcp is not an object");r.rtcp||(r.rtcp={}),Gd(r.rtcp)}M.validateRtpParameters=To;function zd(r){const e=new RegExp("^(audio|video)/(.+)","i");if(typeof r!="object")throw new TypeError("codec is not an object");if(!r.mimeType||typeof r.mimeType!="string")throw new TypeError("missing codec.mimeType");const t=e.exec(r.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(typeof r.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof r.clockRate!="number")throw new TypeError("missing codec.clockRate");t[1].toLowerCase()==="audio"?typeof r.channels!="number"&&(r.channels=1):delete r.channels,(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(const n of Object.keys(r.parameters)){let i=r.parameters[n];if(i===void 0&&(r.parameters[n]="",i=""),typeof i!="string"&&typeof i!="number")throw new TypeError(`invalid codec parameter [key:${n}s, value:${i}]`);if(n==="apt"&&typeof i!="number")throw new TypeError("invalid codec apt parameter")}(!r.rtcpFeedback||!Array.isArray(r.rtcpFeedback))&&(r.rtcpFeedback=[]);for(const n of r.rtcpFeedback)Ro(n)}M.validateRtpCodecParameters=zd;function Vd(r){if(typeof r!="object")throw new TypeError("ext is not an object");if(!r.uri||typeof r.uri!="string")throw new TypeError("missing ext.uri");if(typeof r.id!="number")throw new TypeError("missing ext.id");if(r.encrypt&&typeof r.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");r.encrypt||(r.encrypt=!1),(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(const e of Object.keys(r.parameters)){let t=r.parameters[e];if(t===void 0&&(r.parameters[e]="",t=""),typeof t!="string"&&typeof t!="number")throw new TypeError("invalid header extension parameter")}}M.validateRtpHeaderExtensionParameters=Vd;function Hd(r){if(typeof r!="object")throw new TypeError("encoding is not an object");if(r.ssrc&&typeof r.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(r.rid&&typeof r.rid!="string")throw new TypeError("invalid encoding.rid");if(r.rtx&&typeof r.rtx!="object")throw new TypeError("invalid encoding.rtx");if(r.rtx&&typeof r.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!r.dtx||typeof r.dtx!="boolean")&&(r.dtx=!1),r.scalabilityMode&&typeof r.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}M.validateRtpEncodingParameters=Hd;function Gd(r){if(typeof r!="object")throw new TypeError("rtcp is not an object");if(r.cname&&typeof r.cname!="string")throw new TypeError("invalid rtcp.cname");(!r.reducedSize||typeof r.reducedSize!="boolean")&&(r.reducedSize=!0)}M.validateRtcpParameters=Gd;function im(r){if(typeof r!="object")throw new TypeError("caps is not an object");if(!r.numStreams||typeof r.numStreams!="object")throw new TypeError("missing caps.numStreams");Zd(r.numStreams)}M.validateSctpCapabilities=im;function Zd(r){if(typeof r!="object")throw new TypeError("numStreams is not an object");if(typeof r.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof r.MIS!="number")throw new TypeError("missing numStreams.MIS")}M.validateNumSctpStreams=Zd;function am(r){if(typeof r!="object")throw new TypeError("params is not an object");if(typeof r.port!="number")throw new TypeError("missing params.port");if(typeof r.OS!="number")throw new TypeError("missing params.OS");if(typeof r.MIS!="number")throw new TypeError("missing params.MIS");if(typeof r.maxMessageSize!="number")throw new TypeError("missing params.maxMessageSize")}M.validateSctpParameters=am;function om(r){if(typeof r!="object")throw new TypeError("params is not an object");if(typeof r.streamId!="number")throw new TypeError("missing params.streamId");let e=!1;if(typeof r.ordered=="boolean"?e=!0:r.ordered=!0,r.maxPacketLifeTime&&typeof r.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(r.maxRetransmits&&typeof r.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(r.maxPacketLifeTime&&r.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(e&&r.ordered&&(r.maxPacketLifeTime||r.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!e&&(r.maxPacketLifeTime||r.maxRetransmits)&&(r.ordered=!1),r.label&&typeof r.label!="string")throw new TypeError("invalid params.label");if(r.protocol&&typeof r.protocol!="string")throw new TypeError("invalid params.protocol")}M.validateSctpStreamParameters=om;function cm(r,e){const t={codecs:[],headerExtensions:[]};for(const s of e.codecs||[]){if(zs(s))continue;const n=(r.codecs||[]).find(a=>Wd(a,s,{strict:!0,modify:!0}));if(!n)continue;const i={mimeType:n.mimeType,kind:n.kind,clockRate:n.clockRate,channels:n.channels,localPayloadType:n.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:s.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:n.parameters,remoteParameters:s.parameters,rtcpFeedback:_m(n,s)};t.codecs.push(i)}for(const s of t.codecs){const n=r.codecs.find(a=>zs(a)&&a.parameters.apt===s.localPayloadType),i=e.codecs.find(a=>zs(a)&&a.parameters.apt===s.remotePayloadType);n&&i&&(s.localRtxPayloadType=n.preferredPayloadType,s.remoteRtxPayloadType=i.preferredPayloadType)}for(const s of e.headerExtensions){const n=r.headerExtensions.find(a=>gm(a,s));if(!n)continue;const i={kind:s.kind,uri:s.uri,sendId:n.preferredId,recvId:s.preferredId,encrypt:n.preferredEncrypt,direction:"sendrecv"};switch(s.direction){case"sendrecv":i.direction="sendrecv";break;case"recvonly":i.direction="sendonly";break;case"sendonly":i.direction="recvonly";break;case"inactive":i.direction="inactive";break}t.headerExtensions.push(i)}return t}M.getExtendedRtpCapabilities=cm;function lm(r){const e={codecs:[],headerExtensions:[]};for(const t of r.codecs){const s={mimeType:t.mimeType,kind:t.kind,preferredPayloadType:t.remotePayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(e.codecs.push(s),!t.remoteRtxPayloadType)continue;const n={mimeType:`${t.kind}/rtx`,kind:t.kind,preferredPayloadType:t.remoteRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.remotePayloadType},rtcpFeedback:[]};e.codecs.push(n)}for(const t of r.headerExtensions){if(t.direction!=="sendrecv"&&t.direction!=="recvonly")continue;const s={kind:t.kind,uri:t.uri,preferredId:t.recvId,preferredEncrypt:t.encrypt,direction:t.direction};e.headerExtensions.push(s)}return e}M.getRecvRtpCapabilities=lm;function dm(r,e){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const s of e.codecs){if(s.kind!==r)continue;const n={mimeType:s.mimeType,payloadType:s.localPayloadType,clockRate:s.clockRate,channels:s.channels,parameters:s.localParameters,rtcpFeedback:s.rtcpFeedback};if(t.codecs.push(n),s.localRtxPayloadType){const i={mimeType:`${s.kind}/rtx`,payloadType:s.localRtxPayloadType,clockRate:s.clockRate,parameters:{apt:s.localPayloadType},rtcpFeedback:[]};t.codecs.push(i)}}for(const s of e.headerExtensions){if(s.kind&&s.kind!==r||s.direction!=="sendrecv"&&s.direction!=="sendonly")continue;const n={uri:s.uri,id:s.sendId,encrypt:s.encrypt,parameters:{}};t.headerExtensions.push(n)}return t}M.getSendingRtpParameters=dm;function um(r,e){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const s of e.codecs){if(s.kind!==r)continue;const n={mimeType:s.mimeType,payloadType:s.localPayloadType,clockRate:s.clockRate,channels:s.channels,parameters:s.remoteParameters,rtcpFeedback:s.rtcpFeedback};if(t.codecs.push(n),s.localRtxPayloadType){const i={mimeType:`${s.kind}/rtx`,payloadType:s.localRtxPayloadType,clockRate:s.clockRate,parameters:{apt:s.localPayloadType},rtcpFeedback:[]};t.codecs.push(i)}}for(const s of e.headerExtensions){if(s.kind&&s.kind!==r||s.direction!=="sendrecv"&&s.direction!=="sendonly")continue;const n={uri:s.uri,id:s.sendId,encrypt:s.encrypt,parameters:{}};t.headerExtensions.push(n)}if(t.headerExtensions.some(s=>s.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const s of t.codecs)s.rtcpFeedback=(s.rtcpFeedback||[]).filter(n=>n.type!=="goog-remb");else if(t.headerExtensions.some(s=>s.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const s of t.codecs)s.rtcpFeedback=(s.rtcpFeedback||[]).filter(n=>n.type!=="transport-cc");else for(const s of t.codecs)s.rtcpFeedback=(s.rtcpFeedback||[]).filter(n=>n.type!=="transport-cc"&&n.type!=="goog-remb");return t}M.getSendingRemoteRtpParameters=um;function hm(r,e){const t=[];if(!e)t.push(r[0]),zs(r[1])&&t.push(r[1]);else{for(let s=0;s<r.length;++s)if(Wd(r[s],e)){t.push(r[s]),zs(r[s+1])&&t.push(r[s+1]);break}if(t.length===0)throw new TypeError("no matching codec found")}return t}M.reduceCodecs=hm;function pm(r){r=em.clone(r),To(r);const e={mid:tm,codecs:[],headerExtensions:[],encodings:[{ssrc:rm}],rtcp:{cname:"probator"}};return e.codecs.push(r.codecs[0]),e.codecs[0].payloadType=sm,e.headerExtensions=r.headerExtensions,e}M.generateProbatorRtpParameters=pm;function fm(r,e){return e.codecs.some(t=>t.kind===r)}M.canSend=fm;function mm(r,e){if(To(r),r.codecs.length===0)return!1;const t=r.codecs[0];return e.codecs.some(s=>s.remotePayloadType===t.payloadType)}M.canReceive=mm;function zs(r){return r?/.+\/rtx$/i.test(r.mimeType):!1}function Wd(r,e,{strict:t=!1,modify:s=!1}={}){const n=r.mimeType.toLowerCase(),i=e.mimeType.toLowerCase();if(n!==i||r.clockRate!==e.clockRate||r.channels!==e.channels)return!1;switch(n){case"video/h264":{if(t){const a=r.parameters["packetization-mode"]||0,o=e.parameters["packetization-mode"]||0;if(a!==o||!Rc.isSameProfile(r.parameters,e.parameters))return!1;let c;try{c=Rc.generateProfileLevelIdForAnswer(r.parameters,e.parameters)}catch{return!1}s&&(c?(r.parameters["profile-level-id"]=c,e.parameters["profile-level-id"]=c):(delete r.parameters["profile-level-id"],delete e.parameters["profile-level-id"]))}break}case"video/vp9":{if(t){const a=r.parameters["profile-id"]||0,o=e.parameters["profile-id"]||0;if(a!==o)return!1}break}}return!0}function gm(r,e){return!(r.kind&&e.kind&&r.kind!==e.kind||r.uri!==e.uri)}function _m(r,e){const t=[];for(const s of r.rtcpFeedback||[]){const n=(e.rtcpFeedback||[]).find(i=>i.type===s.type&&(i.parameter===s.parameter||!i.parameter&&!s.parameter));n&&t.push(n)}return t}var en={},hr={},fi={},wm=v&&v.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(fi,"__esModule",{value:!0});fi.Logger=void 0;const zr=wm(hi),Vr="awaitqueue";class ym{constructor(e){e?(this._debug=(0,zr.default)(`${Vr}:${e}`),this._warn=(0,zr.default)(`${Vr}:WARN:${e}`),this._error=(0,zr.default)(`${Vr}:ERROR:${e}`)):(this._debug=(0,zr.default)(Vr),this._warn=(0,zr.default)(`${Vr}:WARN`),this._error=(0,zr.default)(`${Vr}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}fi.Logger=ym;Object.defineProperty(hr,"__esModule",{value:!0});hr.AwaitQueue=hr.AwaitQueueRemovedTaskError=hr.AwaitQueueStoppedError=void 0;const bm=fi,sr=new bm.Logger;class mi extends Error{constructor(e){super(e??"AwaitQueue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,mi)}}hr.AwaitQueueStoppedError=mi;class gi extends Error{constructor(e){super(e??"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,gi)}}hr.AwaitQueueRemovedTaskError=gi;class vm{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(e,t){if(t=t??e.name,sr.debug(`push() [name:${t}]`),typeof e!="function")throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch{}return new Promise((s,n)=>{const i={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:a=>{if(i.completed)return;i.completed=!0,this.pendingTasks.delete(i.id),sr.debug(`resolving task [name:${i.name}]`),s(a);const[o]=this.pendingTasks.values();o&&!o.executedAt&&this.execute(o)},reject:a=>{if(!i.completed&&(i.completed=!0,this.pendingTasks.delete(i.id),sr.debug(`rejecting task [name:${i.name}]: %s`,String(a)),n(a),!this.stopping)){const[o]=this.pendingTasks.values();o&&!o.executedAt&&this.execute(o)}}};this.pendingTasks.set(i.id,i),this.pendingTasks.size===1&&this.execute(i)})}stop(){sr.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())sr.debug(`stop() | stopping task [name:${e.name}]`),e.reject(new mi);this.stopping=!1}remove(e){sr.debug(`remove() [taskIdx:${e}]`);const t=Array.from(this.pendingTasks.values())[e];if(!t){sr.debug(`stop() | no task with given idx [taskIdx:${e}]`);return}t.reject(new gi)}dump(){const e=Date.now();let t=0;return Array.from(this.pendingTasks.values()).map(s=>({idx:t++,task:s.task,name:s.name,enqueuedTime:s.executedAt?s.executedAt-s.enqueuedAt:e-s.enqueuedAt,executionTime:s.executedAt?e-s.executedAt:0}))}async execute(e){if(sr.debug(`execute() [name:${e.name}]`),e.executedAt)throw new Error("task already being executed");e.executedAt=Date.now();try{const t=await e.task();e.resolve(t)}catch(t){e.reject(t)}}}hr.AwaitQueue=vm;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Tc;var Sm=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:v):r=>(Tc||(Tc=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0)),tn={};Object.defineProperty(tn,"__esModule",{value:!0});tn.Producer=void 0;const Rm=ve,Cc=$t,Hr=Pe,Et=new Rm.Logger("Producer");class Tm extends Cc.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:s,track:n,rtpParameters:i,stopTracks:a,disableTrackOnPause:o,zeroRtpOnPause:c,appData:u}){super(),this._closed=!1,this._observer=new Cc.EnhancedEventEmitter,Et.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=s,this._track=n,this._kind=n.kind,this._rtpParameters=i,this._paused=o?!n.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=a,this._disableTrackOnPause=o,this._zeroRtpOnPause=c,this._appData=u||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(Et.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Et.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Hr.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(Et.debug("pause()"),this._closed){Et.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@pause",e,t)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(Et.debug("resume()"),this._closed){Et.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@resume",e,t)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:e}){if(Et.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch{}throw new Hr.InvalidStateError("closed")}else if(e&&e.readyState==="ended")throw new Hr.InvalidStateError("track ended");if(e===this._track){Et.debug("replaceTrack() | same track, ignored");return}await new Promise((t,s)=>{this.safeEmit("@replacetrack",e,t,s)}),this.destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new Hr.InvalidStateError("closed");if(this._kind!=="video")throw new Hr.UnsupportedError("not a video Producer");if(typeof e!="number")throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await new Promise((t,s)=>{this.safeEmit("@setmaxspatiallayer",e,t,s)}).catch(()=>{}),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new Hr.InvalidStateError("closed");if(typeof e!="object")throw new TypeError("invalid params");await new Promise((t,s)=>{this.safeEmit("@setrtpencodingparameters",e,t,s)})}onTrackEnded(){Et.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}}tn.Producer=Tm;var rn={};Object.defineProperty(rn,"__esModule",{value:!0});rn.Consumer=void 0;const Cm=ve,Dc=$t,Dm=Pe,kt=new Cm.Logger("Consumer");class Em extends Dc.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:s,rtpReceiver:n,track:i,rtpParameters:a,appData:o}){super(),this._closed=!1,this._observer=new Dc.EnhancedEventEmitter,kt.debug("constructor()"),this._id=e,this._localId=t,this._producerId=s,this._rtpReceiver=n,this._track=i,this._rtpParameters=a,this._paused=!i.enabled,this._appData=o||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(kt.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(kt.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Dm.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(kt.debug("pause()"),this._closed){kt.error("pause() | Consumer closed");return}if(this._paused){kt.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(kt.debug("resume()"),this._closed){kt.error("resume() | Consumer closed");return}if(!this._paused){kt.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){kt.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}}rn.Consumer=Em;var sn={};Object.defineProperty(sn,"__esModule",{value:!0});sn.DataProducer=void 0;const km=ve,Ec=$t,Om=Pe,Ht=new km.Logger("DataProducer");class xm extends Ec.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:s,appData:n}){super(),this._closed=!1,this._observer=new Ec.EnhancedEventEmitter,Ht.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=s,this._appData=n||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(Ht.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Ht.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(Ht.debug("send()"),this._closed)throw new Om.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Ht.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),t.errorDetail==="sctp-failure"?Ht.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):Ht.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Ht.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||Ht.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}sn.DataProducer=xm;var nn={};Object.defineProperty(nn,"__esModule",{value:!0});nn.DataConsumer=void 0;const Pm=ve,kc=$t,Sr=new Pm.Logger("DataConsumer");class Mm extends kc.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:s,sctpStreamParameters:n,appData:i}){super(),this._closed=!1,this._observer=new kc.EnhancedEventEmitter,Sr.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=s,this._sctpStreamParameters=n,this._appData=i||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(Sr.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Sr.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Sr.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),t.errorDetail==="sctp-failure"?Sr.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):Sr.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Sr.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}}nn.DataConsumer=Mm;var Im=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Lm=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Jd=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Im(e,r,t);return Lm(e,r),e},Nm=v&&v.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(en,"__esModule",{value:!0});en.Transport=void 0;const Am=hr,aa=Nm(Sm),jm=ve,Oc=$t,ke=Pe,oa=Jd(Se),Ls=Jd(M),$m=tn,Fm=rn,Um=sn,qm=nn,Te=new jm.Logger("Transport");class Bm{constructor(e){this.consumerOptions=e,this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}class zm extends Oc.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:s,iceCandidates:n,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,appData:d,handlerFactory:h,extendedRtpCapabilities:p,canProduceByKind:f}){super(),this._closed=!1,this._iceGatheringState="new",this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new Am.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new Oc.EnhancedEventEmitter,Te.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=p,this._canProduceByKind=f,this._maxSctpMessageSize=a?a.maxMessageSize:null,u=oa.clone(u)||{},delete u.iceServers,delete u.iceTransportPolicy,delete u.bundlePolicy,delete u.rtcpMuxPolicy,delete u.sdpSemantics,this._handler=h(),this._handler.run({direction:e,iceParameters:s,iceCandidates:n,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:p}),this._appData=d||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){if(!this._closed){Te.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new ke.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(Te.debug("restartIce()"),this._closed)throw new ke.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(Te.debug("updateIceServers()"),this._closed)throw new ke.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:s,codec:n,stopTracks:i=!0,disableTrackOnPause:a=!0,zeroRtpOnPause:o=!1,appData:c={}}={}){if(Te.debug("produce() [track:%o]",e),this._closed)throw new ke.InvalidStateError("closed");if(e){if(this._direction!=="send")throw new ke.UnsupportedError("not a sending Transport");if(this._canProduceByKind[e.kind]){if(e.readyState==="ended")throw new ke.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(c&&typeof c!="object")throw new TypeError("if given, appData must be an object")}else throw new ke.UnsupportedError(`cannot produce ${e.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let u;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&t.length===0?u=void 0:t&&(u=t.map(p=>{const f={active:!0};return p.active===!1&&(f.active=!1),typeof p.dtx=="boolean"&&(f.dtx=p.dtx),typeof p.scalabilityMode=="string"&&(f.scalabilityMode=p.scalabilityMode),typeof p.scaleResolutionDownBy=="number"&&(f.scaleResolutionDownBy=p.scaleResolutionDownBy),typeof p.maxBitrate=="number"&&(f.maxBitrate=p.maxBitrate),typeof p.maxFramerate=="number"&&(f.maxFramerate=p.maxFramerate),typeof p.adaptivePtime=="boolean"&&(f.adaptivePtime=p.adaptivePtime),typeof p.priority=="string"&&(f.priority=p.priority),typeof p.networkPriority=="string"&&(f.networkPriority=p.networkPriority),f}));const{localId:l,rtpParameters:d,rtpSender:h}=await this._handler.send({track:e,encodings:u,codecOptions:s,codec:n});try{Ls.validateRtpParameters(d);const{id:p}=await new Promise((_,g)=>{this.safeEmit("produce",{kind:e.kind,rtpParameters:d,appData:c},_,g)}),f=new $m.Producer({id:p,localId:l,rtpSender:h,track:e,rtpParameters:d,stopTracks:i,disableTrackOnPause:a,zeroRtpOnPause:o,appData:c});return this._producers.set(f.id,f),this.handleProducer(f),this._observer.safeEmit("newproducer",f),f}catch(p){throw this._handler.stopSending(l).catch(()=>{}),p}},"transport.produce()").catch(u=>{if(i)try{e.stop()}catch{}throw u})}async consume({id:e,producerId:t,kind:s,rtpParameters:n,streamId:i,appData:a={}}){if(Te.debug("consume()"),n=oa.clone(n),this._closed)throw new ke.InvalidStateError("closed");if(this._direction!=="recv")throw new ke.UnsupportedError("not a receiving Transport");if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing producerId");if(s!=="audio"&&s!=="video")throw new TypeError(`invalid kind '${s}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object");if(!Ls.canReceive(n,this._extendedRtpCapabilities))throw new ke.UnsupportedError("cannot consume this Producer");const c=new Bm({id:e,producerId:t,kind:s,rtpParameters:n,streamId:i,appData:a});return this._pendingConsumerTasks.push(c),(0,aa.default)(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),c.promise}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:s,label:n="",protocol:i="",appData:a={}}={}){if(Te.debug("produceData()"),this._closed)throw new ke.InvalidStateError("closed");if(this._direction!=="send")throw new ke.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object")}else throw new ke.UnsupportedError("SCTP not enabled by remote Transport");return(t||s)&&(e=!1),this._awaitQueue.push(async()=>{const{dataChannel:o,sctpStreamParameters:c}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i});Ls.validateSctpStreamParameters(c);const{id:u}=await new Promise((d,h)=>{this.safeEmit("producedata",{sctpStreamParameters:c,label:n,protocol:i,appData:a},d,h)}),l=new Um.DataProducer({id:u,dataChannel:o,sctpStreamParameters:c,appData:a});return this._dataProducers.set(l.id,l),this.handleDataProducer(l),this._observer.safeEmit("newdataproducer",l),l},"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:s,label:n="",protocol:i="",appData:a={}}){if(Te.debug("consumeData()"),s=oa.clone(s),this._closed)throw new ke.InvalidStateError("closed");if(this._direction!=="recv")throw new ke.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object")}else throw new ke.UnsupportedError("SCTP not enabled by remote Transport");return Ls.validateSctpStreamParameters(s),this._awaitQueue.push(async()=>{const{dataChannel:o}=await this._handler.receiveDataChannel({sctpStreamParameters:s,label:n,protocol:i}),c=new qm.DataConsumer({id:e,dataProducerId:t,dataChannel:o,sctpStreamParameters:s,appData:a});return this._dataConsumers.set(c.id,c),this.handleDataConsumer(c),this._observer.safeEmit("newdataconsumer",c),c},"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){Te.debug("createPendingConsumers() | there is no Consumer to be created");return}const e=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let t;const s=[];for(const n of e){const{id:i,kind:a,rtpParameters:o,streamId:c}=n.consumerOptions;s.push({trackId:i,kind:a,rtpParameters:o,streamId:c})}try{const n=await this._handler.receive(s);for(let i=0;i<n.length;++i){const a=e[i],o=n[i],{id:c,producerId:u,kind:l,rtpParameters:d,appData:h}=a.consumerOptions,{localId:p,rtpReceiver:f,track:_}=o,g=new Fm.Consumer({id:c,localId:p,producerId:u,rtpReceiver:f,track:_,rtpParameters:d,appData:h});this._consumers.set(g.id,g),this.handleConsumer(g),!this._probatorConsumerCreated&&!t&&l==="video"&&(t=g),this._observer.safeEmit("newconsumer",g),a.resolve(g)}}catch(n){for(const i of e)i.reject(n)}if(t)try{const n=Ls.generateProbatorRtpParameters(t.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:n}]),Te.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(n){Te.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",n)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){Te.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const t=e.map(s=>s.localId);await this._handler.pauseReceiving(t)}catch(t){Te.error("pausePendingConsumers() | failed to pause Consumers:",t)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){Te.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const t=e.map(s=>s.localId);await this._handler.resumeReceiving(t)}catch(t){Te.error("resumePendingConsumers() | failed to resume Consumers:",t)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){Te.debug("closePendingConsumers() | there is no Consumer to be closed");return}const e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(e.map(t=>t.localId))}catch(t){Te.error("closePendingConsumers() | failed to close Consumers:",t)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const e=this._handler;e.on("@connect",({dtlsParameters:t},s,n)=>{if(this._closed){n(new ke.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:t},s,n)}),e.on("@icegatheringstatechange",t=>{t!==this._iceGatheringState&&(Te.debug("ICE gathering state changed to %s",t),this._iceGatheringState=t,this._closed||this.safeEmit("icegatheringstatechange",t))}),e.on("@connectionstatechange",t=>{t!==this._connectionState&&(Te.debug("connection state changed to %s",t),this._connectionState=t,this._closed||this.safeEmit("connectionstatechange",t))})}handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(e.localId),"producer @close event").catch(t=>Te.warn("producer.close() failed:%o",t))}),e.on("@pause",(t,s)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(e.localId),"producer @pause event").then(t).catch(s)}),e.on("@resume",(t,s)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(e.localId),"producer @resume event").then(t).catch(s)}),e.on("@replacetrack",(t,s,n)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(e.localId,t),"producer @replacetrack event").then(s).catch(n)}),e.on("@setmaxspatiallayer",(t,s,n)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(e.localId,t),"producer @setmaxspatiallayer event").then(s).catch(n)}),e.on("@setrtpencodingparameters",(t,s,n)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(e.localId,t),"producer @setrtpencodingparameters event").then(s).catch(n)}),e.on("@getstats",(t,s)=>{if(this._closed)return s(new ke.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(s)})}handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),!this._closed&&(this._pendingCloseConsumers.set(e.id,e),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),e.on("@pause",()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),(0,aa.default)(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),e.on("@resume",()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),(0,aa.default)(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),e.on("@getstats",(t,s)=>{if(this._closed)return s(new ke.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(s)})}handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}en.Transport=zm;var _i={},Re={},Kd={},Yd={exports:{}},xc=Yd.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(r){return r.encoding?"rtpmap:%d %s/%s/%s":r.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(r){return r.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(r){return r.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(r){return"extmap:%d"+(r.direction?"/%s":"%v")+(r["encrypt-uri"]?" %s":"%v")+" %s"+(r.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(r){return r.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(r){var e="candidate:%s %d %s %d %s %d typ %s";return e+=r.raddr!=null?" raddr %s rport %d":"%v%v",e+=r.tcptype!=null?" tcptype %s":"%v",r.generation!=null&&(e+=" generation %d"),e+=r["network-id"]!=null?" network-id %d":"%v",e+=r["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(r){var e="ssrc:%d";return r.attribute!=null&&(e+=" %s",r.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(r){return r.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(r){return r.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(r){return"imageattr:%s %s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(r){return"simulcast:%s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(r){return"ts-refclk:%s"+(r.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(r){var e="mediaclk:";return e+=r.id!=null?"id=%s %s":"%v%s",e+=r.mediaClockValue!=null?"=%s":"",e+=r.rateNumerator!=null?" rate=%s":"",e+=r.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(xc).forEach(function(r){var e=xc[r];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})});var Qd=Yd.exports;(function(r){var e=function(o){return String(Number(o))===o?Number(o):o},t=function(o,c,u,l){if(l&&!u)c[l]=e(o[1]);else for(var d=0;d<u.length;d+=1)o[d+1]!=null&&(c[u[d]]=e(o[d+1]))},s=function(o,c,u){var l=o.name&&o.names;o.push&&!c[o.push]?c[o.push]=[]:l&&!c[o.name]&&(c[o.name]={});var d=o.push?{}:l?c[o.name]:c;t(u.match(o.reg),d,o.names,o.name),o.push&&c[o.push].push(d)},n=Qd,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(o){var c={},u=[],l=c;return o.split(/(\r\n|\r|\n)/).filter(i).forEach(function(d){var h=d[0],p=d.slice(2);h==="m"&&(u.push({rtp:[],fmtp:[]}),l=u[u.length-1]);for(var f=0;f<(n[h]||[]).length;f+=1){var _=n[h][f];if(_.reg.test(p))return s(_,l,p)}}),c.media=u,c};var a=function(o,c){var u=c.split(/=(.+)/,2);return u.length===2?o[u[0]]=e(u[1]):u.length===1&&c.length>1&&(o[u[0]]=void 0),o};r.parseParams=function(o){return o.split(/;\s?/).reduce(a,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(o){return o.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(o){for(var c=[],u=o.split(" ").map(e),l=0;l<u.length;l+=3)c.push({component:u[l],ip:u[l+1],port:u[l+2]});return c},r.parseImageAttributes=function(o){return o.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(a,{})})},r.parseSimulcastStreamList=function(o){return o.split(";").map(function(c){return c.split(",").map(function(u){var l,d=!1;return u[0]!=="~"?l=e(u):(l=e(u.substring(1,u.length)),d=!0),{scid:l,paused:d}})})}})(Kd);var ca=Qd,Vm=/%[sdv%]/g,Hm=function(r){var e=1,t=arguments,s=t.length;return r.replace(Vm,function(n){if(e>=s)return n;var i=t[e];switch(e+=1,n){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},Ns=function(r,e,t){var s=e.format instanceof Function?e.format(e.push?t:t[e.name]):e.format,n=[r+"="+s];if(e.names)for(var i=0;i<e.names.length;i+=1){var a=e.names[i];e.name?n.push(t[e.name][a]):n.push(t[e.names[i]])}else n.push(t[e.name]);return Hm.apply(null,n)},Gm=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Zm=["i","c","b","a"],Wm=function(r,e){e=e||{},r.version==null&&(r.version=0),r.name==null&&(r.name=" "),r.media.forEach(function(i){i.payloads==null&&(i.payloads="")});var t=e.outerOrder||Gm,s=e.innerOrder||Zm,n=[];return t.forEach(function(i){ca[i].forEach(function(a){a.name in r&&r[a.name]!=null?n.push(Ns(i,a,r)):a.push in r&&r[a.push]!=null&&r[a.push].forEach(function(o){n.push(Ns(i,a,o))})})}),r.media.forEach(function(i){n.push(Ns("m",ca.m[0],i)),s.forEach(function(a){ca[a].forEach(function(o){o.name in i&&i[o.name]!=null?n.push(Ns(a,o,i)):o.push in i&&i[o.push]!=null&&i[o.push].forEach(function(c){n.push(Ns(a,o,c))})})})}),n.join(`\r
`)+`\r
`},xr=Kd,Jm=Wm;Re.write=Jm;Re.parse=xr.parse;Re.parseParams=xr.parseParams;Re.parseFmtpConfig=xr.parseFmtpConfig;Re.parsePayloads=xr.parsePayloads;Re.parseRemoteCandidates=xr.parseRemoteCandidates;Re.parseImageAttributes=xr.parseImageAttributes;Re.parseSimulcastStreamList=xr.parseSimulcastStreamList;var xe={},Km=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Ym=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Qm=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Km(e,r,t);return Ym(e,r),e};Object.defineProperty(xe,"__esModule",{value:!0});xe.applyCodecParameters=xe.getCname=xe.extractDtlsParameters=xe.extractRtpCapabilities=void 0;const Xd=Qm(Re);function Xm({sdpObject:r}){const e=new Map,t=[];let s=!1,n=!1;for(const a of r.media){const o=a.type;switch(o){case"audio":{if(s)continue;s=!0;break}case"video":{if(n)continue;n=!0;break}default:continue}for(const c of a.rtp){const u={kind:o,mimeType:`${o}/${c.codec}`,preferredPayloadType:c.payload,clockRate:c.rate,channels:c.encoding,parameters:{},rtcpFeedback:[]};e.set(u.preferredPayloadType,u)}for(const c of a.fmtp||[]){const u=Xd.parseParams(c.config),l=e.get(c.payload);l&&(u&&u.hasOwnProperty("profile-level-id")&&(u["profile-level-id"]=String(u["profile-level-id"])),l.parameters=u)}for(const c of a.rtcpFb||[]){const u={type:c.type,parameter:c.subtype};if(u.parameter||delete u.parameter,c.payload!=="*"){const l=e.get(c.payload);if(!l)continue;l.rtcpFeedback.push(u)}else for(const l of e.values())l.kind===o&&!/.+\/rtx$/i.test(l.mimeType)&&l.rtcpFeedback.push(u)}for(const c of a.ext||[]){if(c["encrypt-uri"])continue;const u={kind:o,uri:c.uri,preferredId:c.value};t.push(u)}}return{codecs:Array.from(e.values()),headerExtensions:t}}xe.extractRtpCapabilities=Xm;function eg({sdpObject:r}){let e=r.setup,t=r.fingerprint;if(!e||!t){const i=(r.media||[]).find(a=>a.port!==0);i&&(e??(e=i.setup),t??(t=i.fingerprint))}if(e){if(!t)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let s;switch(e){case"active":s="client";break;case"passive":s="server";break;case"actpass":s="auto";break}return{role:s,fingerprints:[{algorithm:t.type,value:t.hash}]}}xe.extractDtlsParameters=eg;function tg({offerMediaObject:r}){const e=(r.ssrcs||[]).find(t=>t.attribute==="cname");return e?e.value:""}xe.getCname=tg;function rg({offerRtpParameters:r,answerMediaObject:e}){for(const t of r.codecs){const s=t.mimeType.toLowerCase();if(s!=="audio/opus"||!(e.rtp||[]).find(o=>o.payload===t.payloadType))continue;e.fmtp=e.fmtp||[];let i=e.fmtp.find(o=>o.payload===t.payloadType);i||(i={payload:t.payloadType,config:""},e.fmtp.push(i));const a=Xd.parseParams(i.config);switch(s){case"audio/opus":{const o=t.parameters["sprop-stereo"];o!==void 0&&(a.stereo=o?1:0);break}}i.config="";for(const o of Object.keys(a))i.config&&(i.config+=";"),i.config+=`${o}=${a[o]}`}}xe.applyCodecParameters=rg;var St={};Object.defineProperty(St,"__esModule",{value:!0});St.addLegacySimulcast=St.getRtpEncodings=void 0;function sg({offerMediaObject:r}){const e=new Set;for(const n of r.ssrcs||[]){const i=n.id;e.add(i)}if(e.size===0)throw new Error("no a=ssrc lines found");const t=new Map;for(const n of r.ssrcGroups||[]){if(n.semantics!=="FID")continue;let[i,a]=n.ssrcs.split(/\s+/);i=Number(i),a=Number(a),e.has(i)&&(e.delete(i),e.delete(a),t.set(i,a))}for(const n of e)t.set(n,null);const s=[];for(const[n,i]of t){const a={ssrc:n};i&&(a.rtx={ssrc:i}),s.push(a)}return s}St.getRtpEncodings=sg;function ng({offerMediaObject:r,numStreams:e}){if(e<=1)throw new TypeError("numStreams must be greater than 1");const t=(r.ssrcs||[]).find(d=>d.attribute==="msid");if(!t)throw new Error("a=ssrc line with msid information not found");const[s,n]=t.value.split(" "),i=t.id;let a;(r.ssrcGroups||[]).some(d=>{if(d.semantics!=="FID")return!1;const h=d.ssrcs.split(/\s+/);return Number(h[0])===i?(a=Number(h[1]),!0):!1});const o=r.ssrcs.find(d=>d.attribute==="cname");if(!o)throw new Error("a=ssrc line with cname information not found");const c=o.value,u=[],l=[];for(let d=0;d<e;++d)u.push(i+d),a&&l.push(a+d);r.ssrcGroups=[],r.ssrcs=[],r.ssrcGroups.push({semantics:"SIM",ssrcs:u.join(" ")});for(let d=0;d<u.length;++d){const h=u[d];r.ssrcs.push({id:h,attribute:"cname",value:c}),r.ssrcs.push({id:h,attribute:"msid",value:`${s} ${n}`})}for(let d=0;d<l.length;++d){const h=u[d],p=l[d];r.ssrcs.push({id:p,attribute:"cname",value:c}),r.ssrcs.push({id:p,attribute:"msid",value:`${s} ${n}`}),r.ssrcGroups.push({semantics:"FID",ssrcs:`${h} ${p}`})}}St.addLegacySimulcast=ng;var Pr={};Object.defineProperty(Pr,"__esModule",{value:!0});Pr.addNackSuppportForOpus=void 0;function ig(r){var e;for(const t of r.codecs||[])(t.mimeType.toLowerCase()==="audio/opus"||t.mimeType.toLowerCase()==="audio/multiopus")&&!((e=t.rtcpFeedback)!=null&&e.some(s=>s.type==="nack"&&!s.parameter))&&(t.rtcpFeedback||(t.rtcpFeedback=[]),t.rtcpFeedback.push({type:"nack"}))}Pr.addNackSuppportForOpus=ig;var Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.HandlerInterface=void 0;const ag=$t;class og extends ag.EnhancedEventEmitter{constructor(){super()}}Ue.HandlerInterface=og;var et={},pr={},cg=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),lg=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),eu=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&cg(e,r,t);return lg(e,r),e};Object.defineProperty(pr,"__esModule",{value:!0});pr.OfferMediaSection=pr.AnswerMediaSection=pr.MediaSection=void 0;const dg=eu(Re),Pc=eu(Se);class Co{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:s,planB:n=!1}){if(this._mediaObject={},this._planB=n,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const i of t){const a={};a.component=1,a.foundation=i.foundation,a.ip=i.ip,a.port=i.port,a.priority=i.priority,a.transport=i.protocol,a.type=i.type,i.tcpType&&(a.tcptype=i.tcpType),this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}s&&this.setDtlsRole(s.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}pr.MediaSection=Co;class ug extends Co{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:n,plainRtpParameters:i,planB:a=!1,offerMediaObject:o,offerRtpParameters:c,answerRtpParameters:u,codecOptions:l,extmapAllowMixed:d=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:s,planB:a}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const h of u.codecs){const p={payload:h.payloadType,codec:Xa(h),rate:h.clockRate};h.channels>1&&(p.encoding=h.channels),this._mediaObject.rtp.push(p);const f=Pc.clone(h.parameters)??{};let _=Pc.clone(h.rtcpFeedback)??[];if(l){const{opusStereo:k,opusFec:P,opusDtx:D,opusMaxPlaybackRate:C,opusMaxAverageBitrate:y,opusPtime:R,opusNack:Y,videoGoogleStartBitrate:de,videoGoogleMaxBitrate:Me,videoGoogleMinBitrate:_e}=l,pe=c.codecs.find(ue=>ue.payloadType===h.payloadType);switch(h.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{k!==void 0&&(pe.parameters["sprop-stereo"]=k?1:0,f.stereo=k?1:0),P!==void 0&&(pe.parameters.useinbandfec=P?1:0,f.useinbandfec=P?1:0),D!==void 0&&(pe.parameters.usedtx=D?1:0,f.usedtx=D?1:0),C!==void 0&&(f.maxplaybackrate=C),y!==void 0&&(f.maxaveragebitrate=y),R!==void 0&&(pe.parameters.ptime=R,f.ptime=R),Y||(pe.rtcpFeedback=pe.rtcpFeedback.filter(ue=>ue.type!=="nack"||ue.parameter),_=_.filter(ue=>ue.type!=="nack"||ue.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{de!==void 0&&(f["x-google-start-bitrate"]=de),Me!==void 0&&(f["x-google-max-bitrate"]=Me),_e!==void 0&&(f["x-google-min-bitrate"]=_e);break}}}const g={payload:h.payloadType,config:""};for(const k of Object.keys(f))g.config&&(g.config+=";"),g.config+=`${k}=${f[k]}`;g.config&&this._mediaObject.fmtp.push(g);for(const k of _)this._mediaObject.rtcpFb.push({payload:h.payloadType,type:k.type,subtype:k.parameter})}this._mediaObject.payloads=u.codecs.map(h=>h.payloadType).join(" "),this._mediaObject.ext=[];for(const h of u.headerExtensions)(o.ext||[]).some(f=>f.uri===h.uri)&&this._mediaObject.ext.push({uri:h.uri,value:h.id});if(d&&o.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const h of o.rids||[])h.direction==="send"&&this._mediaObject.rids.push({id:h.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const h of o.rids||[])h.direction==="send"&&this._mediaObject.rids.push({id:h.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof o.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize});break}}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass";break}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){var i;if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;const t={};for(const a of e)a.rid&&(t[a.rid]=a);const s=this._mediaObject.simulcast.list1,n=dg.parseSimulcastStreamList(s);for(const a of n)for(const o of a)o.paused=!((i=t[o.scid])!=null&&i.active);this._mediaObject.simulcast.list1=n.map(a=>a.map(o=>`${o.paused?"~":""}${o.scid}`).join(",")).join(";")}}pr.AnswerMediaSection=ug;class hg extends Co{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:n,plainRtpParameters:i,planB:a=!1,mid:o,kind:c,offerRtpParameters:u,streamId:l,trackId:d,oldDataChannelSpec:h=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:s,planB:a}),this._mediaObject.mid=String(o),this._mediaObject.type=c,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},n?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),c){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${l||"-"} ${d}`);for(const g of u.codecs){const k={payload:g.payloadType,codec:Xa(g),rate:g.clockRate};g.channels>1&&(k.encoding=g.channels),this._mediaObject.rtp.push(k);const P={payload:g.payloadType,config:""};for(const D of Object.keys(g.parameters))P.config&&(P.config+=";"),P.config+=`${D}=${g.parameters[D]}`;P.config&&this._mediaObject.fmtp.push(P);for(const D of g.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:g.payloadType,type:D.type,subtype:D.parameter})}this._mediaObject.payloads=u.codecs.map(g=>g.payloadType).join(" "),this._mediaObject.ext=[];for(const g of u.headerExtensions)this._mediaObject.ext.push({uri:g.uri,value:g.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const p=u.encodings[0],f=p.ssrc,_=p.rtx&&p.rtx.ssrc?p.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],u.rtcp.cname&&this._mediaObject.ssrcs.push({id:f,attribute:"cname",value:u.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:f,attribute:"msid",value:`${l||"-"} ${d}`}),_&&(u.rtcp.cname&&this._mediaObject.ssrcs.push({id:_,attribute:"cname",value:u.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:_,attribute:"msid",value:`${l||"-"} ${d}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${f} ${_}`}));break}case"application":{h?(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize);break}}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:t,trackId:s}){const n=e.encodings[0],i=n.ssrc,a=n.rtx&&n.rtx.ssrc?n.rtx.ssrc:void 0,o=this._mediaObject.payloads.split(" ");for(const c of e.codecs){if(o.includes(String(c.payloadType)))continue;const u={payload:c.payloadType,codec:Xa(c),rate:c.clockRate};c.channels>1&&(u.encoding=c.channels),this._mediaObject.rtp.push(u);const l={payload:c.payloadType,config:""};for(const d of Object.keys(c.parameters))l.config&&(l.config+=";"),l.config+=`${d}=${c.parameters[d]}`;l.config&&this._mediaObject.fmtp.push(l);for(const d of c.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:c.payloadType,type:d.type,subtype:d.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter(c=>!this._mediaObject.payloads.includes(c.payloadType)).map(c=>c.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${t||"-"} ${s}`}),a&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${t||"-"} ${s}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${i} ${a}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],s=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(i=>i.id!==s&&i.id!==n),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(i=>i.ssrcs!==`${s} ${n}`))}}pr.OfferMediaSection=hg;function Xa(r){const t=new RegExp("^(audio|video)/(.+)","i").exec(r.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}var pg=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),fg=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),mg=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&pg(e,r,t);return fg(e,r),e};Object.defineProperty(et,"__esModule",{value:!0});et.RemoteSdp=void 0;const gg=mg(Re),_g=ve,kn=pr,la=new _g.Logger("RemoteSdp");class wg{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:n,plainRtpParameters:i,planB:a=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=s,this._sctpParameters=n,this._plainRtpParameters=i,this._planB=a,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),s){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const o=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:s.fingerprints[o-1].algorithm,hash:s.fingerprints[o-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}i&&(this._sdpObject.origin.address=i.ip,this._sdpObject.origin.ipVer=i.ipVersion)}updateIceParameters(e){la.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){la.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:s,answerRtpParameters:n,codecOptions:i,extmapAllowMixed:a=!1}){const o=new kn.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:s,answerRtpParameters:n,codecOptions:i,extmapAllowMixed:a});t?this._replaceMediaSection(o,t):this._midToIndex.has(o.mid)?this._replaceMediaSection(o):this._addMediaSection(o)}receive({mid:e,kind:t,offerRtpParameters:s,streamId:n,trackId:i}){const a=this._midToIndex.get(e);let o;if(a!==void 0&&(o=this._mediaSections[a]),o)o.planBReceive({offerRtpParameters:s,streamId:n,trackId:i}),this._replaceMediaSection(o);else{o=new kn.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:s,streamId:n,trackId:i});const c=this._mediaSections.find(u=>u.closed);c?this._replaceMediaSection(o,c.mid):this._addMediaSection(o)}}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){const t=this._findMediaSection(e);return e===this._firstMid?(la.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,t){const s=this._findMediaSection(e);s.muxSimulcastStreams(t),this._replaceMediaSection(s)}planBStopReceiving({mid:e,offerRtpParameters:t}){const s=this._findMediaSection(e);s.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(s)}sendSctpAssociation({offerMediaObject:e}){const t=new kn.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new kn.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,gg.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if(typeof t=="string"){const s=this._midToIndex.get(t);if(s===void 0)throw new Error(`no media section found for reuseMid '${t}'`);const n=this._mediaSections[s];this._mediaSections[s]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,s),this._sdpObject.media[s]=e.getObject(),this._regenerateBundleMids()}else{const s=this._midToIndex.get(e.mid);if(s===void 0)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[s]=e,this._sdpObject.media[s]=e.getObject()}}_findMediaSection(e){const t=this._midToIndex.get(e);if(t===void 0)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}}et.RemoteSdp=wg;var Ft={};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.parse=void 0;const yg=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function bg(r){const e=yg.exec(r||"");return e?{spatialLayers:Number(e[1]),temporalLayers:Number(e[2])}:{spatialLayers:1,temporalLayers:1}}Ft.parse=bg;var vg=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Sg=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),gs=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&vg(e,r,t);return Sg(e,r),e};Object.defineProperty(_i,"__esModule",{value:!0});_i.Chrome111=void 0;const nr=gs(Re),Rg=ve,Mc=gs(Se),Gr=gs(M),On=gs(xe),Ic=gs(St),Tg=gs(Pr),Cg=Pe,Dg=Ue,Eg=et,kg=Ft,j=new Rg.Logger("Chrome111"),Lc={OS:1024,MIS:1024};class Do extends Dg.HandlerInterface{static createFactory(){return()=>new Do}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(j.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){j.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const s=nr.parse(t.sdp),n=On.extractRtpCapabilities({sdpObject:s});return Tg.addNackSuppportForOpus(n),n}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return j.debug("getNativeSctpCapabilities()"),{numStreams:Lc}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){this.assertNotClosed(),j.debug("run()"),this._direction=e,this._remoteSdp=new Eg.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Gr.getSendingRtpParameters("audio",l),video:Gr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Gr.getSendingRemoteRtpParameters("audio",l),video:Gr.getSendingRemoteRtpParameters("video",l)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(j.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}))}async updateIceServers(e){this.assertNotClosed(),j.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),j.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});j.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();j.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){if(this.assertNotClosed(),this.assertSendDirection(),j.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){t.forEach((g,k)=>{g.rid=`r${k}`});let f=1,_=1;for(const g of t){const k=g.scalabilityMode?(0,kg.parse)(g.scalabilityMode).temporalLayers:3;k>_&&(_=k)}for(const g of t)g.rid=`r${f++}`,g.scalabilityMode=`L1T${_}`}const i=Mc.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=Gr.reduceCodecs(i.codecs,n);const a=Mc.clone(this._sendingRemoteRtpParametersByKind[e.kind]);a.codecs=Gr.reduceCodecs(a.codecs,n);const o=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),u=await this._pc.createOffer();let l=nr.parse(u.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),j.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const d=c.mid;i.mid=d,l=nr.parse(this._pc.localDescription.sdp);const h=l.media[o.idx];if(i.rtcp.cname=On.getCname({offerMediaObject:h}),!t)i.encodings=Ic.getRtpEncodings({offerMediaObject:h});else if(t.length===1){const f=Ic.getRtpEncodings({offerMediaObject:h});Object.assign(f[0],t[0]),i.encodings=f}else i.encodings=t;this._remoteSdp.send({offerMediaObject:h,reuseMid:o.reuseMid,offerRtpParameters:i,answerRtpParameters:a,codecOptions:s,extmapAllowMixed:!0});const p={type:"answer",sdp:this._remoteSdp.getSdp()};return j.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._mapMidTransceiver.set(d,c),{localId:d,rtpParameters:i,rtpSender:c.sender}}async stopSending(e){if(this.assertSendDirection(),j.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const n=await this._pc.createOffer();j.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),j.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const s=await this._pc.createOffer();j.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),j.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const s=await this._pc.createOffer();j.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?j.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):j.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),j.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{c<=t?o.active=!0:o.active=!1}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();j.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),j.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{n.encodings[c]={...o,...t}}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();j.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:i};j.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Lc.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=nr.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),j.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],s=new Map;for(const o of e){const{trackId:c,kind:u,rtpParameters:l,streamId:d}=o;j.debug("receive() [trackId:%s, kind:%s]",c,u);const h=l.mid||String(this._mapMidTransceiver.size);s.set(c,h),this._remoteSdp.receive({mid:h,kind:u,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:c})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=nr.parse(i.sdp);for(const o of e){const{trackId:c,rtpParameters:u}=o,l=s.get(c),d=a.media.find(h=>String(h.mid)===l);On.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d})}i={type:"answer",sdp:nr.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),j.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{trackId:c}=o,u=s.get(c),l=this._pc.getTransceivers().find(d=>d.mid===u);if(l)this._mapMidTransceiver.set(u,l),t.push({localId:u,track:l.receiver.track,rtpReceiver:l.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){j.debug("stopReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(i.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();j.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){j.debug("pauseReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();j.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){j.debug("resumeReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();j.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:s};j.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=nr.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=nr.parse(this._pc.localDescription.sdp));const s=On.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Cg.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}_i.Chrome111=Do;var wi={},Og=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),xg=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),_s=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Og(e,r,t);return xg(e,r),e};Object.defineProperty(wi,"__esModule",{value:!0});wi.Chrome74=void 0;const Ot=_s(Re),Pg=ve,Nc=_s(Se),Zr=_s(M),xn=_s(xe),da=_s(St),Mg=_s(Pr),Ig=Pe,Lg=Ue,Ng=et,Ag=Ft,N=new Pg.Logger("Chrome74"),Ac={OS:1024,MIS:1024};class Eo extends Lg.HandlerInterface{static createFactory(){return()=>new Eo}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(N.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){N.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const s=Ot.parse(t.sdp),n=xn.extractRtpCapabilities({sdpObject:s});return Mg.addNackSuppportForOpus(n),n}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return N.debug("getNativeSctpCapabilities()"),{numStreams:Ac}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){N.debug("run()"),this._direction=e,this._remoteSdp=new Ng.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Zr.getSendingRtpParameters("audio",l),video:Zr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Zr.getSendingRemoteRtpParameters("audio",l),video:Zr.getSendingRemoteRtpParameters("video",l)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(N.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}))}async updateIceServers(e){this.assertNotClosed(),N.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),N.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});N.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};N.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};N.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();N.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){this.assertNotClosed(),this.assertSendDirection(),N.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((g,k)=>{g.rid=`r${k}`});const i=Nc.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=Zr.reduceCodecs(i.codecs,n);const a=Nc.clone(this._sendingRemoteRtpParametersByKind[e.kind]);a.codecs=Zr.reduceCodecs(a.codecs,n);const o=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let u=await this._pc.createOffer(),l=Ot.parse(u.sdp),d;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l});let h=!1;const p=(0,Ag.parse)((t||[{}])[0].scalabilityMode);t&&t.length===1&&p.spatialLayers>1&&i.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(N.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,l=Ot.parse(u.sdp),d=l.media[o.idx],da.addLegacySimulcast({offerMediaObject:d,numStreams:p.spatialLayers}),u={type:"offer",sdp:Ot.write(l)}),N.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const f=c.mid;if(i.mid=f,l=Ot.parse(this._pc.localDescription.sdp),d=l.media[o.idx],i.rtcp.cname=xn.getCname({offerMediaObject:d}),!t)i.encodings=da.getRtpEncodings({offerMediaObject:d});else if(t.length===1){let g=da.getRtpEncodings({offerMediaObject:d});Object.assign(g[0],t[0]),h&&(g=[g[0]]),i.encodings=g}else i.encodings=t;if(i.encodings.length>1&&(i.codecs[0].mimeType.toLowerCase()==="video/vp8"||i.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const g of i.encodings)g.scalabilityMode?g.scalabilityMode=`L1T${p.temporalLayers}`:g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:o.reuseMid,offerRtpParameters:i,answerRtpParameters:a,codecOptions:s,extmapAllowMixed:!0});const _={type:"answer",sdp:this._remoteSdp.getSdp()};return N.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(f,c),{localId:f,rtpParameters:i,rtpSender:c.sender}}async stopSending(e){if(this.assertSendDirection(),N.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const n=await this._pc.createOffer();N.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};N.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),N.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const s=await this._pc.createOffer();N.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};N.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),N.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const s=await this._pc.createOffer();N.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};N.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?N.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):N.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),N.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{c<=t?o.active=!0:o.active=!1}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();N.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};N.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),N.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{n.encodings[c]={...o,...t}}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();N.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};N.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:i};N.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Ac.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=Ot.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),N.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};N.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],s=new Map;for(const o of e){const{trackId:c,kind:u,rtpParameters:l,streamId:d}=o;N.debug("receive() [trackId:%s, kind:%s]",c,u);const h=l.mid||String(this._mapMidTransceiver.size);s.set(c,h),this._remoteSdp.receive({mid:h,kind:u,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:c})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};N.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=Ot.parse(i.sdp);for(const o of e){const{trackId:c,rtpParameters:u}=o,l=s.get(c),d=a.media.find(h=>String(h.mid)===l);xn.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d})}i={type:"answer",sdp:Ot.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),N.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{trackId:c}=o,u=s.get(c),l=this._pc.getTransceivers().find(d=>d.mid===u);if(l)this._mapMidTransceiver.set(u,l),t.push({localId:u,track:l.receiver.track,rtpReceiver:l.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){N.debug("stopReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(i.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};N.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();N.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){N.debug("pauseReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};N.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();N.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){N.debug("resumeReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};N.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();N.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:s};N.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};N.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=Ot.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}N.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Ot.parse(this._pc.localDescription.sdp));const s=xn.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Ig.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}wi.Chrome74=Eo;var yi={},jg=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),$g=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),an=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&jg(e,r,t);return $g(e,r),e};Object.defineProperty(yi,"__esModule",{value:!0});yi.Chrome70=void 0;const nt=an(Re),Fg=ve,jc=an(Se),Wr=an(M),Pn=an(xe),ua=an(St),Ug=Ue,qg=et,Bg=Ft,z=new Fg.Logger("Chrome70"),$c={OS:1024,MIS:1024};class ko extends Ug.HandlerInterface{static createFactory(){return()=>new ko}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(z.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){z.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const s=nt.parse(t.sdp);return Pn.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return z.debug("getNativeSctpCapabilities()"),{numStreams:$c}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){z.debug("run()"),this._direction=e,this._remoteSdp=new qg.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Wr.getSendingRtpParameters("audio",l),video:Wr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Wr.getSendingRemoteRtpParameters("audio",l),video:Wr.getSendingRemoteRtpParameters("video",l)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(z.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){z.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(z.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});z.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};z.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};z.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();z.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){this.assertSendDirection(),z.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const i=jc.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=Wr.reduceCodecs(i.codecs,n);const a=jc.clone(this._sendingRemoteRtpParametersByKind[e.kind]);a.codecs=Wr.reduceCodecs(a.codecs,n);const o=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let u=await this._pc.createOffer(),l=nt.parse(u.sdp),d;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),t&&t.length>1&&(z.debug("send() | enabling legacy simulcast"),l=nt.parse(u.sdp),d=l.media[o.idx],ua.addLegacySimulcast({offerMediaObject:d,numStreams:t.length}),u={type:"offer",sdp:nt.write(l)});let h=!1;const p=(0,Bg.parse)((t||[{}])[0].scalabilityMode);if(t&&t.length===1&&p.spatialLayers>1&&i.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(z.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,l=nt.parse(u.sdp),d=l.media[o.idx],ua.addLegacySimulcast({offerMediaObject:d,numStreams:p.spatialLayers}),u={type:"offer",sdp:nt.write(l)}),z.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),t){z.debug("send() | applying given encodings");const g=c.sender.getParameters();for(let k=0;k<(g.encodings||[]).length;++k){const P=g.encodings[k],D=t[k];if(!D)break;g.encodings[k]=Object.assign(P,D)}await c.sender.setParameters(g)}const f=c.mid;if(i.mid=f,l=nt.parse(this._pc.localDescription.sdp),d=l.media[o.idx],i.rtcp.cname=Pn.getCname({offerMediaObject:d}),i.encodings=ua.getRtpEncodings({offerMediaObject:d}),t)for(let g=0;g<i.encodings.length;++g)t[g]&&Object.assign(i.encodings[g],t[g]);if(h&&(i.encodings=[i.encodings[0]]),i.encodings.length>1&&(i.codecs[0].mimeType.toLowerCase()==="video/vp8"||i.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const g of i.encodings)g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:o.reuseMid,offerRtpParameters:i,answerRtpParameters:a,codecOptions:s});const _={type:"answer",sdp:this._remoteSdp.getSdp()};return z.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(f,c),{localId:f,rtpParameters:i,rtpSender:c.sender}}async stopSending(e){this.assertSendDirection(),z.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const n=await this._pc.createOffer();z.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};z.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?z.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):z.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),z.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{c<=t?o.active=!0:o.active=!1}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();z.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};z.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),z.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{n.encodings[c]={...o,...t}}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();z.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};z.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:s,protocol:i};z.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$c.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=nt.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),z.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};z.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[],s=new Map;for(const o of e){const{trackId:c,kind:u,rtpParameters:l,streamId:d}=o;z.debug("receive() [trackId:%s, kind:%s]",c,u);const h=l.mid||String(this._mapMidTransceiver.size);s.set(c,h),this._remoteSdp.receive({mid:h,kind:u,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:c})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};z.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=nt.parse(i.sdp);for(const o of e){const{trackId:c,rtpParameters:u}=o,l=s.get(c),d=a.media.find(h=>String(h.mid)===l);Pn.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d})}i={type:"answer",sdp:nt.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),z.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{trackId:c}=o,u=s.get(c),l=this._pc.getTransceivers().find(d=>d.mid===u);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(u,l),t.push({localId:u,track:l.receiver.track,rtpReceiver:l.receiver})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){z.debug("stopReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(i.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};z.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();z.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:s};z.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};z.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=nt.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}z.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=nt.parse(this._pc.localDescription.sdp));const s=Pn.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}yi.Chrome70=ko;var bi={},Kt={};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.addLegacySimulcast=Kt.getRtpEncodings=void 0;function zg({offerMediaObject:r,track:e}){const t=new Set;for(const i of r.ssrcs||[]){if(i.attribute!=="msid")continue;if(i.value.split(" ")[1]===e.id){const o=i.id;t.add(o)}}if(t.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${e.id}]`);const s=new Map;for(const i of r.ssrcGroups||[]){if(i.semantics!=="FID")continue;let[a,o]=i.ssrcs.split(/\s+/);a=Number(a),o=Number(o),t.has(a)&&(t.delete(a),t.delete(o),s.set(a,o))}for(const i of t)s.set(i,null);const n=[];for(const[i,a]of s){const o={ssrc:i};a&&(o.rtx={ssrc:a}),n.push(o)}return n}Kt.getRtpEncodings=zg;function Vg({offerMediaObject:r,track:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");let s,n,i;if(!(r.ssrcs||[]).find(d=>d.attribute!=="msid"?!1:d.value.split(" ")[1]===e.id?(s=d.id,i=d.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${e.id}]`);(r.ssrcGroups||[]).some(d=>{if(d.semantics!=="FID")return!1;const h=d.ssrcs.split(/\s+/);return Number(h[0])===s?(n=Number(h[1]),!0):!1});const o=r.ssrcs.find(d=>d.attribute==="cname"&&d.id===s);if(!o)throw new Error(`a=ssrc line with cname information not found [track.id:${e.id}]`);const c=o.value,u=[],l=[];for(let d=0;d<t;++d)u.push(s+d),n&&l.push(n+d);r.ssrcGroups=r.ssrcGroups||[],r.ssrcs=r.ssrcs||[],r.ssrcGroups.push({semantics:"SIM",ssrcs:u.join(" ")});for(let d=0;d<u.length;++d){const h=u[d];r.ssrcs.push({id:h,attribute:"cname",value:c}),r.ssrcs.push({id:h,attribute:"msid",value:`${i} ${e.id}`})}for(let d=0;d<l.length;++d){const h=u[d],p=l[d];r.ssrcs.push({id:p,attribute:"cname",value:c}),r.ssrcs.push({id:p,attribute:"msid",value:`${i} ${e.id}`}),r.ssrcGroups.push({semantics:"FID",ssrcs:`${h} ${p}`})}}Kt.addLegacySimulcast=Vg;var Hg=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Gg=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),on=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Hg(e,r,t);return Gg(e,r),e};Object.defineProperty(bi,"__esModule",{value:!0});bi.Chrome67=void 0;const xt=on(Re),Zg=ve,Fc=on(Se),Jr=on(M),Mn=on(xe),Uc=on(Kt),Wg=Ue,Jg=et,G=new Zg.Logger("Chrome67"),qc={OS:1024,MIS:1024};class Oo extends Wg.HandlerInterface{static createFactory(){return()=>new Oo}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(G.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){G.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}const s=xt.parse(t.sdp);return Mn.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return G.debug("getNativeSctpCapabilities()"),{numStreams:qc}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){G.debug("run()"),this._direction=e,this._remoteSdp=new Jg.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:Jr.getSendingRtpParameters("audio",l),video:Jr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Jr.getSendingRemoteRtpParameters("audio",l),video:Jr.getSendingRemoteRtpParameters("video",l)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(G.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){G.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(G.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});G.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();G.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){this.assertSendDirection(),G.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&G.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let i=await this._pc.createOffer(),a=xt.parse(i.sdp),o;const c=Fc.clone(this._sendingRtpParametersByKind[e.kind]);c.codecs=Jr.reduceCodecs(c.codecs);const u=Fc.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(u.codecs=Jr.reduceCodecs(u.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),e.kind==="video"&&t&&t.length>1&&(G.debug("send() | enabling simulcast"),a=xt.parse(i.sdp),o=a.media.find(p=>p.type==="video"),Uc.addLegacySimulcast({offerMediaObject:o,track:e,numStreams:t.length}),i={type:"offer",sdp:xt.write(a)}),G.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),a=xt.parse(this._pc.localDescription.sdp),o=a.media.find(p=>p.type===e.kind),c.rtcp.cname=Mn.getCname({offerMediaObject:o}),c.encodings=Uc.getRtpEncodings({offerMediaObject:o,track:e}),t)for(let p=0;p<c.encodings.length;++p)t[p]&&Object.assign(c.encodings[p],t[p]);if(c.encodings.length>1&&c.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const p of c.encodings)p.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:o,offerRtpParameters:c,answerRtpParameters:u,codecOptions:s});const l={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const d=String(this._nextSendLocalId);this._nextSendLocalId++;const h=this._pc.getSenders().find(p=>p.track===e);return this._mapSendLocalIdRtpSender.set(d,h),{localId:d,rtpParameters:c,rtpSender:h}}async stopSending(e){this.assertSendDirection(),G.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const s=await this._pc.createOffer();G.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(i){if(this._sendStream.getTracks().length===0){G.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if(this._pc.signalingState==="stable")return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?G.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):G.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");const n=s.track;await s.replaceTrack(t),n&&this._sendStream.removeTrack(n),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),G.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");const n=s.getParameters();n.encodings.forEach((i,a)=>{a<=t?i.active=!0:i.active=!1}),await s.setParameters(n)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),G.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");const n=s.getParameters();n.encodings.forEach((i,a)=>{n.encodings[a]={...i,...t}}),await s.setParameters(n)}async getSenderStats(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:s,protocol:i};G.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%qc.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=xt.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),G.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};G.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[];for(const a of e){const{trackId:o,kind:c,rtpParameters:u,streamId:l}=a;G.debug("receive() [trackId:%s, kind:%s]",o,c);const d=c;this._remoteSdp.receive({mid:d,kind:c,offerRtpParameters:u,streamId:l||u.rtcp.cname,trackId:o})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let n=await this._pc.createAnswer();const i=xt.parse(n.sdp);for(const a of e){const{kind:o,rtpParameters:c}=a,u=o,l=i.media.find(d=>String(d.mid)===u);Mn.applyCodecParameters({offerRtpParameters:c,answerMediaObject:l})}n={type:"answer",sdp:xt.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),G.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const a of e){const{kind:o,trackId:c,rtpParameters:u}=a,l=c,d=o,h=this._pc.getReceivers().find(p=>p.track&&p.track.id===l);if(!h)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(l,{mid:d,rtpParameters:u,rtpReceiver:h}),t.push({localId:l,track:h.track,rtpReceiver:h})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){G.debug("stopReceiving() [localId:%s]",n);const{mid:i,rtpParameters:a}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:i,offerRtpParameters:a})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();G.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:s};G.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};G.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=xt.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}G.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=xt.parse(this._pc.localDescription.sdp));const s=Mn.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}bi.Chrome67=Oo;var vi={},Kg=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Yg=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),cn=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Kg(e,r,t);return Yg(e,r),e};Object.defineProperty(vi,"__esModule",{value:!0});vi.Chrome55=void 0;const Pt=cn(Re),Qg=ve,As=Pe,Bc=cn(Se),Kr=cn(M),In=cn(xe),zc=cn(Kt),Xg=Ue,e_=et,re=new Qg.Logger("Chrome55"),Vc={OS:1024,MIS:1024};class xo extends Xg.HandlerInterface{static createFactory(){return()=>new xo}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(re.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){re.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}const s=Pt.parse(t.sdp);return In.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return re.debug("getNativeSctpCapabilities()"),{numStreams:Vc}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){re.debug("run()"),this._direction=e,this._remoteSdp=new e_.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:Kr.getSendingRtpParameters("audio",l),video:Kr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Kr.getSendingRemoteRtpParameters("audio",l),video:Kr.getSendingRemoteRtpParameters("video",l)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(re.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){re.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(re.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});re.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};re.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};re.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();re.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){this.assertSendDirection(),re.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&re.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let i=await this._pc.createOffer(),a=Pt.parse(i.sdp),o;const c=Bc.clone(this._sendingRtpParametersByKind[e.kind]);c.codecs=Kr.reduceCodecs(c.codecs);const u=Bc.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(u.codecs=Kr.reduceCodecs(u.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),e.kind==="video"&&t&&t.length>1&&(re.debug("send() | enabling simulcast"),a=Pt.parse(i.sdp),o=a.media.find(h=>h.type==="video"),zc.addLegacySimulcast({offerMediaObject:o,track:e,numStreams:t.length}),i={type:"offer",sdp:Pt.write(a)}),re.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),a=Pt.parse(this._pc.localDescription.sdp),o=a.media.find(h=>h.type===e.kind),c.rtcp.cname=In.getCname({offerMediaObject:o}),c.encodings=zc.getRtpEncodings({offerMediaObject:o,track:e}),t)for(let h=0;h<c.encodings.length;++h)t[h]&&Object.assign(c.encodings[h],t[h]);if(c.encodings.length>1&&c.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const h of c.encodings)h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:o,offerRtpParameters:c,answerRtpParameters:u,codecOptions:s});const l={type:"answer",sdp:this._remoteSdp.getSdp()};re.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const d=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(d,e),{localId:d,rtpParameters:c}}async stopSending(e){this.assertSendDirection(),re.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const s=await this._pc.createOffer();re.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(i){if(this._sendStream.getTracks().length===0){re.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if(this._pc.signalingState==="stable")return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};re.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new As.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new As.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new As.UnsupportedError("not supported")}async getSenderStats(e){throw new As.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:s,protocol:i};re.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Vc.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=Pt.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),re.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};re.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[];for(const a of e){const{trackId:o,kind:c,rtpParameters:u,streamId:l}=a;re.debug("receive() [trackId:%s, kind:%s]",o,c);const d=c;this._remoteSdp.receive({mid:d,kind:c,offerRtpParameters:u,streamId:l||u.rtcp.cname,trackId:o})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};re.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let n=await this._pc.createAnswer();const i=Pt.parse(n.sdp);for(const a of e){const{kind:o,rtpParameters:c}=a,u=o,l=i.media.find(d=>String(d.mid)===u);In.applyCodecParameters({offerRtpParameters:c,answerMediaObject:l})}n={type:"answer",sdp:Pt.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),re.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const a of e){const{kind:o,trackId:c,rtpParameters:u}=a,l=o,d=c,h=a.streamId||u.rtcp.cname,f=this._pc.getRemoteStreams().find(_=>_.id===h).getTrackById(d);if(!f)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(d,{mid:l,rtpParameters:u}),t.push({localId:d,track:f})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){re.debug("stopReceiving() [localId:%s]",n);const{mid:i,rtpParameters:a}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:i,offerRtpParameters:a})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};re.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();re.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new As.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:s};re.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};re.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=Pt.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}re.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Pt.parse(this._pc.localDescription.sdp));const s=In.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}vi.Chrome55=xo;var Si={},t_=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),r_=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ln=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&t_(e,r,t);return r_(e,r),e};Object.defineProperty(Si,"__esModule",{value:!0});Si.Firefox60=void 0;const ir=ln(Re),s_=ve,Hc=Pe,ha=ln(Se),Yr=ln(M),Ln=ln(xe),Gc=ln(St),n_=Ue,i_=et,a_=Ft,F=new s_.Logger("Firefox60"),Zc={OS:16,MIS:2048};class Po extends n_.HandlerInterface{static createFactory(){return()=>new Po}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(F.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){F.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const n=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const i=e.addTransceiver(n,{direction:"sendrecv"}),a=i.sender.getParameters(),o=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];a.encodings=o,await i.sender.setParameters(a);const c=await e.createOffer();try{t.remove()}catch{}try{n.stop()}catch{}try{e.close()}catch{}const u=ir.parse(c.sdp);return Ln.extractRtpCapabilities({sdpObject:u})}catch(i){try{t.remove()}catch{}try{n.stop()}catch{}try{e.close()}catch{}throw i}}async getNativeSctpCapabilities(){return F.debug("getNativeSctpCapabilities()"),{numStreams:Zc}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){this.assertNotClosed(),F.debug("run()"),this._direction=e,this._remoteSdp=new i_.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Yr.getSendingRtpParameters("audio",l),video:Yr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Yr.getSendingRemoteRtpParameters("audio",l),video:Yr.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(F.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){throw this.assertNotClosed(),new Hc.UnsupportedError("not supported")}async restartIce(e){if(this.assertNotClosed(),F.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});F.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();F.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){this.assertNotClosed(),this.assertSendDirection(),F.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=ha.clone(t),t.length>1&&(t.forEach((f,_)=>{f.rid=`r${_}`}),t.reverse()));const i=ha.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=Yr.reduceCodecs(i.codecs,n);const a=ha.clone(this._sendingRemoteRtpParametersByKind[e.kind]);a.codecs=Yr.reduceCodecs(a.codecs,n);const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const f=o.sender.getParameters();f.encodings=t,await o.sender.setParameters(f)}const c=await this._pc.createOffer();let u=ir.parse(c.sdp);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:u});const l=(0,a_.parse)((t||[{}])[0].scalabilityMode);F.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const d=o.mid;i.mid=d,u=ir.parse(this._pc.localDescription.sdp);const h=u.media[u.media.length-1];if(i.rtcp.cname=Ln.getCname({offerMediaObject:h}),!t)i.encodings=Gc.getRtpEncodings({offerMediaObject:h});else if(t.length===1){const f=Gc.getRtpEncodings({offerMediaObject:h});Object.assign(f[0],t[0]),i.encodings=f}else i.encodings=t.reverse();if(i.encodings.length>1&&(i.codecs[0].mimeType.toLowerCase()==="video/vp8"||i.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const f of i.encodings)f.scalabilityMode?f.scalabilityMode=`L1T${l.temporalLayers}`:f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:h,offerRtpParameters:i,answerRtpParameters:a,codecOptions:s,extmapAllowMixed:!0});const p={type:"answer",sdp:this._remoteSdp.getSdp()};return F.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p),this._mapMidTransceiver.set(d,o),{localId:d,rtpParameters:i,rtpSender:o.sender}}async stopSending(e){if(this.assertSendDirection(),F.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const s=await this._pc.createOffer();F.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),F.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const s=await this._pc.createOffer();F.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),F.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const s=await this._pc.createOffer();F.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?F.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):F.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),F.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated transceiver not found");const n=s.sender.getParameters();t=n.encodings.length-1-t,n.encodings.forEach((o,c)=>{c>=t?o.active=!0:o.active=!1}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();F.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),F.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{n.encodings[c]={...o,...t}}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();F.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:i};F.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Zc.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=ir.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l}),F.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],s=new Map;for(const o of e){const{trackId:c,kind:u,rtpParameters:l,streamId:d}=o;F.debug("receive() [trackId:%s, kind:%s]",c,u);const h=l.mid||String(this._mapMidTransceiver.size);s.set(c,h),this._remoteSdp.receive({mid:h,kind:u,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:c})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=ir.parse(i.sdp);for(const o of e){const{trackId:c,rtpParameters:u}=o,l=s.get(c),d=a.media.find(h=>String(h.mid)===l);Ln.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d}),i={type:"answer",sdp:ir.write(a)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:a}),F.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{trackId:c}=o,u=s.get(c),l=this._pc.getTransceivers().find(d=>d.mid===u);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(u,l),t.push({localId:u,track:l.receiver.track,rtpReceiver:l.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){F.debug("stopReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(i.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();F.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){F.debug("pauseReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();F.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){F.debug("resumeReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();F.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:s};F.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=ir.parse(d.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:h})}F.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=ir.parse(this._pc.localDescription.sdp));const s=Ln.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Hc.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Si.Firefox60=Po;var Ri={},o_=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),c_=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ws=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&o_(e,r,t);return c_(e,r),e};Object.defineProperty(Ri,"__esModule",{value:!0});Ri.Safari12=void 0;const Mt=ws(Re),l_=ve,Wc=ws(Se),Qr=ws(M),Nn=ws(xe),Jc=ws(St),d_=ws(Pr),u_=Pe,h_=Ue,p_=et,f_=Ft,A=new l_.Logger("Safari12"),Kc={OS:1024,MIS:1024};class Mo extends h_.HandlerInterface{static createFactory(){return()=>new Mo}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(A.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){A.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const s=Mt.parse(t.sdp),n=Nn.extractRtpCapabilities({sdpObject:s});return d_.addNackSuppportForOpus(n),n}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return A.debug("getNativeSctpCapabilities()"),{numStreams:Kc}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){this.assertNotClosed(),A.debug("run()"),this._direction=e,this._remoteSdp=new p_.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Qr.getSendingRtpParameters("audio",l),video:Qr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Qr.getSendingRemoteRtpParameters("audio",l),video:Qr.getSendingRemoteRtpParameters("video",l)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(A.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){this.assertNotClosed(),A.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),A.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});A.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};A.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};A.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();A.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){this.assertNotClosed(),this.assertSendDirection(),A.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const i=Wc.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=Qr.reduceCodecs(i.codecs,n);const a=Wc.clone(this._sendingRemoteRtpParametersByKind[e.kind]);a.codecs=Qr.reduceCodecs(a.codecs,n);const o=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let u=await this._pc.createOffer(),l=Mt.parse(u.sdp),d;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l});const h=(0,f_.parse)((t||[{}])[0].scalabilityMode);t&&t.length>1&&(A.debug("send() | enabling legacy simulcast"),l=Mt.parse(u.sdp),d=l.media[o.idx],Jc.addLegacySimulcast({offerMediaObject:d,numStreams:t.length}),u={type:"offer",sdp:Mt.write(l)}),A.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const p=c.mid;if(i.mid=p,l=Mt.parse(this._pc.localDescription.sdp),d=l.media[o.idx],i.rtcp.cname=Nn.getCname({offerMediaObject:d}),i.encodings=Jc.getRtpEncodings({offerMediaObject:d}),t)for(let _=0;_<i.encodings.length;++_)t[_]&&Object.assign(i.encodings[_],t[_]);if(i.encodings.length>1&&(i.codecs[0].mimeType.toLowerCase()==="video/vp8"||i.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const _ of i.encodings)_.scalabilityMode?_.scalabilityMode=`L1T${h.temporalLayers}`:_.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:o.reuseMid,offerRtpParameters:i,answerRtpParameters:a,codecOptions:s});const f={type:"answer",sdp:this._remoteSdp.getSdp()};return A.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._mapMidTransceiver.set(p,c),{localId:p,rtpParameters:i,rtpSender:c.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;A.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const n=await this._pc.createOffer();A.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};A.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),A.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const s=await this._pc.createOffer();A.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};A.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),A.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const s=await this._pc.createOffer();A.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};A.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?A.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):A.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),A.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{c<=t?o.active=!0:o.active=!1}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();A.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};A.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),A.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{n.encodings[c]={...o,...t}}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();A.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};A.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:i};A.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Kc.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=Mt.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),A.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};A.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],s=new Map;for(const o of e){const{trackId:c,kind:u,rtpParameters:l,streamId:d}=o;A.debug("receive() [trackId:%s, kind:%s]",c,u);const h=l.mid||String(this._mapMidTransceiver.size);s.set(c,h),this._remoteSdp.receive({mid:h,kind:u,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:c})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};A.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=Mt.parse(i.sdp);for(const o of e){const{trackId:c,rtpParameters:u}=o,l=s.get(c),d=a.media.find(h=>String(h.mid)===l);Nn.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d})}i={type:"answer",sdp:Mt.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),A.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{trackId:c}=o,u=s.get(c),l=this._pc.getTransceivers().find(d=>d.mid===u);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(u,l),t.push({localId:u,track:l.receiver.track,rtpReceiver:l.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){A.debug("stopReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(i.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};A.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();A.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){A.debug("pauseReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};A.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();A.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){A.debug("resumeReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};A.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();A.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:s};A.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=Mt.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Mt.parse(this._pc.localDescription.sdp));const s=Nn.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new u_.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Ri.Safari12=Mo;var Ti={},m_=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),g_=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),dn=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&m_(e,r,t);return g_(e,r),e};Object.defineProperty(Ti,"__esModule",{value:!0});Ti.Safari11=void 0;const It=dn(Re),__=ve,Yc=dn(Se),Xr=dn(M),An=dn(xe),Qc=dn(Kt),w_=Ue,y_=et,J=new __.Logger("Safari11"),Xc={OS:1024,MIS:1024};class Io extends w_.HandlerInterface{static createFactory(){return()=>new Io}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(J.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){J.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}const s=It.parse(t.sdp);return An.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return J.debug("getNativeSctpCapabilities()"),{numStreams:Xc}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){J.debug("run()"),this._direction=e,this._remoteSdp=new y_.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:Xr.getSendingRtpParameters("audio",l),video:Xr.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:Xr.getSendingRemoteRtpParameters("audio",l),video:Xr.getSendingRemoteRtpParameters("video",l)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(J.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){J.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(J.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});J.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();J.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){this.assertSendDirection(),J.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&J.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let i=await this._pc.createOffer(),a=It.parse(i.sdp),o;const c=Yc.clone(this._sendingRtpParametersByKind[e.kind]);c.codecs=Xr.reduceCodecs(c.codecs);const u=Yc.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(u.codecs=Xr.reduceCodecs(u.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),e.kind==="video"&&t&&t.length>1&&(J.debug("send() | enabling simulcast"),a=It.parse(i.sdp),o=a.media.find(p=>p.type==="video"),Qc.addLegacySimulcast({offerMediaObject:o,track:e,numStreams:t.length}),i={type:"offer",sdp:It.write(a)}),J.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),a=It.parse(this._pc.localDescription.sdp),o=a.media.find(p=>p.type===e.kind),c.rtcp.cname=An.getCname({offerMediaObject:o}),c.encodings=Qc.getRtpEncodings({offerMediaObject:o,track:e}),t)for(let p=0;p<c.encodings.length;++p)t[p]&&Object.assign(c.encodings[p],t[p]);if(c.encodings.length>1&&c.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const p of c.encodings)p.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:o,offerRtpParameters:c,answerRtpParameters:u,codecOptions:s});const l={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const d=String(this._nextSendLocalId);this._nextSendLocalId++;const h=this._pc.getSenders().find(p=>p.track===e);return this._mapSendLocalIdRtpSender.set(d,h),{localId:d,rtpParameters:c,rtpSender:h}}async stopSending(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const s=await this._pc.createOffer();J.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(i){if(this._sendStream.getTracks().length===0){J.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if(this._pc.signalingState==="stable")return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?J.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):J.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");const n=s.track;await s.replaceTrack(t),n&&this._sendStream.removeTrack(n),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),J.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");const n=s.getParameters();n.encodings.forEach((i,a)=>{a<=t?i.active=!0:i.active=!1}),await s.setParameters(n)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),J.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");const n=s.getParameters();n.encodings.forEach((i,a)=>{n.encodings[a]={...i,...t}}),await s.setParameters(n)}async getSenderStats(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:i};J.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Xc.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=It.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),J.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};J.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[];for(const a of e){const{trackId:o,kind:c,rtpParameters:u,streamId:l}=a;J.debug("receive() [trackId:%s, kind:%s]",o,c);const d=c;this._remoteSdp.receive({mid:d,kind:c,offerRtpParameters:u,streamId:l||u.rtcp.cname,trackId:o})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let n=await this._pc.createAnswer();const i=It.parse(n.sdp);for(const a of e){const{kind:o,rtpParameters:c}=a,u=o,l=i.media.find(d=>String(d.mid)===u);An.applyCodecParameters({offerRtpParameters:c,answerMediaObject:l})}n={type:"answer",sdp:It.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),J.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const a of e){const{kind:o,trackId:c,rtpParameters:u}=a,l=o,d=c,h=this._pc.getReceivers().find(p=>p.track&&p.track.id===d);if(!h)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(d,{mid:l,rtpParameters:u,rtpReceiver:h}),t.push({localId:d,track:h.track,rtpReceiver:h})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){J.debug("stopReceiving() [localId:%s]",n);const{mid:i,rtpParameters:a}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:i,offerRtpParameters:a})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();J.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:s};J.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};J.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=It.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}J.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=It.parse(this._pc.localDescription.sdp));const s=An.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Ti.Safari11=Io;var Ci={},hs={},b_=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),v_=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),S_=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&b_(e,r,t);return v_(e,r),e};Object.defineProperty(hs,"__esModule",{value:!0});hs.mangleRtpParameters=hs.getCapabilities=void 0;const tu=S_(Se);function R_(){const r=RTCRtpReceiver.getCapabilities(),e=tu.clone(r);for(const t of e.codecs??[]){if(t.channels=t.numChannels,delete t.numChannels,t.mimeType=t.mimeType||`${t.kind}/${t.name}`,t.parameters){const s=t.parameters;s.apt&&(s.apt=Number(s.apt)),s["packetization-mode"]&&(s["packetization-mode"]=Number(s["packetization-mode"]))}for(const s of t.rtcpFeedback||[])s.parameter||(s.parameter="")}return e}hs.getCapabilities=R_;function T_(r){const e=tu.clone(r);e.mid&&(e.muxId=e.mid,delete e.mid);for(const t of e.codecs)t.channels&&(t.numChannels=t.channels,delete t.channels),t.mimeType&&!t.name&&(t.name=t.mimeType.split("/")[1]),delete t.mimeType;return e}hs.mangleRtpParameters=T_;var C_=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),D_=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Lo=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&C_(e,r,t);return D_(e,r),e};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.Edge11=void 0;const E_=ve,pa=Pe,jn=Lo(Se),fa=Lo(M),ma=Lo(hs),k_=Ue,le=new E_.Logger("Edge11");class No extends k_.HandlerInterface{static createFactory(){return()=>new No}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){le.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const e of this._rtpSenders.values())try{e.stop()}catch{}for(const e of this._rtpReceivers.values())try{e.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return le.debug("getNativeRtpCapabilities()"),ma.getCapabilities()}async getNativeSctpCapabilities(){return le.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){le.debug("run()"),this._sendingRtpParametersByKind={audio:fa.getSendingRtpParameters("audio",l),video:fa.getSendingRtpParameters("video",l)},this._remoteIceParameters=t,this._remoteIceCandidates=s,this._remoteDtlsParameters=n,this._cname=`CNAME-${jn.generateRandomNumber()}`,this.setIceGatherer({iceServers:a,iceTransportPolicy:o}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(e){throw new pa.UnsupportedError("not supported")}async restartIce(e){if(le.debug("restartIce()"),this._remoteIceParameters=e,!!this._transportReady){le.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){le.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),le.debug("send() | calling new RTCRtpSender()");const i=new RTCRtpSender(e,this._dtlsTransport),a=jn.clone(this._sendingRtpParametersByKind[e.kind]);a.codecs=fa.reduceCodecs(a.codecs,n);const o=a.codecs.some(l=>/.+\/rtx$/i.test(l.mimeType));t||(t=[{}]);for(const l of t)l.ssrc=jn.generateRandomNumber(),o&&(l.rtx={ssrc:jn.generateRandomNumber()});a.encodings=t,a.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const c=ma.mangleRtpParameters(a);le.debug("send() | calling rtpSender.send() [params:%o]",c),await i.send(c);const u=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(u,i),{localId:u,rtpParameters:a,rtpSender:i}}async stopSending(e){le.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{le.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(s){throw le.warn("stopSending() | rtpSender.stop() failed:%o",s),s}}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){t?le.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):le.debug("replaceTrack() [localId:%s, no track]",e);const s=this._rtpSenders.get(e);if(!s)throw new Error("RTCRtpSender not found");s.setTrack(t)}async setMaxSpatialLayer(e,t){le.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._rtpSenders.get(e);if(!s)throw new Error("RTCRtpSender not found");const n=s.getParameters();n.encodings.forEach((i,a)=>{a<=t?i.active=!0:i.active=!1}),await s.setParameters(n)}async setRtpEncodingParameters(e,t){le.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._rtpSenders.get(e);if(!s)throw new Error("RTCRtpSender not found");const n=s.getParameters();n.encodings.forEach((i,a)=>{n.encodings[a]={...i,...t}}),await s.setParameters(n)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new pa.UnsupportedError("not implemented")}async receive(e){const t=[];for(const s of e){const{trackId:n,kind:i}=s;le.debug("receive() [trackId:%s, kind:%s]",n,i)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const s of e){const{trackId:n,kind:i,rtpParameters:a}=s;le.debug("receive() | calling new RTCRtpReceiver()");const o=new RTCRtpReceiver(this._dtlsTransport,i);o.addEventListener("error",l=>{le.error('rtpReceiver "error" event [event:%o]',l)});const c=ma.mangleRtpParameters(a);le.debug("receive() | calling rtpReceiver.receive() [params:%o]",c),await o.receive(c);const u=n;this._rtpReceivers.set(u,o),t.push({localId:u,track:o.track,rtpReceiver:o})}return t}async stopReceiving(e){for(const t of e){le.debug("stopReceiving() [localId:%s]",t);const s=this._rtpReceivers.get(t);if(!s)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(t);try{le.debug("stopReceiving() | calling rtpReceiver.stop()"),s.stop()}catch(n){le.warn("stopReceiving() | rtpReceiver.stop() failed:%o",n)}}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new pa.UnsupportedError("not implemented")}setIceGatherer({iceServers:e,iceTransportPolicy:t}){const s=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});s.addEventListener("error",n=>{le.error('iceGatherer "error" event [event:%o]',n)});try{s.gather()}catch(n){le.debug("setIceGatherer() | iceGatherer.gather() failed: %s",n.toString())}this._iceGatherer=s}setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}),e.addEventListener("candidatepairchange",t=>{le.debug('iceTransport "candidatepairchange" event [pair:%o]',t.pair)}),this._iceTransport=e}setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{le.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",()=>{le.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),e.state==="closed"&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",t=>{le.error('dtlsTransport "error" event [event:%o]',t)}),this._dtlsTransport=e}async setupTransport({localDtlsRole:e}){le.debug("setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await new Promise((s,n)=>{this.safeEmit("@connect",{dtlsParameters:t},s,n)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const s of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(s);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(s=>s.algorithm==="sha-256"||s.algorithm==="sha-384"||s.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}Ci.Edge11=No;var Di={},O_=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),x_=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ys=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&O_(e,r,t);return x_(e,r),e};Object.defineProperty(Di,"__esModule",{value:!0});Di.ReactNativeUnifiedPlan=void 0;const Lt=ys(Re),P_=ve,el=ys(Se),es=ys(M),$n=ys(xe),ga=ys(St),M_=ys(Pr),I_=Pe,L_=Ue,N_=et,A_=Ft,L=new P_.Logger("ReactNativeUnifiedPlan"),tl={OS:1024,MIS:1024};class Ao extends L_.HandlerInterface{static createFactory(){return()=>new Ao}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(L.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){L.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}const s=Lt.parse(t.sdp),n=$n.extractRtpCapabilities({sdpObject:s});return M_.addNackSuppportForOpus(n),n}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return L.debug("getNativeSctpCapabilities()"),{numStreams:tl}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){this.assertNotClosed(),L.debug("run()"),this._direction=e,this._remoteSdp=new N_.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:es.getSendingRtpParameters("audio",l),video:es.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:es.getSendingRemoteRtpParameters("audio",l),video:es.getSendingRemoteRtpParameters("video",l)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(L.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){this.assertNotClosed(),L.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),L.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});L.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();L.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){this.assertNotClosed(),this.assertSendDirection(),L.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((g,k)=>{g.rid=`r${k}`});const i=el.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=es.reduceCodecs(i.codecs,n);const a=el.clone(this._sendingRemoteRtpParametersByKind[e.kind]);a.codecs=es.reduceCodecs(a.codecs,n);const o=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let u=await this._pc.createOffer(),l=Lt.parse(u.sdp),d;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l});let h=!1;const p=(0,A_.parse)((t||[{}])[0].scalabilityMode);t&&t.length===1&&p.spatialLayers>1&&i.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(L.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,l=Lt.parse(u.sdp),d=l.media[o.idx],ga.addLegacySimulcast({offerMediaObject:d,numStreams:p.spatialLayers}),u={type:"offer",sdp:Lt.write(l)}),L.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);let f=c.mid??void 0;if(f||L.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),i.mid=f,l=Lt.parse(this._pc.localDescription.sdp),d=l.media[o.idx],i.rtcp.cname=$n.getCname({offerMediaObject:d}),!t)i.encodings=ga.getRtpEncodings({offerMediaObject:d});else if(t.length===1){let g=ga.getRtpEncodings({offerMediaObject:d});Object.assign(g[0],t[0]),h&&(g=[g[0]]),i.encodings=g}else i.encodings=t;if(i.encodings.length>1&&(i.codecs[0].mimeType.toLowerCase()==="video/vp8"||i.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const g of i.encodings)g.scalabilityMode?g.scalabilityMode=`L1T${p.temporalLayers}`:g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:o.reuseMid,offerRtpParameters:i,answerRtpParameters:a,codecOptions:s,extmapAllowMixed:!0});const _={type:"answer",sdp:this._remoteSdp.getSdp()};return L.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),f||(f=c.mid,i.mid=f),this._mapMidTransceiver.set(f,c),{localId:f,rtpParameters:i,rtpSender:c.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;L.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const n=await this._pc.createOffer();L.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const i={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),L.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const s=await this._pc.createOffer();L.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),L.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const s=await this._pc.createOffer();L.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const n={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?L.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):L.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),L.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{c<=t?o.active=!0:o.active=!1}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();L.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),L.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const n=s.sender.getParameters();n.encodings.forEach((o,c)=>{n.encodings[c]={...o,...t}}),await s.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=await this._pc.createOffer();L.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const a={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:i};L.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%tl.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=Lt.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),L.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],s=new Map;for(const o of e){const{trackId:c,kind:u,rtpParameters:l,streamId:d}=o;L.debug("receive() [trackId:%s, kind:%s]",c,u);const h=l.mid||String(this._mapMidTransceiver.size);s.set(c,h),this._remoteSdp.receive({mid:h,kind:u,offerRtpParameters:l,streamId:d||l.rtcp.cname,trackId:c})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=Lt.parse(i.sdp);for(const o of e){const{trackId:c,rtpParameters:u}=o,l=s.get(c),d=a.media.find(h=>String(h.mid)===l);$n.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d})}i={type:"answer",sdp:Lt.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),L.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{trackId:c}=o,u=s.get(c),l=this._pc.getTransceivers().find(d=>d.mid===u);if(l)this._mapMidTransceiver.set(u,l),t.push({localId:u,track:l.receiver.track,rtpReceiver:l.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){L.debug("stopReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(i.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();L.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){L.debug("pauseReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();L.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){L.debug("resumeReceiving() [localId:%s]",n);const i=this._mapMidTransceiver.get(n);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();L.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:s};L.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=Lt.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}L.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Lt.parse(this._pc.localDescription.sdp));const s=$n.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new I_.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Di.ReactNativeUnifiedPlan=Ao;var Ei={},j_=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),$_=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),un=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&j_(e,r,t);return $_(e,r),e};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.ReactNative=void 0;const Nt=un(Re),F_=ve,js=Pe,_a=un(Se),ts=un(M),Fn=un(xe),rl=un(Kt),U_=Ue,q_=et,ee=new F_.Logger("ReactNative"),sl={OS:1024,MIS:1024};class jo extends U_.HandlerInterface{static createFactory(){return()=>new jo}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(ee.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){ee.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}const s=Nt.parse(t.sdp);return Fn.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return ee.debug("getNativeSctpCapabilities()"),{numStreams:sl}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){ee.debug("run()"),this._direction=e,this._remoteSdp=new q_.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:ts.getSendingRtpParameters("audio",l),video:ts.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:ts.getSendingRemoteRtpParameters("audio",l),video:ts.getSendingRemoteRtpParameters("video",l)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...c},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(ee.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){ee.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(ee.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});ee.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const s={type:"answer",sdp:this._remoteSdp.getSdp()};ee.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};ee.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();ee.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:n}){this.assertSendDirection(),ee.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&ee.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let i=await this._pc.createOffer(),a=Nt.parse(i.sdp),o;const c=_a.clone(this._sendingRtpParametersByKind[e.kind]);c.codecs=ts.reduceCodecs(c.codecs);const u=_a.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(u.codecs=ts.reduceCodecs(u.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),e.kind==="video"&&t&&t.length>1&&(ee.debug("send() | enabling simulcast"),a=Nt.parse(i.sdp),o=a.media.find(h=>h.type==="video"),rl.addLegacySimulcast({offerMediaObject:o,track:e,numStreams:t.length}),i={type:"offer",sdp:Nt.write(a)}),ee.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),a=Nt.parse(this._pc.localDescription.sdp),o=a.media.find(h=>h.type===e.kind),c.rtcp.cname=Fn.getCname({offerMediaObject:o}),c.encodings=rl.getRtpEncodings({offerMediaObject:o,track:e}),t)for(let h=0;h<c.encodings.length;++h)t[h]&&Object.assign(c.encodings[h],t[h]);if(c.encodings.length>1&&(c.codecs[0].mimeType.toLowerCase()==="video/vp8"||c.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const h of c.encodings)h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:o,offerRtpParameters:c,answerRtpParameters:u,codecOptions:s});const l={type:"answer",sdp:this._remoteSdp.getSdp()};ee.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l);const d=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(d,e),{localId:d,rtpParameters:c}}async stopSending(e){this.assertSendDirection(),ee.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const s=await this._pc.createOffer();ee.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(i){if(this._sendStream.getTracks().length===0){ee.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if(this._pc.signalingState==="stable")return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};ee.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new js.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new js.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new js.UnsupportedError("not implemented")}async getSenderStats(e){throw new js.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:s,protocol:i};ee.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%sl.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),l=Nt.parse(u.sdp),d=l.media.find(p=>p.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),ee.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});const h={type:"answer",sdp:this._remoteSdp.getSdp()};ee.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive(e){this.assertRecvDirection();const t=[],s=new Map;for(const o of e){const{trackId:c,kind:u,rtpParameters:l}=o;ee.debug("receive() [trackId:%s, kind:%s]",c,u);const d=u;let h=o.streamId||l.rtcp.cname;ee.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),h+=`-hack-${_a.generateRandomNumber()}`,s.set(c,h),this._remoteSdp.receive({mid:d,kind:u,offerRtpParameters:l,streamId:h,trackId:c})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};ee.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=Nt.parse(i.sdp);for(const o of e){const{kind:c,rtpParameters:u}=o,l=c,d=a.media.find(h=>String(h.mid)===l);Fn.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d})}i={type:"answer",sdp:Nt.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),ee.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of e){const{kind:c,trackId:u,rtpParameters:l}=o,d=u,h=c,p=s.get(u),_=this._pc.getRemoteStreams().find(g=>g.id===p).getTrackById(d);if(!_)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(d,{mid:h,rtpParameters:l}),t.push({localId:d,track:_})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){ee.debug("stopReceiving() [localId:%s]",n);const{mid:i,rtpParameters:a}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:i,offerRtpParameters:a})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};ee.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const s=await this._pc.createAnswer();ee.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new js.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:s};ee.debug("receiveDataChannel() [options:%o]",c);const u=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const l={type:"offer",sdp:this._remoteSdp.getSdp()};ee.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const d=await this._pc.createAnswer();if(!this._transportReady){const h=Nt.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}ee.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Nt.parse(this._pc.localDescription.sdp));const s=Fn.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((n,i)=>{this.safeEmit("@connect",{dtlsParameters:s},n,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Ei.ReactNative=jo;var B_=v&&v.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),z_=v&&v.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ru=v&&v.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&B_(e,r,t);return z_(e,r),e};Object.defineProperty(Or,"__esModule",{value:!0});Or.Device=Or.detectDevice=void 0;const V_=Af,H_=ve,G_=$t,rs=Pe,Z_=ru(Se),ar=ru(M),W_=en,J_=_i,K_=wi,Y_=yi,Q_=bi,X_=vi,ew=Si,tw=Ri,rw=Ti,sw=Ci,nw=Di,iw=Ei,Oe=new H_.Logger("Device");function su(){var r,e,t;if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(Oe.debug("detectDevice() | React-Native detected"),typeof RTCPeerConnection>"u"){Oe.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(Oe.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(Oe.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative")}else if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){const s=navigator.userAgent,n=new V_.UAParser(s);Oe.debug("detectDevice() | browser detected [ua:%s, parsed:%o]",s,n.getResult());const i=n.getBrowser(),a=((r=i.name)==null?void 0:r.toLowerCase())??"",o=parseInt(i.major??"0"),u=((e=n.getEngine().name)==null?void 0:e.toLowerCase())??"",l=n.getOS(),d=((t=l.name)==null?void 0:t.toLowerCase())??"",h=parseFloat(l.version??"0"),p=d==="ios",f=["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(a),_=["firefox","mobile firefox","mobile focus"].includes(a),g=["safari","mobile safari"].includes(a),k=["edge"].includes(a);if((f||k)&&!p&&o>=111)return"Chrome111";if(f&&!p&&o>=74||k&&!p&&o>=88)return"Chrome74";if(f&&!p&&o>=70)return"Chrome70";if(f&&!p&&o>=67)return"Chrome67";if(f&&!p&&o>=55)return"Chrome55";if(_&&!p&&o>=60)return"Firefox60";if(_&&p&&h>=14.3)return"Safari12";if(g&&o>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(g&&o>=11)return"Safari11";if(k&&!p&&o>=11&&o<=18)return"Edge11";if(u==="webkit"&&p&&h>=14.3&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(u==="blink"){const P=s.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(P){const D=Number(P[1]);return D>=111?"Chrome111":D>=74?"Chrome74":D>=70?"Chrome70":D>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{Oe.warn("detectDevice() | browser not supported [name:%s, version:%s]",a,o);return}}else{Oe.warn("detectDevice() | unknown device");return}}Or.detectDevice=su;class aw{constructor({handlerName:e,handlerFactory:t,Handler:s}={}){if(this._loaded=!1,this._observer=new G_.EnhancedEventEmitter,Oe.debug("constructor()"),s)if(Oe.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),typeof s=="string")e=s;else throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)Oe.debug("constructor() | handler given: %s",e);else if(e=su(),e)Oe.debug("constructor() | detected handler: %s",e);else throw new rs.UnsupportedError("device not supported");switch(e){case"Chrome111":this._handlerFactory=J_.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=K_.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=Y_.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=Q_.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=X_.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=ew.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=tw.Safari12.createFactory();break;case"Safari11":this._handlerFactory=rw.Safari11.createFactory();break;case"Edge11":this._handlerFactory=sw.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=nw.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=iw.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const n=this._handlerFactory();this._handlerName=n.name,n.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new rs.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new rs.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){Oe.debug("load() [routerRtpCapabilities:%o]",e),e=Z_.clone(e);let t;try{if(this._loaded)throw new rs.InvalidStateError("already loaded");ar.validateRtpCapabilities(e),t=this._handlerFactory();const s=await t.getNativeRtpCapabilities();Oe.debug("load() | got native RTP capabilities:%o",s),ar.validateRtpCapabilities(s),this._extendedRtpCapabilities=ar.getExtendedRtpCapabilities(s,e),Oe.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=ar.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=ar.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=ar.getRecvRtpCapabilities(this._extendedRtpCapabilities),ar.validateRtpCapabilities(this._recvRtpCapabilities),Oe.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),Oe.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),ar.validateSctpCapabilities(this._sctpCapabilities),Oe.debug("load() succeeded"),this._loaded=!0,t.close()}catch(s){throw t&&t.close(),s}}canProduce(e){if(this._loaded){if(e!=="audio"&&e!=="video")throw new TypeError(`invalid kind "${e}"`)}else throw new rs.InvalidStateError("not loaded");return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,appData:l}){return Oe.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,appData:l})}createRecvTransport({id:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,appData:l}){return Oe.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:u,appData:l})}createTransport({direction:e,id:t,iceParameters:s,iceCandidates:n,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,appData:d}){if(this._loaded){if(typeof t!="string")throw new TypeError("missing id");if(typeof s!="object")throw new TypeError("missing iceParameters");if(Array.isArray(n)){if(typeof i!="object")throw new TypeError("missing dtlsParameters");if(a&&typeof a!="object")throw new TypeError("wrong sctpParameters");if(d&&typeof d!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new rs.InvalidStateError("not loaded");const h=new W_.Transport({direction:e,id:t,iceParameters:s,iceCandidates:n,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,appData:d,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",h),h}}Or.Device=aw;var nu={},iu={};Object.defineProperty(iu,"__esModule",{value:!0});var au={};Object.defineProperty(au,"__esModule",{value:!0});(function(r){var e=v&&v.__createBinding||(Object.create?function(s,n,i,a){a===void 0&&(a=i);var o=Object.getOwnPropertyDescriptor(n,i);(!o||("get"in o?!n.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return n[i]}}),Object.defineProperty(s,a,o)}:function(s,n,i,a){a===void 0&&(a=i),s[a]=n[i]}),t=v&&v.__exportStar||function(s,n){for(var i in s)i!=="default"&&!Object.prototype.hasOwnProperty.call(n,i)&&e(n,s,i)};Object.defineProperty(r,"__esModule",{value:!0}),t(Or,r),t(en,r),t(tn,r),t(rn,r),t(sn,r),t(nn,r),t(iu,r),t(au,r),t(Ue,r),t(Pe,r)})(nu);(function(r){var e=v&&v.__createBinding||(Object.create?function(u,l,d,h){h===void 0&&(h=d);var p=Object.getOwnPropertyDescriptor(l,d);(!p||("get"in p?!l.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return l[d]}}),Object.defineProperty(u,h,p)}:function(u,l,d,h){h===void 0&&(h=d),u[h]=l[d]}),t=v&&v.__setModuleDefault||(Object.create?function(u,l){Object.defineProperty(u,"default",{enumerable:!0,value:l})}:function(u,l){u.default=l}),s=v&&v.__importStar||function(u){if(u&&u.__esModule)return u;var l={};if(u!=null)for(var d in u)d!=="default"&&Object.prototype.hasOwnProperty.call(u,d)&&e(l,u,d);return t(l,u),l},n=v&&v.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(r,"__esModule",{value:!0}),r.debug=r.parseScalabilityMode=r.detectDevice=r.Device=r.version=r.types=void 0;const i=n(hi);r.debug=i.default;const a=Or;Object.defineProperty(r,"Device",{enumerable:!0,get:function(){return a.Device}}),Object.defineProperty(r,"detectDevice",{enumerable:!0,get:function(){return a.detectDevice}});const o=s(nu);r.types=o,r.version="3.6.101";var c=Ft;Object.defineProperty(r,"parseScalabilityMode",{enumerable:!0,get:function(){return c.parse}})})(ui);const ow=Qs(ui),cw=Cf({__proto__:null,default:ow},[ui]);var $o={exports:{}},ou=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}},lw=ou,fr=Object.prototype.toString;function Fo(r){return Array.isArray(r)}function eo(r){return typeof r>"u"}function dw(r){return r!==null&&!eo(r)&&r.constructor!==null&&!eo(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function cu(r){return fr.call(r)==="[object ArrayBuffer]"}function uw(r){return fr.call(r)==="[object FormData]"}function hw(r){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&cu(r.buffer),e}function pw(r){return typeof r=="string"}function fw(r){return typeof r=="number"}function lu(r){return r!==null&&typeof r=="object"}function Jn(r){if(fr.call(r)!=="[object Object]")return!1;var e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}function mw(r){return fr.call(r)==="[object Date]"}function gw(r){return fr.call(r)==="[object File]"}function _w(r){return fr.call(r)==="[object Blob]"}function du(r){return fr.call(r)==="[object Function]"}function ww(r){return lu(r)&&du(r.pipe)}function yw(r){return fr.call(r)==="[object URLSearchParams]"}function bw(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function vw(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function Uo(r,e){if(!(r===null||typeof r>"u"))if(typeof r!="object"&&(r=[r]),Fo(r))for(var t=0,s=r.length;t<s;t++)e.call(null,r[t],t,r);else for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.call(null,r[n],n,r)}function to(){var r={};function e(n,i){Jn(r[i])&&Jn(n)?r[i]=to(r[i],n):Jn(n)?r[i]=to({},n):Fo(n)?r[i]=n.slice():r[i]=n}for(var t=0,s=arguments.length;t<s;t++)Uo(arguments[t],e);return r}function Sw(r,e,t){return Uo(e,function(n,i){t&&typeof n=="function"?r[i]=lw(n,t):r[i]=n}),r}function Rw(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var He={isArray:Fo,isArrayBuffer:cu,isBuffer:dw,isFormData:uw,isArrayBufferView:hw,isString:pw,isNumber:fw,isObject:lu,isPlainObject:Jn,isUndefined:eo,isDate:mw,isFile:gw,isBlob:_w,isFunction:du,isStream:ww,isURLSearchParams:yw,isStandardBrowserEnv:vw,forEach:Uo,merge:to,extend:Sw,trim:bw,stripBOM:Rw},ss=He;function nl(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var uu=function(e,t,s){if(!t)return e;var n;if(s)n=s(t);else if(ss.isURLSearchParams(t))n=t.toString();else{var i=[];ss.forEach(t,function(c,u){c===null||typeof c>"u"||(ss.isArray(c)?u=u+"[]":c=[c],ss.forEach(c,function(d){ss.isDate(d)?d=d.toISOString():ss.isObject(d)&&(d=JSON.stringify(d)),i.push(nl(u)+"="+nl(d))}))}),n=i.join("&")}if(n){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+n}return e},Tw=He;function ki(){this.handlers=[]}ki.prototype.use=function(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1};ki.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};ki.prototype.forEach=function(e){Tw.forEach(this.handlers,function(s){s!==null&&e(s)})};var Cw=ki,Dw=He,Ew=function(e,t){Dw.forEach(e,function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])})},hu=function(e,t,s,n,i){return e.config=t,s&&(e.code=s),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},pu={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wa,il;function fu(){if(il)return wa;il=1;var r=hu;return wa=function(t,s,n,i,a){var o=new Error(t);return r(o,s,n,i,a)},wa}var ya,al;function kw(){if(al)return ya;al=1;var r=fu();return ya=function(t,s,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):s(r("Request failed with status code "+n.status,n.config,null,n.request,n))},ya}var ba,ol;function Ow(){if(ol)return ba;ol=1;var r=He;return ba=r.isStandardBrowserEnv()?function(){return{write:function(s,n,i,a,o,c){var u=[];u.push(s+"="+encodeURIComponent(n)),r.isNumber(i)&&u.push("expires="+new Date(i).toGMTString()),r.isString(a)&&u.push("path="+a),r.isString(o)&&u.push("domain="+o),c===!0&&u.push("secure"),document.cookie=u.join("; ")},read:function(s){var n=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(s){this.write(s,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),ba}var va,cl;function xw(){return cl||(cl=1,va=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}),va}var Sa,ll;function Pw(){return ll||(ll=1,Sa=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}),Sa}var Ra,dl;function Mw(){if(dl)return Ra;dl=1;var r=xw(),e=Pw();return Ra=function(s,n){return s&&!r(n)?e(s,n):n},Ra}var Ta,ul;function Iw(){if(ul)return Ta;ul=1;var r=He,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Ta=function(s){var n={},i,a,o;return s&&r.forEach(s.split(`
`),function(u){if(o=u.indexOf(":"),i=r.trim(u.substr(0,o)).toLowerCase(),a=r.trim(u.substr(o+1)),i){if(n[i]&&e.indexOf(i)>=0)return;i==="set-cookie"?n[i]=(n[i]?n[i]:[]).concat([a]):n[i]=n[i]?n[i]+", "+a:a}}),n},Ta}var Ca,hl;function Lw(){if(hl)return Ca;hl=1;var r=He;return Ca=r.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a"),n;function i(a){var o=a;return t&&(s.setAttribute("href",o),o=s.href),s.setAttribute("href",o),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:s.pathname.charAt(0)==="/"?s.pathname:"/"+s.pathname}}return n=i(window.location.href),function(o){var c=r.isString(o)?i(o):o;return c.protocol===n.protocol&&c.host===n.host}}():function(){return function(){return!0}}(),Ca}var Da,pl;function Oi(){if(pl)return Da;pl=1;function r(e){this.message=e}return r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,Da=r,Da}var Ea,fl;function ml(){if(fl)return Ea;fl=1;var r=He,e=kw(),t=Ow(),s=uu,n=Mw(),i=Iw(),a=Lw(),o=fu(),c=pu,u=Oi();return Ea=function(d){return new Promise(function(p,f){var _=d.data,g=d.headers,k=d.responseType,P;function D(){d.cancelToken&&d.cancelToken.unsubscribe(P),d.signal&&d.signal.removeEventListener("abort",P)}r.isFormData(_)&&delete g["Content-Type"];var C=new XMLHttpRequest;if(d.auth){var y=d.auth.username||"",R=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";g.Authorization="Basic "+btoa(y+":"+R)}var Y=n(d.baseURL,d.url);C.open(d.method.toUpperCase(),s(Y,d.params,d.paramsSerializer),!0),C.timeout=d.timeout;function de(){if(C){var _e="getAllResponseHeaders"in C?i(C.getAllResponseHeaders()):null,pe=!k||k==="text"||k==="json"?C.responseText:C.response,ue={data:pe,status:C.status,statusText:C.statusText,headers:_e,config:d,request:C};e(function(Ge){p(Ge),D()},function(Ge){f(Ge),D()},ue),C=null}}if("onloadend"in C?C.onloadend=de:C.onreadystatechange=function(){!C||C.readyState!==4||C.status===0&&!(C.responseURL&&C.responseURL.indexOf("file:")===0)||setTimeout(de)},C.onabort=function(){C&&(f(o("Request aborted",d,"ECONNABORTED",C)),C=null)},C.onerror=function(){f(o("Network Error",d,null,C)),C=null},C.ontimeout=function(){var pe=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",ue=d.transitional||c;d.timeoutErrorMessage&&(pe=d.timeoutErrorMessage),f(o(pe,d,ue.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",C)),C=null},r.isStandardBrowserEnv()){var Me=(d.withCredentials||a(Y))&&d.xsrfCookieName?t.read(d.xsrfCookieName):void 0;Me&&(g[d.xsrfHeaderName]=Me)}"setRequestHeader"in C&&r.forEach(g,function(pe,ue){typeof _>"u"&&ue.toLowerCase()==="content-type"?delete g[ue]:C.setRequestHeader(ue,pe)}),r.isUndefined(d.withCredentials)||(C.withCredentials=!!d.withCredentials),k&&k!=="json"&&(C.responseType=d.responseType),typeof d.onDownloadProgress=="function"&&C.addEventListener("progress",d.onDownloadProgress),typeof d.onUploadProgress=="function"&&C.upload&&C.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(P=function(_e){C&&(f(!_e||_e&&_e.type?new u("canceled"):_e),C.abort(),C=null)},d.cancelToken&&d.cancelToken.subscribe(P),d.signal&&(d.signal.aborted?P():d.signal.addEventListener("abort",P))),_||(_=null),C.send(_)})},Ea}var Ie=He,gl=Ew,Nw=hu,Aw=pu,jw={"Content-Type":"application/x-www-form-urlencoded"};function _l(r,e){!Ie.isUndefined(r)&&Ie.isUndefined(r["Content-Type"])&&(r["Content-Type"]=e)}function $w(){var r;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(r=ml()),r}function Fw(r,e,t){if(Ie.isString(r))try{return(e||JSON.parse)(r),Ie.trim(r)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(r)}var xi={transitional:Aw,adapter:$w(),transformRequest:[function(e,t){return gl(t,"Accept"),gl(t,"Content-Type"),Ie.isFormData(e)||Ie.isArrayBuffer(e)||Ie.isBuffer(e)||Ie.isStream(e)||Ie.isFile(e)||Ie.isBlob(e)?e:Ie.isArrayBufferView(e)?e.buffer:Ie.isURLSearchParams(e)?(_l(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):Ie.isObject(e)||t&&t["Content-Type"]==="application/json"?(_l(t,"application/json"),Fw(e)):e}],transformResponse:[function(e){var t=this.transitional||xi.transitional,s=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,i=!s&&this.responseType==="json";if(i||n&&Ie.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(i)throw a.name==="SyntaxError"?Nw(a,this,"E_JSON_PARSE"):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ie.forEach(["delete","get","head"],function(e){xi.headers[e]={}});Ie.forEach(["post","put","patch"],function(e){xi.headers[e]=Ie.merge(jw)});var qo=xi,Uw=He,qw=qo,Bw=function(e,t,s){var n=this||qw;return Uw.forEach(s,function(a){e=a.call(n,e,t)}),e},ka,wl;function mu(){return wl||(wl=1,ka=function(e){return!!(e&&e.__CANCEL__)}),ka}var yl=He,Oa=Bw,zw=mu(),Vw=qo,Hw=Oi();function xa(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Hw("canceled")}var Gw=function(e){xa(e),e.headers=e.headers||{},e.data=Oa.call(e,e.data,e.headers,e.transformRequest),e.headers=yl.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),yl.forEach(["delete","get","head","post","put","patch","common"],function(n){delete e.headers[n]});var t=e.adapter||Vw.adapter;return t(e).then(function(n){return xa(e),n.data=Oa.call(e,n.data,n.headers,e.transformResponse),n},function(n){return zw(n)||(xa(e),n&&n.response&&(n.response.data=Oa.call(e,n.response.data,n.response.headers,e.transformResponse))),Promise.reject(n)})},Ke=He,gu=function(e,t){t=t||{};var s={};function n(l,d){return Ke.isPlainObject(l)&&Ke.isPlainObject(d)?Ke.merge(l,d):Ke.isPlainObject(d)?Ke.merge({},d):Ke.isArray(d)?d.slice():d}function i(l){if(Ke.isUndefined(t[l])){if(!Ke.isUndefined(e[l]))return n(void 0,e[l])}else return n(e[l],t[l])}function a(l){if(!Ke.isUndefined(t[l]))return n(void 0,t[l])}function o(l){if(Ke.isUndefined(t[l])){if(!Ke.isUndefined(e[l]))return n(void 0,e[l])}else return n(void 0,t[l])}function c(l){if(l in t)return n(e[l],t[l]);if(l in e)return n(void 0,e[l])}var u={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c};return Ke.forEach(Object.keys(e).concat(Object.keys(t)),function(d){var h=u[d]||i,p=h(d);Ke.isUndefined(p)&&h!==c||(s[d]=p)}),s},Pa,bl;function _u(){return bl||(bl=1,Pa={version:"0.26.1"}),Pa}var Zw=_u().version,Bo={};["object","boolean","number","function","string","symbol"].forEach(function(r,e){Bo[r]=function(s){return typeof s===r||"a"+(e<1?"n ":" ")+r}});var vl={};Bo.transitional=function(e,t,s){function n(i,a){return"[Axios v"+Zw+"] Transitional option '"+i+"'"+a+(s?". "+s:"")}return function(i,a,o){if(e===!1)throw new Error(n(a," has been removed"+(t?" in "+t:"")));return t&&!vl[a]&&(vl[a]=!0,console.warn(n(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};function Ww(r,e,t){if(typeof r!="object")throw new TypeError("options must be an object");for(var s=Object.keys(r),n=s.length;n-- >0;){var i=s[n],a=e[i];if(a){var o=r[i],c=o===void 0||a(o,i,r);if(c!==!0)throw new TypeError("option "+i+" must be "+c);continue}if(t!==!0)throw Error("Unknown option "+i)}}var Jw={assertOptions:Ww,validators:Bo},wu=He,Kw=uu,Sl=Cw,Rl=Gw,Pi=gu,yu=Jw,ns=yu.validators;function hn(r){this.defaults=r,this.interceptors={request:new Sl,response:new Sl}}hn.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Pi(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var s=t.transitional;s!==void 0&&yu.assertOptions(s,{silentJSONParsing:ns.transitional(ns.boolean),forcedJSONParsing:ns.transitional(ns.boolean),clarifyTimeoutError:ns.transitional(ns.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(i=i&&p.synchronous,n.unshift(p.fulfilled,p.rejected))});var a=[];this.interceptors.response.forEach(function(p){a.push(p.fulfilled,p.rejected)});var o;if(!i){var c=[Rl,void 0];for(Array.prototype.unshift.apply(c,n),c=c.concat(a),o=Promise.resolve(t);c.length;)o=o.then(c.shift(),c.shift());return o}for(var u=t;n.length;){var l=n.shift(),d=n.shift();try{u=l(u)}catch(h){d(h);break}}try{o=Rl(u)}catch(h){return Promise.reject(h)}for(;a.length;)o=o.then(a.shift(),a.shift());return o};hn.prototype.getUri=function(e){return e=Pi(this.defaults,e),Kw(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};wu.forEach(["delete","get","head","options"],function(e){hn.prototype[e]=function(t,s){return this.request(Pi(s||{},{method:e,url:t,data:(s||{}).data}))}});wu.forEach(["post","put","patch"],function(e){hn.prototype[e]=function(t,s,n){return this.request(Pi(n||{},{method:e,url:t,data:s}))}});var Yw=hn,Ma,Tl;function Qw(){if(Tl)return Ma;Tl=1;var r=Oi();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var s;this.promise=new Promise(function(a){s=a});var n=this;this.promise.then(function(i){if(n._listeners){var a,o=n._listeners.length;for(a=0;a<o;a++)n._listeners[a](i);n._listeners=null}}),this.promise.then=function(i){var a,o=new Promise(function(c){n.subscribe(c),a=c}).then(i);return o.cancel=function(){n.unsubscribe(a)},o},t(function(a){n.reason||(n.reason=new r(a),s(n.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]},e.prototype.unsubscribe=function(s){if(this._listeners){var n=this._listeners.indexOf(s);n!==-1&&this._listeners.splice(n,1)}},e.source=function(){var s,n=new e(function(a){s=a});return{token:n,cancel:s}},Ma=e,Ma}var Ia,Cl;function Xw(){return Cl||(Cl=1,Ia=function(e){return function(s){return e.apply(null,s)}}),Ia}var La,Dl;function ey(){if(Dl)return La;Dl=1;var r=He;return La=function(t){return r.isObject(t)&&t.isAxiosError===!0},La}var El=He,ty=ou,Kn=Yw,ry=gu,sy=qo;function bu(r){var e=new Kn(r),t=ty(Kn.prototype.request,e);return El.extend(t,Kn.prototype,e),El.extend(t,e),t.create=function(n){return bu(ry(r,n))},t}var Ut=bu(sy);Ut.Axios=Kn;Ut.Cancel=Oi();Ut.CancelToken=Qw();Ut.isCancel=mu();Ut.VERSION=_u().version;Ut.all=function(e){return Promise.all(e)};Ut.spread=Xw();Ut.isAxiosError=ey();$o.exports=Ut;$o.exports.default=Ut;var ny=$o.exports,iy=ny;const ay=Qs(iy);var si={exports:{}};si.exports;(function(r,e){var t=200,s="__lodash_hash_undefined__",n=800,i=16,a=9007199254740991,o="[object Arguments]",c="[object Array]",u="[object AsyncFunction]",l="[object Boolean]",d="[object Date]",h="[object Error]",p="[object Function]",f="[object GeneratorFunction]",_="[object Map]",g="[object Number]",k="[object Null]",P="[object Object]",D="[object Proxy]",C="[object RegExp]",y="[object Set]",R="[object String]",Y="[object Undefined]",de="[object WeakMap]",Me="[object ArrayBuffer]",_e="[object DataView]",pe="[object Float32Array]",ue="[object Float64Array]",tt="[object Int8Array]",Ge="[object Int16Array]",Cs="[object Int32Array]",Xt="[object Uint8Array]",Bt="[object Uint8ClampedArray]",U="[object Uint16Array]",I="[object Uint32Array]",fe=/[\\^$.*+?()[\]{}|]/g,Le=/^\[object .+?Constructor\]$/,Dt=/^(?:0|[1-9]\d*)$/,H={};H[pe]=H[ue]=H[tt]=H[Ge]=H[Cs]=H[Xt]=H[Bt]=H[U]=H[I]=!0,H[o]=H[c]=H[Me]=H[l]=H[_e]=H[d]=H[h]=H[p]=H[_]=H[g]=H[P]=H[C]=H[y]=H[R]=H[de]=!1;var pt=typeof v=="object"&&v&&v.Object===Object&&v,er=typeof self=="object"&&self&&self.Object===Object&&self,rt=pt||er||Function("return this")(),Lr=e&&!e.nodeType&&e,tr=Lr&&!0&&r&&!r.nodeType&&r,Ds=tr&&tr.exports===Lr,Nr=Ds&&pt.process,bn=function(){try{var m=tr&&tr.require&&tr.require("util").types;return m||Nr&&Nr.binding&&Nr.binding("util")}catch{}}(),mr=bn&&bn.isTypedArray;function Es(m,w,b){switch(b.length){case 0:return m.call(w);case 1:return m.call(w,b[0]);case 2:return m.call(w,b[0],b[1]);case 3:return m.call(w,b[0],b[1],b[2])}return m.apply(w,b)}function gr(m,w){for(var b=-1,x=Array(m);++b<m;)x[b]=w(b);return x}function zi(m){return function(w){return m(w)}}function ks(m,w){return m==null?void 0:m[w]}function _r(m,w){return function(b){return m(w(b))}}var Os=Array.prototype,Vi=Function.prototype,wr=Object.prototype,Ar=rt["__core-js_shared__"],Ne=Vi.toString,Ae=wr.hasOwnProperty,yr=function(){var m=/[^.]+$/.exec(Ar&&Ar.keys&&Ar.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),V=wr.toString,ie=Ne.call(Object),q=RegExp("^"+Ne.call(Ae).replace(fe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ae=Ds?rt.Buffer:void 0,ft=rt.Symbol,Ze=rt.Uint8Array,X=ae?ae.allocUnsafe:void 0,$=_r(Object.getPrototypeOf,Object),We=Object.create,xs=wr.propertyIsEnumerable,vn=Os.splice,br=ft?ft.toStringTag:void 0,Sn=function(){try{var m=Wi(Object,"defineProperty");return m({},"",{}),m}catch{}}(),ep=ae?ae.isBuffer:void 0,ic=Math.max,tp=Date.now,ac=Wi(rt,"Map"),Ps=Wi(Object,"create"),rp=function(){function m(){}return function(w){if(!Vt(w))return{};if(We)return We(w);m.prototype=w;var b=new m;return m.prototype=void 0,b}}();function vr(m){var w=-1,b=m==null?0:m.length;for(this.clear();++w<b;){var x=m[w];this.set(x[0],x[1])}}function sp(){this.__data__=Ps?Ps(null):{},this.size=0}function np(m){var w=this.has(m)&&delete this.__data__[m];return this.size-=w?1:0,w}function ip(m){var w=this.__data__;if(Ps){var b=w[m];return b===s?void 0:b}return Ae.call(w,m)?w[m]:void 0}function ap(m){var w=this.__data__;return Ps?w[m]!==void 0:Ae.call(w,m)}function op(m,w){var b=this.__data__;return this.size+=this.has(m)?0:1,b[m]=Ps&&w===void 0?s:w,this}vr.prototype.clear=sp,vr.prototype.delete=np,vr.prototype.get=ip,vr.prototype.has=ap,vr.prototype.set=op;function zt(m){var w=-1,b=m==null?0:m.length;for(this.clear();++w<b;){var x=m[w];this.set(x[0],x[1])}}function cp(){this.__data__=[],this.size=0}function lp(m){var w=this.__data__,b=Rn(w,m);if(b<0)return!1;var x=w.length-1;return b==x?w.pop():vn.call(w,b,1),--this.size,!0}function dp(m){var w=this.__data__,b=Rn(w,m);return b<0?void 0:w[b][1]}function up(m){return Rn(this.__data__,m)>-1}function hp(m,w){var b=this.__data__,x=Rn(b,m);return x<0?(++this.size,b.push([m,w])):b[x][1]=w,this}zt.prototype.clear=cp,zt.prototype.delete=lp,zt.prototype.get=dp,zt.prototype.has=up,zt.prototype.set=hp;function jr(m){var w=-1,b=m==null?0:m.length;for(this.clear();++w<b;){var x=m[w];this.set(x[0],x[1])}}function pp(){this.size=0,this.__data__={hash:new vr,map:new(ac||zt),string:new vr}}function fp(m){var w=Cn(this,m).delete(m);return this.size-=w?1:0,w}function mp(m){return Cn(this,m).get(m)}function gp(m){return Cn(this,m).has(m)}function _p(m,w){var b=Cn(this,m),x=b.size;return b.set(m,w),this.size+=b.size==x?0:1,this}jr.prototype.clear=pp,jr.prototype.delete=fp,jr.prototype.get=mp,jr.prototype.has=gp,jr.prototype.set=_p;function $r(m){var w=this.__data__=new zt(m);this.size=w.size}function wp(){this.__data__=new zt,this.size=0}function yp(m){var w=this.__data__,b=w.delete(m);return this.size=w.size,b}function bp(m){return this.__data__.get(m)}function vp(m){return this.__data__.has(m)}function Sp(m,w){var b=this.__data__;if(b instanceof zt){var x=b.__data__;if(!ac||x.length<t-1)return x.push([m,w]),this.size=++b.size,this;b=this.__data__=new jr(x)}return b.set(m,w),this.size=b.size,this}$r.prototype.clear=wp,$r.prototype.delete=yp,$r.prototype.get=bp,$r.prototype.has=vp,$r.prototype.set=Sp;function Rp(m,w){var b=Yi(m),x=!b&&Ki(m),Z=!b&&!x&&hc(m),oe=!b&&!x&&!Z&&fc(m),we=b||x||Z||oe,W=we?gr(m.length,String):[],ye=W.length;for(var st in m)(w||Ae.call(m,st))&&!(we&&(st=="length"||Z&&(st=="offset"||st=="parent")||oe&&(st=="buffer"||st=="byteLength"||st=="byteOffset")||dc(st,ye)))&&W.push(st);return W}function Hi(m,w,b){(b!==void 0&&!Dn(m[w],b)||b===void 0&&!(w in m))&&Gi(m,w,b)}function Tp(m,w,b){var x=m[w];(!(Ae.call(m,w)&&Dn(x,b))||b===void 0&&!(w in m))&&Gi(m,w,b)}function Rn(m,w){for(var b=m.length;b--;)if(Dn(m[b][0],w))return b;return-1}function Gi(m,w,b){w=="__proto__"&&Sn?Sn(m,w,{configurable:!0,enumerable:!0,value:b,writable:!0}):m[w]=b}var Cp=jp();function Tn(m){return m==null?m===void 0?Y:k:br&&br in Object(m)?$p(m):Vp(m)}function oc(m){return Ms(m)&&Tn(m)==o}function Dp(m){if(!Vt(m)||Bp(m))return!1;var w=Xi(m)?q:Le;return w.test(Wp(m))}function Ep(m){return Ms(m)&&pc(m.length)&&!!H[Tn(m)]}function kp(m){if(!Vt(m))return zp(m);var w=uc(m),b=[];for(var x in m)x=="constructor"&&(w||!Ae.call(m,x))||b.push(x);return b}function Zi(m,w,b,x,Z){m!==w&&Cp(w,function(oe,we){if(Z||(Z=new $r),Vt(oe))Op(m,w,we,b,Zi,x,Z);else{var W=x?x(Ji(m,we),oe,we+"",m,w,Z):void 0;W===void 0&&(W=oe),Hi(m,we,W)}},mc)}function Op(m,w,b,x,Z,oe,we){var W=Ji(m,b),ye=Ji(w,b),st=we.get(ye);if(st){Hi(m,b,st);return}var Je=oe?oe(W,ye,b+"",m,w,we):void 0,Is=Je===void 0;if(Is){var ea=Yi(ye),ta=!ea&&hc(ye),_c=!ea&&!ta&&fc(ye);Je=ye,ea||ta||_c?Yi(W)?Je=W:Jp(W)?Je=Lp(W):ta?(Is=!1,Je=Pp(ye,!0)):_c?(Is=!1,Je=Ip(ye,!0)):Je=[]:Kp(ye)||Ki(ye)?(Je=W,Ki(W)?Je=Yp(W):(!Vt(W)||Xi(W))&&(Je=Fp(ye))):Is=!1}Is&&(we.set(ye,Je),Z(Je,ye,x,oe,we),we.delete(ye)),Hi(m,b,Je)}function cc(m,w){return Gp(Hp(m,w,gc),m+"")}var xp=Sn?function(m,w){return Sn(m,"toString",{configurable:!0,enumerable:!1,value:ef(w),writable:!0})}:gc;function Pp(m,w){if(w)return m.slice();var b=m.length,x=X?X(b):new m.constructor(b);return m.copy(x),x}function Mp(m){var w=new m.constructor(m.byteLength);return new Ze(w).set(new Ze(m)),w}function Ip(m,w){var b=w?Mp(m.buffer):m.buffer;return new m.constructor(b,m.byteOffset,m.length)}function Lp(m,w){var b=-1,x=m.length;for(w||(w=Array(x));++b<x;)w[b]=m[b];return w}function Np(m,w,b,x){var Z=!b;b||(b={});for(var oe=-1,we=w.length;++oe<we;){var W=w[oe],ye=x?x(b[W],m[W],W,b,m):void 0;ye===void 0&&(ye=m[W]),Z?Gi(b,W,ye):Tp(b,W,ye)}return b}function Ap(m){return cc(function(w,b){var x=-1,Z=b.length,oe=Z>1?b[Z-1]:void 0,we=Z>2?b[2]:void 0;for(oe=m.length>3&&typeof oe=="function"?(Z--,oe):void 0,we&&Up(b[0],b[1],we)&&(oe=Z<3?void 0:oe,Z=1),w=Object(w);++x<Z;){var W=b[x];W&&m(w,W,x,oe)}return w})}function jp(m){return function(w,b,x){for(var Z=-1,oe=Object(w),we=x(w),W=we.length;W--;){var ye=we[m?W:++Z];if(b(oe[ye],ye,oe)===!1)break}return w}}function lc(m,w,b,x,Z,oe){return Vt(m)&&Vt(w)&&(oe.set(w,m),Zi(m,w,void 0,lc,oe),oe.delete(w)),m}function Cn(m,w){var b=m.__data__;return qp(w)?b[typeof w=="string"?"string":"hash"]:b.map}function Wi(m,w){var b=ks(m,w);return Dp(b)?b:void 0}function $p(m){var w=Ae.call(m,br),b=m[br];try{m[br]=void 0;var x=!0}catch{}var Z=V.call(m);return x&&(w?m[br]=b:delete m[br]),Z}function Fp(m){return typeof m.constructor=="function"&&!uc(m)?rp($(m)):{}}function dc(m,w){var b=typeof m;return w=w??a,!!w&&(b=="number"||b!="symbol"&&Dt.test(m))&&m>-1&&m%1==0&&m<w}function Up(m,w,b){if(!Vt(b))return!1;var x=typeof w;return(x=="number"?Qi(b)&&dc(w,b.length):x=="string"&&w in b)?Dn(b[w],m):!1}function qp(m){var w=typeof m;return w=="string"||w=="number"||w=="symbol"||w=="boolean"?m!=="__proto__":m===null}function Bp(m){return!!yr&&yr in m}function uc(m){var w=m&&m.constructor,b=typeof w=="function"&&w.prototype||wr;return m===b}function zp(m){var w=[];if(m!=null)for(var b in Object(m))w.push(b);return w}function Vp(m){return V.call(m)}function Hp(m,w,b){return w=ic(w===void 0?m.length-1:w,0),function(){for(var x=arguments,Z=-1,oe=ic(x.length-w,0),we=Array(oe);++Z<oe;)we[Z]=x[w+Z];Z=-1;for(var W=Array(w+1);++Z<w;)W[Z]=x[Z];return W[w]=b(we),Es(m,this,W)}}function Ji(m,w){if(!(w==="constructor"&&typeof m[w]=="function")&&w!="__proto__")return m[w]}var Gp=Zp(xp);function Zp(m){var w=0,b=0;return function(){var x=tp(),Z=i-(x-b);if(b=x,Z>0){if(++w>=n)return arguments[0]}else w=0;return m.apply(void 0,arguments)}}function Wp(m){if(m!=null){try{return Ne.call(m)}catch{}try{return m+""}catch{}}return""}function Dn(m,w){return m===w||m!==m&&w!==w}var Ki=oc(function(){return arguments}())?oc:function(m){return Ms(m)&&Ae.call(m,"callee")&&!xs.call(m,"callee")},Yi=Array.isArray;function Qi(m){return m!=null&&pc(m.length)&&!Xi(m)}function Jp(m){return Ms(m)&&Qi(m)}var hc=ep||tf;function Xi(m){if(!Vt(m))return!1;var w=Tn(m);return w==p||w==f||w==u||w==D}function pc(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=a}function Vt(m){var w=typeof m;return m!=null&&(w=="object"||w=="function")}function Ms(m){return m!=null&&typeof m=="object"}function Kp(m){if(!Ms(m)||Tn(m)!=P)return!1;var w=$(m);if(w===null)return!0;var b=Ae.call(w,"constructor")&&w.constructor;return typeof b=="function"&&b instanceof b&&Ne.call(b)==ie}var fc=mr?zi(mr):Ep;function Yp(m){return Np(m,mc(m))}var Qp=cc(function(m){return m.push(void 0,lc),Es(Xp,void 0,m)});function mc(m){return Qi(m)?Rp(m,!0):kp(m)}var Xp=Ap(function(m,w,b,x){Zi(m,w,b,x)});function ef(m){return function(){return m}}function gc(m){return m}function tf(){return!1}r.exports=Qp})(si,si.exports);var oy=si.exports;const kl=Qs(oy),cy="https://api.revolt.chat",ly={1:[[""]],2:[["admin","stats"],["users","@me"],["users",["{target}"]],["users","dms"],["users","friend"],["bots","create"],["bots",["{bot}"]],["bots","@me"],["bots",["{target}"]],["channels",["{target}"]],["channels","create"],["servers","create"],["servers",["{target}"]],["invites",["{target}"]],["safety","report"],["onboard","hello"],["onboard","complete"],["push","subscribe"],["push","unsubscribe"],["sync","unreads"],["webhooks",["{webhook_id}"]]],3:[["users",["{target}"],"flags"],["users","@me","username"],["users",["{target}"],"default_avatar"],["users",["{target}"],"profile"],["users",["{target}"],"dm"],["users",["{target}"],"mutual"],["users",["{target}"],"friend"],["users",["{target}"],"block"],["bots",["{target}"],"invite"],["channels",["{target}"],"members"],["channels",["{target}"],"invites"],["channels",["{target}"],"messages"],["channels",["{target}"],"search"],["channels",["{target}"],"join_call"],["channels",["{target}"],"webhooks"],["channels",["{channel_id}"],"webhooks"],["servers",["{target}"],"ack"],["servers",["{target}"],"channels"],["servers",["{target}"],"members"],["servers",["{target}"],"members_experimental_query"],["servers",["{target}"],"bans"],["servers",["{target}"],"invites"],["servers",["{target}"],"roles"],["servers",["{target}"],"emojis"],["custom","emoji",["{id}"]],["auth","account","create"],["auth","account","reverify"],["auth","account","delete"],["auth","account",""],["auth","account","disable"],["auth","account","reset_password"],["auth","session","login"],["auth","session","logout"],["auth","session","all"],["auth","session",["{id}"]],["auth","mfa","ticket"],["auth","mfa",""],["auth","mfa","recovery"],["auth","mfa","methods"],["auth","mfa","totp"],["sync","settings","fetch"],["sync","settings","set"],["webhooks",["{webhook_id}"],["{token}"]]],4:[["channels",["{target}"],"ack",["{message}"]],["channels",["{_target}"],"messages","stale"],["channels",["{target}"],"messages",["{msg}"]],["channels",["{target}"],"messages","bulk"],["channels",["{target}"],"recipients",["{member}"]],["channels",["{target}"],"permissions",["{role_id}"]],["channels",["{target}"],"permissions","default"],["servers",["{target}"],"members",["{member}"]],["servers",["{server}"],"members",["{target}"]],["servers",["{server}"],"bans",["{target}"]],["servers",["{target}"],"roles",["{role_id}"]],["servers",["{target}"],"permissions",["{role_id}"]],["servers",["{target}"],"permissions","default"],["auth","account","change","password"],["auth","account","change","email"],["auth","account","verify",["{code}"]],["webhooks",["{webhook_id}"],["{token}"],"github"]],5:[["channels",["{target}"],"messages",["{msg}"],"reactions"]],6:[["channels",["{target}"],"messages",["{msg}"],"reactions",["{emoji}"]]]},dy={"/":{get:[]},"/admin/stats":{get:[]},"/users/@me":{get:[]},"/users/{target}":{get:[],patch:[]},"/users/{target}/flags":{get:[]},"/users/@me/username":{patch:[]},"/users/{target}/default_avatar":{get:[]},"/users/{target}/profile":{get:[]},"/users/dms":{get:[]},"/users/{target}/dm":{get:[]},"/users/{target}/mutual":{get:[]},"/users/{target}/friend":{put:[],delete:[]},"/users/{target}/block":{put:[],delete:[]},"/users/friend":{post:[]},"/bots/create":{post:[]},"/bots/{target}/invite":{get:[],post:[]},"/bots/{bot}":{get:[]},"/bots/@me":{get:[]},"/bots/{target}":{delete:[],patch:[]},"/channels/{target}/ack/{message}":{put:[]},"/channels/{target}":{get:[],delete:["leave_silently"],patch:[]},"/channels/{target}/members":{get:[]},"/channels/{target}/invites":{post:[]},"/channels/{target}/messages":{get:["limit","before","after","sort","nearby","include_users"],post:[]},"/channels/{target}/search":{post:[]},"/channels/{_target}/messages/stale":{post:[]},"/channels/{target}/messages/{msg}":{get:[],delete:[],patch:[]},"/channels/{target}/messages/bulk":{delete:[]},"/channels/create":{post:[]},"/channels/{target}/recipients/{member}":{put:[],delete:[]},"/channels/{target}/join_call":{post:[]},"/channels/{target}/permissions/{role_id}":{put:[]},"/channels/{target}/permissions/default":{put:[]},"/channels/{target}/messages/{msg}/reactions/{emoji}":{put:[],delete:["user_id","remove_all"]},"/channels/{target}/messages/{msg}/reactions":{delete:[]},"/channels/{target}/webhooks":{post:[]},"/channels/{channel_id}/webhooks":{get:[]},"/servers/create":{post:[]},"/servers/{target}":{get:["include_channels"],delete:["leave_silently"],patch:[]},"/servers/{target}/ack":{put:[]},"/servers/{target}/channels":{post:[]},"/servers/{target}/members":{get:["exclude_offline"]},"/servers/{target}/members/{member}":{get:[],delete:[]},"/servers/{server}/members/{target}":{patch:[]},"/servers/{target}/members_experimental_query":{get:["query","experimental_api"]},"/servers/{server}/bans/{target}":{put:[],delete:[]},"/servers/{target}/bans":{get:[]},"/servers/{target}/invites":{get:[]},"/servers/{target}/roles":{post:[]},"/servers/{target}/roles/{role_id}":{delete:[],patch:[]},"/servers/{target}/permissions/{role_id}":{put:[]},"/servers/{target}/permissions/default":{put:[]},"/servers/{target}/emojis":{get:[]},"/invites/{target}":{get:[],post:[],delete:[]},"/custom/emoji/{id}":{get:[],put:[],delete:[]},"/safety/report":{post:[]},"/auth/account/create":{post:[]},"/auth/account/reverify":{post:[]},"/auth/account/delete":{put:[],post:[]},"/auth/account/":{get:[]},"/auth/account/disable":{post:[]},"/auth/account/change/password":{patch:[]},"/auth/account/change/email":{patch:[]},"/auth/account/verify/{code}":{post:[]},"/auth/account/reset_password":{post:[],patch:[]},"/auth/session/login":{post:[]},"/auth/session/logout":{post:[]},"/auth/session/all":{get:[],delete:["revoke_self"]},"/auth/session/{id}":{delete:[],patch:[]},"/auth/mfa/ticket":{put:[]},"/auth/mfa/":{get:[]},"/auth/mfa/recovery":{post:[],patch:[]},"/auth/mfa/methods":{get:[]},"/auth/mfa/totp":{put:[],post:[],delete:[]},"/onboard/hello":{get:[]},"/onboard/complete":{post:[]},"/push/subscribe":{post:[]},"/push/unsubscribe":{post:[]},"/sync/settings/fetch":{post:[]},"/sync/settings/set":{post:["timestamp"]},"/sync/unreads":{get:[]},"/webhooks/{webhook_id}/{token}":{get:[],post:[],delete:[],patch:[]},"/webhooks/{webhook_id}":{get:[],delete:[],patch:[]},"/webhooks/{webhook_id}/{token}/github":{post:[]}};function uy(r){const e=r.split("/"),t=ly[(e.length-1).toString()]||[];for(const s of t){let n=1,i=[...e];for(n;n<e.length;n++)if(Array.isArray(s[n-1])){i[n]=s[n-1];continue}else if(s[n-1]!==e[n])break;if(n===e.length)return i.join("/")}}class Ol{constructor({baseURL:e,authentication:t}={}){T(this,"baseURL");T(this,"authentication");this.baseURL=e||cy,this.authentication=t||{}}get auth(){if(this.authentication.rauth){if(typeof this.authentication.rauth=="string")return{headers:{"X-Session-Token":this.authentication.rauth}}}else if(this.authentication.revolt)switch(typeof this.authentication.revolt){case"string":return{headers:{"X-Bot-Token":this.authentication.revolt}};case"object":return{headers:{"X-Session-Token":this.authentication.revolt.token}}}return{}}get config(){return{baseURL:this.baseURL,...this.auth}}req(e,t,s,n){let i,a,o=uy(t);if(o&&typeof s=="object"){const u=dy[o][e];for(const l of Object.keys(s))u!=null&&u.includes(l)?i={...i||{},[l]:s[l]}:a={...a||{},[l]:s[l]}}return ay(t,kl({method:e,params:i,data:a},kl(n,this.config))).then(c=>c.data)}get(e,t,s){return this.req("get",e,t,s)}patch(e,t,s){return this.req("patch",e,t,s)}put(e,t,s){return this.req("put",e,t,s)}delete(e,t,s){return this.req("delete",e,t,s)}post(e,t,s){return this.req("post",e,t,s)}}var At;(function(r){r.Blocked="Blocked",r.Friend="Friend",r.Incoming="Incoming",r.None="None",r.Outgoing="Outgoing",r.Self="User",r.SelfBlocked="BlockedOther"})(At||(At={}));var Ye;(function(r){r.GroupDescriptionChange="channel_description_changed",r.GroupIconChange="channel_icon_changed",r.GroupOwnershipChange="channel_ownership_changed",r.GroupRenamed="channel_renamed",r.Text="text",r.UserAdded="user_added",r.UserBanned="user_banned",r.UserJoined="user_joined",r.UserKicked="user_kicked",r.UserLeft="user_left",r.UserRemoved="user_remove"})(Ye||(Ye={}));const ro="00000000000000000000000000";function vu(r,e){return function(){return r.apply(e,arguments)}}const{toString:hy}=Object.prototype,{getPrototypeOf:zo}=Object,Mi=(r=>e=>{const t=hy.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),qt=r=>(r=r.toLowerCase(),e=>Mi(e)===r),Ii=r=>e=>typeof e===r,{isArray:bs}=Array,Ws=Ii("undefined");function py(r){return r!==null&&!Ws(r)&&r.constructor!==null&&!Ws(r.constructor)&&ht(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Su=qt("ArrayBuffer");function fy(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&Su(r.buffer),e}const my=Ii("string"),ht=Ii("function"),Ru=Ii("number"),Li=r=>r!==null&&typeof r=="object",gy=r=>r===!0||r===!1,Yn=r=>{if(Mi(r)!=="object")return!1;const e=zo(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},_y=qt("Date"),wy=qt("File"),yy=qt("Blob"),by=qt("FileList"),vy=r=>Li(r)&&ht(r.pipe),Sy=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||ht(r.append)&&((e=Mi(r))==="formdata"||e==="object"&&ht(r.toString)&&r.toString()==="[object FormData]"))},Ry=qt("URLSearchParams"),Ty=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function pn(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let s,n;if(typeof r!="object"&&(r=[r]),bs(r))for(s=0,n=r.length;s<n;s++)e.call(null,r[s],s,r);else{const i=t?Object.getOwnPropertyNames(r):Object.keys(r),a=i.length;let o;for(s=0;s<a;s++)o=i[s],e.call(null,r[o],o,r)}}function Tu(r,e){e=e.toLowerCase();const t=Object.keys(r);let s=t.length,n;for(;s-- >0;)if(n=t[s],e===n.toLowerCase())return n;return null}const Cu=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),Du=r=>!Ws(r)&&r!==Cu;function so(){const{caseless:r}=Du(this)&&this||{},e={},t=(s,n)=>{const i=r&&Tu(e,n)||n;Yn(e[i])&&Yn(s)?e[i]=so(e[i],s):Yn(s)?e[i]=so({},s):bs(s)?e[i]=s.slice():e[i]=s};for(let s=0,n=arguments.length;s<n;s++)arguments[s]&&pn(arguments[s],t);return e}const Cy=(r,e,t,{allOwnKeys:s}={})=>(pn(e,(n,i)=>{t&&ht(n)?r[i]=vu(n,t):r[i]=n},{allOwnKeys:s}),r),Dy=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Ey=(r,e,t,s)=>{r.prototype=Object.create(e.prototype,s),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},ky=(r,e,t,s)=>{let n,i,a;const o={};if(e=e||{},r==null)return e;do{for(n=Object.getOwnPropertyNames(r),i=n.length;i-- >0;)a=n[i],(!s||s(a,r,e))&&!o[a]&&(e[a]=r[a],o[a]=!0);r=t!==!1&&zo(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},Oy=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const s=r.indexOf(e,t);return s!==-1&&s===t},xy=r=>{if(!r)return null;if(bs(r))return r;let e=r.length;if(!Ru(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},Py=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&zo(Uint8Array)),My=(r,e)=>{const s=(r&&r[Symbol.iterator]).call(r);let n;for(;(n=s.next())&&!n.done;){const i=n.value;e.call(r,i[0],i[1])}},Iy=(r,e)=>{let t;const s=[];for(;(t=r.exec(e))!==null;)s.push(t);return s},Ly=qt("HTMLFormElement"),Ny=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,n){return s.toUpperCase()+n}),xl=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),Ay=qt("RegExp"),Eu=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),s={};pn(t,(n,i)=>{let a;(a=e(n,i,r))!==!1&&(s[i]=a||n)}),Object.defineProperties(r,s)},jy=r=>{Eu(r,(e,t)=>{if(ht(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=r[t];if(ht(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},$y=(r,e)=>{const t={},s=n=>{n.forEach(i=>{t[i]=!0})};return bs(r)?s(r):s(String(r).split(e)),t},Fy=()=>{},Uy=(r,e)=>(r=+r,Number.isFinite(r)?r:e),Na="abcdefghijklmnopqrstuvwxyz",Pl="0123456789",ku={DIGIT:Pl,ALPHA:Na,ALPHA_DIGIT:Na+Na.toUpperCase()+Pl},qy=(r=16,e=ku.ALPHA_DIGIT)=>{let t="";const{length:s}=e;for(;r--;)t+=e[Math.random()*s|0];return t};function By(r){return!!(r&&ht(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const zy=r=>{const e=new Array(10),t=(s,n)=>{if(Li(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[n]=s;const i=bs(s)?[]:{};return pn(s,(a,o)=>{const c=t(a,n+1);!Ws(c)&&(i[o]=c)}),e[n]=void 0,i}}return s};return t(r,0)},Vy=qt("AsyncFunction"),Hy=r=>r&&(Li(r)||ht(r))&&ht(r.then)&&ht(r.catch),S={isArray:bs,isArrayBuffer:Su,isBuffer:py,isFormData:Sy,isArrayBufferView:fy,isString:my,isNumber:Ru,isBoolean:gy,isObject:Li,isPlainObject:Yn,isUndefined:Ws,isDate:_y,isFile:wy,isBlob:yy,isRegExp:Ay,isFunction:ht,isStream:vy,isURLSearchParams:Ry,isTypedArray:Py,isFileList:by,forEach:pn,merge:so,extend:Cy,trim:Ty,stripBOM:Dy,inherits:Ey,toFlatObject:ky,kindOf:Mi,kindOfTest:qt,endsWith:Oy,toArray:xy,forEachEntry:My,matchAll:Iy,isHTMLForm:Ly,hasOwnProperty:xl,hasOwnProp:xl,reduceDescriptors:Eu,freezeMethods:jy,toObjectSet:$y,toCamelCase:Ny,noop:Fy,toFiniteNumber:Uy,findKey:Tu,global:Cu,isContextDefined:Du,ALPHABET:ku,generateString:qy,isSpecCompliantForm:By,toJSONObject:zy,isAsyncFn:Vy,isThenable:Hy};function Q(r,e,t,s,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),n&&(this.response=n)}S.inherits(Q,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:S.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Ou=Q.prototype,xu={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{xu[r]={value:r}});Object.defineProperties(Q,xu);Object.defineProperty(Ou,"isAxiosError",{value:!0});Q.from=(r,e,t,s,n,i)=>{const a=Object.create(Ou);return S.toFlatObject(r,a,function(c){return c!==Error.prototype},o=>o!=="isAxiosError"),Q.call(a,r.message,e,t,s,n),a.cause=r,a.name=r.name,i&&Object.assign(a,i),a};const Gy=null;function no(r){return S.isPlainObject(r)||S.isArray(r)}function Pu(r){return S.endsWith(r,"[]")?r.slice(0,-2):r}function Ml(r,e,t){return r?r.concat(e).map(function(n,i){return n=Pu(n),!t&&i?"["+n+"]":n}).join(t?".":""):e}function Zy(r){return S.isArray(r)&&!r.some(no)}const Wy=S.toFlatObject(S,{},null,function(e){return/^is[A-Z]/.test(e)});function Ni(r,e,t){if(!S.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=S.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,g){return!S.isUndefined(g[_])});const s=t.metaTokens,n=t.visitor||l,i=t.dots,a=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&S.isSpecCompliantForm(e);if(!S.isFunction(n))throw new TypeError("visitor must be a function");function u(f){if(f===null)return"";if(S.isDate(f))return f.toISOString();if(!c&&S.isBlob(f))throw new Q("Blob is not supported. Use a Buffer instead.");return S.isArrayBuffer(f)||S.isTypedArray(f)?c&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function l(f,_,g){let k=f;if(f&&!g&&typeof f=="object"){if(S.endsWith(_,"{}"))_=s?_:_.slice(0,-2),f=JSON.stringify(f);else if(S.isArray(f)&&Zy(f)||(S.isFileList(f)||S.endsWith(_,"[]"))&&(k=S.toArray(f)))return _=Pu(_),k.forEach(function(D,C){!(S.isUndefined(D)||D===null)&&e.append(a===!0?Ml([_],C,i):a===null?_:_+"[]",u(D))}),!1}return no(f)?!0:(e.append(Ml(g,_,i),u(f)),!1)}const d=[],h=Object.assign(Wy,{defaultVisitor:l,convertValue:u,isVisitable:no});function p(f,_){if(!S.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+_.join("."));d.push(f),S.forEach(f,function(k,P){(!(S.isUndefined(k)||k===null)&&n.call(e,k,S.isString(P)?P.trim():P,_,h))===!0&&p(k,_?_.concat(P):[P])}),d.pop()}}if(!S.isObject(r))throw new TypeError("data must be an object");return p(r),e}function Il(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Vo(r,e){this._pairs=[],r&&Ni(r,this,e)}const Mu=Vo.prototype;Mu.append=function(e,t){this._pairs.push([e,t])};Mu.toString=function(e){const t=e?function(s){return e.call(this,s,Il)}:Il;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function Jy(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Iu(r,e,t){if(!e)return r;const s=t&&t.encode||Jy,n=t&&t.serialize;let i;if(n?i=n(e,t):i=S.isURLSearchParams(e)?e.toString():new Vo(e,t).toString(s),i){const a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+i}return r}class Ky{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){S.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Ll=Ky,Lu={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Yy=typeof URLSearchParams<"u"?URLSearchParams:Vo,Qy=typeof FormData<"u"?FormData:null,Xy=typeof Blob<"u"?Blob:null,eb=(()=>{let r;return typeof navigator<"u"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),tb=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),jt={isBrowser:!0,classes:{URLSearchParams:Yy,FormData:Qy,Blob:Xy},isStandardBrowserEnv:eb,isStandardBrowserWebWorkerEnv:tb,protocols:["http","https","file","blob","url","data"]};function rb(r,e){return Ni(r,new jt.classes.URLSearchParams,Object.assign({visitor:function(t,s,n,i){return jt.isNode&&S.isBuffer(t)?(this.append(s,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function sb(r){return S.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function nb(r){const e={},t=Object.keys(r);let s;const n=t.length;let i;for(s=0;s<n;s++)i=t[s],e[i]=r[i];return e}function Nu(r){function e(t,s,n,i){let a=t[i++];const o=Number.isFinite(+a),c=i>=t.length;return a=!a&&S.isArray(n)?n.length:a,c?(S.hasOwnProp(n,a)?n[a]=[n[a],s]:n[a]=s,!o):((!n[a]||!S.isObject(n[a]))&&(n[a]=[]),e(t,s,n[a],i)&&S.isArray(n[a])&&(n[a]=nb(n[a])),!o)}if(S.isFormData(r)&&S.isFunction(r.entries)){const t={};return S.forEachEntry(r,(s,n)=>{e(sb(s),n,t,0)}),t}return null}function ib(r,e,t){if(S.isString(r))try{return(e||JSON.parse)(r),S.trim(r)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(r)}const Ho={transitional:Lu,adapter:["xhr","http"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,i=S.isObject(e);if(i&&S.isHTMLForm(e)&&(e=new FormData(e)),S.isFormData(e))return n&&n?JSON.stringify(Nu(e)):e;if(S.isArrayBuffer(e)||S.isBuffer(e)||S.isStream(e)||S.isFile(e)||S.isBlob(e))return e;if(S.isArrayBufferView(e))return e.buffer;if(S.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return rb(e,this.formSerializer).toString();if((o=S.isFileList(e))||s.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Ni(o?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),ib(e)):e}],transformResponse:[function(e){const t=this.transitional||Ho.transitional,s=t&&t.forcedJSONParsing,n=this.responseType==="json";if(e&&S.isString(e)&&(s&&!this.responseType||n)){const a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?Q.from(o,Q.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:jt.classes.FormData,Blob:jt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};S.forEach(["delete","get","head","post","put","patch"],r=>{Ho.headers[r]={}});const Go=Ho,ab=S.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ob=r=>{const e={};let t,s,n;return r&&r.split(`
`).forEach(function(a){n=a.indexOf(":"),t=a.substring(0,n).trim().toLowerCase(),s=a.substring(n+1).trim(),!(!t||e[t]&&ab[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Nl=Symbol("internals");function $s(r){return r&&String(r).trim().toLowerCase()}function Qn(r){return r===!1||r==null?r:S.isArray(r)?r.map(Qn):String(r)}function cb(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(r);)e[s[1]]=s[2];return e}const lb=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Aa(r,e,t,s,n){if(S.isFunction(s))return s.call(this,e,t);if(n&&(e=t),!!S.isString(e)){if(S.isString(s))return e.indexOf(s)!==-1;if(S.isRegExp(s))return s.test(e)}}function db(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function ub(r,e){const t=S.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(r,s+t,{value:function(n,i,a){return this[s].call(this,e,n,i,a)},configurable:!0})})}class Ai{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function i(o,c,u){const l=$s(c);if(!l)throw new Error("header name must be a non-empty string");const d=S.findKey(n,l);(!d||n[d]===void 0||u===!0||u===void 0&&n[d]!==!1)&&(n[d||c]=Qn(o))}const a=(o,c)=>S.forEach(o,(u,l)=>i(u,l,c));return S.isPlainObject(e)||e instanceof this.constructor?a(e,t):S.isString(e)&&(e=e.trim())&&!lb(e)?a(ob(e),t):e!=null&&i(t,e,s),this}get(e,t){if(e=$s(e),e){const s=S.findKey(this,e);if(s){const n=this[s];if(!t)return n;if(t===!0)return cb(n);if(S.isFunction(t))return t.call(this,n,s);if(S.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=$s(e),e){const s=S.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Aa(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let n=!1;function i(a){if(a=$s(a),a){const o=S.findKey(s,a);o&&(!t||Aa(s,s[o],o,t))&&(delete s[o],n=!0)}}return S.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const i=t[s];(!e||Aa(this,this[i],i,e,!0))&&(delete this[i],n=!0)}return n}normalize(e){const t=this,s={};return S.forEach(this,(n,i)=>{const a=S.findKey(s,i);if(a){t[a]=Qn(n),delete t[i];return}const o=e?db(i):String(i).trim();o!==i&&delete t[i],t[o]=Qn(n),s[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return S.forEach(this,(s,n)=>{s!=null&&s!==!1&&(t[n]=e&&S.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(n=>s.set(n)),s}static accessor(e){const s=(this[Nl]=this[Nl]={accessors:{}}).accessors,n=this.prototype;function i(a){const o=$s(a);s[o]||(ub(n,a),s[o]=!0)}return S.isArray(e)?e.forEach(i):i(e),this}}Ai.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);S.reduceDescriptors(Ai.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(s){this[t]=s}}});S.freezeMethods(Ai);const Jt=Ai;function ja(r,e){const t=this||Go,s=e||t,n=Jt.from(s.headers);let i=s.data;return S.forEach(r,function(o){i=o.call(t,i,n.normalize(),e?e.status:void 0)}),n.normalize(),i}function Au(r){return!!(r&&r.__CANCEL__)}function fn(r,e,t){Q.call(this,r??"canceled",Q.ERR_CANCELED,e,t),this.name="CanceledError"}S.inherits(fn,Q,{__CANCEL__:!0});function hb(r,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?r(t):e(new Q("Request failed with status code "+t.status,[Q.ERR_BAD_REQUEST,Q.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const pb=jt.isStandardBrowserEnv?function(){return{write:function(t,s,n,i,a,o){const c=[];c.push(t+"="+encodeURIComponent(s)),S.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),S.isString(i)&&c.push("path="+i),S.isString(a)&&c.push("domain="+a),o===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){const s=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function fb(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function mb(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function ju(r,e){return r&&!fb(e)?mb(r,e):e}const gb=jt.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let s;function n(i){let a=i;return e&&(t.setAttribute("href",a),a=t.href),t.setAttribute("href",a),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return s=n(window.location.href),function(a){const o=S.isString(a)?n(a):a;return o.protocol===s.protocol&&o.host===s.host}}():function(){return function(){return!0}}();function _b(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function wb(r,e){r=r||10;const t=new Array(r),s=new Array(r);let n=0,i=0,a;return e=e!==void 0?e:1e3,function(c){const u=Date.now(),l=s[i];a||(a=u),t[n]=c,s[n]=u;let d=i,h=0;for(;d!==n;)h+=t[d++],d=d%r;if(n=(n+1)%r,n===i&&(i=(i+1)%r),u-a<e)return;const p=l&&u-l;return p?Math.round(h*1e3/p):void 0}}function Al(r,e){let t=0;const s=wb(50,250);return n=>{const i=n.loaded,a=n.lengthComputable?n.total:void 0,o=i-t,c=s(o),u=i<=a;t=i;const l={loaded:i,total:a,progress:a?i/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&u?(a-i)/c:void 0,event:n};l[e?"download":"upload"]=!0,r(l)}}const yb=typeof XMLHttpRequest<"u",bb=yb&&function(r){return new Promise(function(t,s){let n=r.data;const i=Jt.from(r.headers).normalize(),a=r.responseType;let o;function c(){r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let u;S.isFormData(n)&&(jt.isStandardBrowserEnv||jt.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.getContentType(/^\s*multipart\/form-data/)?S.isString(u=i.getContentType())&&i.setContentType(u.replace(/^\s*(multipart\/form-data);+/,"$1")):i.setContentType("multipart/form-data"));let l=new XMLHttpRequest;if(r.auth){const f=r.auth.username||"",_=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";i.set("Authorization","Basic "+btoa(f+":"+_))}const d=ju(r.baseURL,r.url);l.open(r.method.toUpperCase(),Iu(d,r.params,r.paramsSerializer),!0),l.timeout=r.timeout;function h(){if(!l)return;const f=Jt.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders()),g={data:!a||a==="text"||a==="json"?l.responseText:l.response,status:l.status,statusText:l.statusText,headers:f,config:r,request:l};hb(function(P){t(P),c()},function(P){s(P),c()},g),l=null}if("onloadend"in l?l.onloadend=h:l.onreadystatechange=function(){!l||l.readyState!==4||l.status===0&&!(l.responseURL&&l.responseURL.indexOf("file:")===0)||setTimeout(h)},l.onabort=function(){l&&(s(new Q("Request aborted",Q.ECONNABORTED,r,l)),l=null)},l.onerror=function(){s(new Q("Network Error",Q.ERR_NETWORK,r,l)),l=null},l.ontimeout=function(){let _=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const g=r.transitional||Lu;r.timeoutErrorMessage&&(_=r.timeoutErrorMessage),s(new Q(_,g.clarifyTimeoutError?Q.ETIMEDOUT:Q.ECONNABORTED,r,l)),l=null},jt.isStandardBrowserEnv){const f=(r.withCredentials||gb(d))&&r.xsrfCookieName&&pb.read(r.xsrfCookieName);f&&i.set(r.xsrfHeaderName,f)}n===void 0&&i.setContentType(null),"setRequestHeader"in l&&S.forEach(i.toJSON(),function(_,g){l.setRequestHeader(g,_)}),S.isUndefined(r.withCredentials)||(l.withCredentials=!!r.withCredentials),a&&a!=="json"&&(l.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&l.addEventListener("progress",Al(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&l.upload&&l.upload.addEventListener("progress",Al(r.onUploadProgress)),(r.cancelToken||r.signal)&&(o=f=>{l&&(s(!f||f.type?new fn(null,r,l):f),l.abort(),l=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const p=_b(d);if(p&&jt.protocols.indexOf(p)===-1){s(new Q("Unsupported protocol "+p+":",Q.ERR_BAD_REQUEST,r));return}l.send(n||null)})},io={http:Gy,xhr:bb};S.forEach(io,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const jl=r=>`- ${r}`,vb=r=>S.isFunction(r)||r===null||r===!1,$u={getAdapter:r=>{r=S.isArray(r)?r:[r];const{length:e}=r;let t,s;const n={};for(let i=0;i<e;i++){t=r[i];let a;if(s=t,!vb(t)&&(s=io[(a=String(t)).toLowerCase()],s===void 0))throw new Q(`Unknown adapter '${a}'`);if(s)break;n[a||"#"+i]=s}if(!s){const i=Object.entries(n).map(([o,c])=>`adapter ${o} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=e?i.length>1?`since :
`+i.map(jl).join(`
`):" "+jl(i[0]):"as no adapter specified";throw new Q("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s},adapters:io};function $a(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new fn(null,r)}function $l(r){return $a(r),r.headers=Jt.from(r.headers),r.data=ja.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),$u.getAdapter(r.adapter||Go.adapter)(r).then(function(s){return $a(r),s.data=ja.call(r,r.transformResponse,s),s.headers=Jt.from(s.headers),s},function(s){return Au(s)||($a(r),s&&s.response&&(s.response.data=ja.call(r,r.transformResponse,s.response),s.response.headers=Jt.from(s.response.headers))),Promise.reject(s)})}const Fl=r=>r instanceof Jt?r.toJSON():r;function ps(r,e){e=e||{};const t={};function s(u,l,d){return S.isPlainObject(u)&&S.isPlainObject(l)?S.merge.call({caseless:d},u,l):S.isPlainObject(l)?S.merge({},l):S.isArray(l)?l.slice():l}function n(u,l,d){if(S.isUndefined(l)){if(!S.isUndefined(u))return s(void 0,u,d)}else return s(u,l,d)}function i(u,l){if(!S.isUndefined(l))return s(void 0,l)}function a(u,l){if(S.isUndefined(l)){if(!S.isUndefined(u))return s(void 0,u)}else return s(void 0,l)}function o(u,l,d){if(d in e)return s(u,l);if(d in r)return s(void 0,u)}const c={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(u,l)=>n(Fl(u),Fl(l),!0)};return S.forEach(Object.keys(Object.assign({},r,e)),function(l){const d=c[l]||n,h=d(r[l],e[l],l);S.isUndefined(h)&&d!==o||(t[l]=h)}),t}const Fu="1.5.1",Zo={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Zo[r]=function(s){return typeof s===r||"a"+(e<1?"n ":" ")+r}});const Ul={};Zo.transitional=function(e,t,s){function n(i,a){return"[Axios v"+Fu+"] Transitional option '"+i+"'"+a+(s?". "+s:"")}return(i,a,o)=>{if(e===!1)throw new Q(n(a," has been removed"+(t?" in "+t:"")),Q.ERR_DEPRECATED);return t&&!Ul[a]&&(Ul[a]=!0,console.warn(n(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};function Sb(r,e,t){if(typeof r!="object")throw new Q("options must be an object",Q.ERR_BAD_OPTION_VALUE);const s=Object.keys(r);let n=s.length;for(;n-- >0;){const i=s[n],a=e[i];if(a){const o=r[i],c=o===void 0||a(o,i,r);if(c!==!0)throw new Q("option "+i+" must be "+c,Q.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Q("Unknown option "+i,Q.ERR_BAD_OPTION)}}const ao={assertOptions:Sb,validators:Zo},or=ao.validators;class ni{constructor(e){this.defaults=e,this.interceptors={request:new Ll,response:new Ll}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ps(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:i}=t;s!==void 0&&ao.assertOptions(s,{silentJSONParsing:or.transitional(or.boolean),forcedJSONParsing:or.transitional(or.boolean),clarifyTimeoutError:or.transitional(or.boolean)},!1),n!=null&&(S.isFunction(n)?t.paramsSerializer={serialize:n}:ao.assertOptions(n,{encode:or.function,serialize:or.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&S.merge(i.common,i[t.method]);i&&S.forEach(["delete","get","head","post","put","patch","common"],f=>{delete i[f]}),t.headers=Jt.concat(a,i);const o=[];let c=!0;this.interceptors.request.forEach(function(_){typeof _.runWhen=="function"&&_.runWhen(t)===!1||(c=c&&_.synchronous,o.unshift(_.fulfilled,_.rejected))});const u=[];this.interceptors.response.forEach(function(_){u.push(_.fulfilled,_.rejected)});let l,d=0,h;if(!c){const f=[$l.bind(this),void 0];for(f.unshift.apply(f,o),f.push.apply(f,u),h=f.length,l=Promise.resolve(t);d<h;)l=l.then(f[d++],f[d++]);return l}h=o.length;let p=t;for(d=0;d<h;){const f=o[d++],_=o[d++];try{p=f(p)}catch(g){_.call(this,g);break}}try{l=$l.call(this,p)}catch(f){return Promise.reject(f)}for(d=0,h=u.length;d<h;)l=l.then(u[d++],u[d++]);return l}getUri(e){e=ps(this.defaults,e);const t=ju(e.baseURL,e.url);return Iu(t,e.params,e.paramsSerializer)}}S.forEach(["delete","get","head","options"],function(e){ni.prototype[e]=function(t,s){return this.request(ps(s||{},{method:e,url:t,data:(s||{}).data}))}});S.forEach(["post","put","patch"],function(e){function t(s){return function(i,a,o){return this.request(ps(o||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}ni.prototype[e]=t(),ni.prototype[e+"Form"]=t(!0)});const Xn=ni;class Wo{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const s=this;this.promise.then(n=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](n);s._listeners=null}),this.promise.then=n=>{let i;const a=new Promise(o=>{s.subscribe(o),i=o}).then(n);return a.cancel=function(){s.unsubscribe(i)},a},e(function(i,a,o){s.reason||(s.reason=new fn(i,a,o),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Wo(function(n){e=n}),cancel:e}}}const Rb=Wo;function Tb(r){return function(t){return r.apply(null,t)}}function Cb(r){return S.isObject(r)&&r.isAxiosError===!0}const oo={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(oo).forEach(([r,e])=>{oo[e]=r});const Db=oo;function Uu(r){const e=new Xn(r),t=vu(Xn.prototype.request,e);return S.extend(t,Xn.prototype,e,{allOwnKeys:!0}),S.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return Uu(ps(r,n))},t}const Ee=Uu(Go);Ee.Axios=Xn;Ee.CanceledError=fn;Ee.CancelToken=Rb;Ee.isCancel=Au;Ee.VERSION=Fu;Ee.toFormData=Ni;Ee.AxiosError=Q;Ee.Cancel=Ee.CanceledError;Ee.all=function(e){return Promise.all(e)};Ee.spread=Tb;Ee.isAxiosError=Cb;Ee.mergeConfig=ps;Ee.AxiosHeaders=Jt;Ee.formToJSON=r=>Nu(S.isHTMLForm(r)?new FormData(r):r);Ee.getAdapter=$u.getAdapter;Ee.HttpStatusCode=Db;Ee.default=Ee;const Un=Ee;var Eb=typeof self=="object"?self.FormData:window.FormData;const kb=Qs(Eb);class Mr extends Error{}class Ob extends Mr{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class xb extends Mr{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Pb extends Mr{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class qs extends Mr{}class qu extends Mr{constructor(e){super(`Invalid unit ${e}`)}}class ot extends Mr{}class cr extends Mr{constructor(){super("Zone is an abstract class")}}const O="numeric",Rt="short",Qe="long",ii={year:O,month:O,day:O},Bu={year:O,month:Rt,day:O},Mb={year:O,month:Rt,day:O,weekday:Rt},zu={year:O,month:Qe,day:O},Vu={year:O,month:Qe,day:O,weekday:Qe},Hu={hour:O,minute:O},Gu={hour:O,minute:O,second:O},Zu={hour:O,minute:O,second:O,timeZoneName:Rt},Wu={hour:O,minute:O,second:O,timeZoneName:Qe},Ju={hour:O,minute:O,hourCycle:"h23"},Ku={hour:O,minute:O,second:O,hourCycle:"h23"},Yu={hour:O,minute:O,second:O,hourCycle:"h23",timeZoneName:Rt},Qu={hour:O,minute:O,second:O,hourCycle:"h23",timeZoneName:Qe},Xu={year:O,month:O,day:O,hour:O,minute:O},eh={year:O,month:O,day:O,hour:O,minute:O,second:O},th={year:O,month:Rt,day:O,hour:O,minute:O},rh={year:O,month:Rt,day:O,hour:O,minute:O,second:O},Ib={year:O,month:Rt,day:O,weekday:Rt,hour:O,minute:O},sh={year:O,month:Qe,day:O,hour:O,minute:O,timeZoneName:Rt},nh={year:O,month:Qe,day:O,hour:O,minute:O,second:O,timeZoneName:Rt},ih={year:O,month:Qe,day:O,weekday:Qe,hour:O,minute:O,timeZoneName:Qe},ah={year:O,month:Qe,day:O,weekday:Qe,hour:O,minute:O,second:O,timeZoneName:Qe};class mn{get type(){throw new cr}get name(){throw new cr}get ianaName(){return this.name}get isUniversal(){throw new cr}offsetName(e,t){throw new cr}formatOffset(e,t){throw new cr}offset(e){throw new cr}equals(e){throw new cr}get isValid(){throw new cr}}let Fa=null;class ji extends mn{static get instance(){return Fa===null&&(Fa=new ji),Fa}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:s}){return ch(e,t,s)}formatOffset(e,t){return Hs(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let ei={};function Lb(r){return ei[r]||(ei[r]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:r,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),ei[r]}const Nb={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Ab(r,e){const t=r.format(e).replace(/\u200E/g,""),s=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,n,i,a,o,c,u,l]=s;return[a,n,i,o,c,u,l]}function jb(r,e){const t=r.formatToParts(e),s=[];for(let n=0;n<t.length;n++){const{type:i,value:a}=t[n],o=Nb[i];i==="era"?s[o]=a:K(o)||(s[o]=parseInt(a,10))}return s}let qn={};class Yt extends mn{static create(e){return qn[e]||(qn[e]=new Yt(e)),qn[e]}static resetCache(){qn={},ei={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Yt.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:s}){return ch(e,t,s,this.name)}formatOffset(e,t){return Hs(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const s=Lb(this.name);let[n,i,a,o,c,u,l]=s.formatToParts?jb(s,t):Ab(s,t);o==="BC"&&(n=-Math.abs(n)+1);const h=Fi({year:n,month:i,day:a,hour:c===24?0:c,minute:u,second:l,millisecond:0});let p=+t;const f=p%1e3;return p-=f>=0?f:1e3+f,(h-p)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let ql={};function $b(r,e={}){const t=JSON.stringify([r,e]);let s=ql[t];return s||(s=new Intl.ListFormat(r,e),ql[t]=s),s}let co={};function lo(r,e={}){const t=JSON.stringify([r,e]);let s=co[t];return s||(s=new Intl.DateTimeFormat(r,e),co[t]=s),s}let uo={};function Fb(r,e={}){const t=JSON.stringify([r,e]);let s=uo[t];return s||(s=new Intl.NumberFormat(r,e),uo[t]=s),s}let ho={};function Ub(r,e={}){const{base:t,...s}=e,n=JSON.stringify([r,s]);let i=ho[n];return i||(i=new Intl.RelativeTimeFormat(r,e),ho[n]=i),i}let Bs=null;function qb(){return Bs||(Bs=new Intl.DateTimeFormat().resolvedOptions().locale,Bs)}function Bb(r){const e=r.indexOf("-x-");e!==-1&&(r=r.substring(0,e));const t=r.indexOf("-u-");if(t===-1)return[r];{let s,n;try{s=lo(r).resolvedOptions(),n=r}catch{const c=r.substring(0,t);s=lo(c).resolvedOptions(),n=c}const{numberingSystem:i,calendar:a}=s;return[n,i,a]}}function zb(r,e,t){return(t||e)&&(r.includes("-u-")||(r+="-u"),t&&(r+=`-ca-${t}`),e&&(r+=`-nu-${e}`)),r}function Vb(r){const e=[];for(let t=1;t<=12;t++){const s=B.utc(2009,t,1);e.push(r(s))}return e}function Hb(r){const e=[];for(let t=1;t<=7;t++){const s=B.utc(2016,11,13+t);e.push(r(s))}return e}function Bn(r,e,t,s){const n=r.listingMode();return n==="error"?null:n==="en"?t(e):s(e)}function Gb(r){return r.numberingSystem&&r.numberingSystem!=="latn"?!1:r.numberingSystem==="latn"||!r.locale||r.locale.startsWith("en")||new Intl.DateTimeFormat(r.intl).resolvedOptions().numberingSystem==="latn"}class Zb{constructor(e,t,s){this.padTo=s.padTo||0,this.floor=s.floor||!1;const{padTo:n,floor:i,...a}=s;if(!t||Object.keys(a).length>0){const o={useGrouping:!1,...s};s.padTo>0&&(o.minimumIntegerDigits=s.padTo),this.inf=Fb(e,o)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{const t=this.floor?Math.floor(e):Ko(e,3);return De(t,this.padTo)}}}class Wb{constructor(e,t,s){this.opts=s,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const a=-1*(e.offset/60),o=a>=0?`Etc/GMT+${a}`:`Etc/GMT${a}`;e.offset!==0&&Yt.create(o).valid?(n=o,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const i={...this.opts};i.timeZone=i.timeZone||n,this.dtf=lo(t,i)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(t=>{if(t.type==="timeZoneName"){const s=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...t,value:s}}else return t}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Jb{constructor(e,t,s){this.opts={style:"long",...s},!t&&oh()&&(this.rtf=Ub(e,s))}format(e,t){return this.rtf?this.rtf.format(e,t):hv(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}class me{static fromOpts(e){return me.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,t,s,n=!1){const i=e||Ce.defaultLocale,a=i||(n?"en-US":qb()),o=t||Ce.defaultNumberingSystem,c=s||Ce.defaultOutputCalendar;return new me(a,o,c,i)}static resetCache(){Bs=null,co={},uo={},ho={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:s}={}){return me.create(e,t,s)}constructor(e,t,s,n){const[i,a,o]=Bb(e);this.locale=i,this.numberingSystem=t||a||null,this.outputCalendar=s||o||null,this.intl=zb(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Gb(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:me.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return Bn(this,e,uh,()=>{const s=t?{month:e,day:"numeric"}:{month:e},n=t?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=Vb(i=>this.extract(i,s,"month"))),this.monthsCache[n][e]})}weekdays(e,t=!1){return Bn(this,e,fh,()=>{const s=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=t?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=Hb(i=>this.extract(i,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(){return Bn(this,void 0,()=>mh,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[B.utc(2016,11,13,9),B.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return Bn(this,e,gh,()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[B.utc(-40,1,1),B.utc(2017,1,1)].map(s=>this.extract(s,t,"era"))),this.eraCache[e]})}extract(e,t,s){const n=this.dtFormatter(e,t),i=n.formatToParts(),a=i.find(o=>o.type.toLowerCase()===s);return a?a.value:null}numberFormatter(e={}){return new Zb(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new Wb(e,this.intl,t)}relFormatter(e={}){return new Jb(this.intl,this.isEnglish(),e)}listFormatter(e={}){return $b(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let Ua=null;class Fe extends mn{static get utcInstance(){return Ua===null&&(Ua=new Fe(0)),Ua}static instance(e){return e===0?Fe.utcInstance:new Fe(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new Fe(Ui(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${Hs(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${Hs(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return Hs(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class Kb extends mn{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function ur(r,e){if(K(r)||r===null)return e;if(r instanceof mn)return r;if(Yb(r)){const t=r.toLowerCase();return t==="default"?e:t==="local"||t==="system"?ji.instance:t==="utc"||t==="gmt"?Fe.utcInstance:Fe.parseSpecifier(t)||Yt.create(r)}else return kr(r)?Fe.instance(r):typeof r=="object"&&"offset"in r&&typeof r.offset=="function"?r:new Kb(r)}let Bl=()=>Date.now(),zl="system",Vl=null,Hl=null,Gl=null,Zl=60,Wl;class Ce{static get now(){return Bl}static set now(e){Bl=e}static set defaultZone(e){zl=e}static get defaultZone(){return ur(zl,ji.instance)}static get defaultLocale(){return Vl}static set defaultLocale(e){Vl=e}static get defaultNumberingSystem(){return Hl}static set defaultNumberingSystem(e){Hl=e}static get defaultOutputCalendar(){return Gl}static set defaultOutputCalendar(e){Gl=e}static get twoDigitCutoffYear(){return Zl}static set twoDigitCutoffYear(e){Zl=e%100}static get throwOnInvalid(){return Wl}static set throwOnInvalid(e){Wl=e}static resetCaches(){me.resetCache(),Yt.resetCache()}}function K(r){return typeof r>"u"}function kr(r){return typeof r=="number"}function $i(r){return typeof r=="number"&&r%1===0}function Yb(r){return typeof r=="string"}function Qb(r){return Object.prototype.toString.call(r)==="[object Date]"}function oh(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function Xb(r){return Array.isArray(r)?r:[r]}function Jl(r,e,t){if(r.length!==0)return r.reduce((s,n)=>{const i=[e(n),n];return s&&t(s[0],i[0])===s[0]?s:i},null)[1]}function ev(r,e){return e.reduce((t,s)=>(t[s]=r[s],t),{})}function fs(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Zt(r,e,t){return $i(r)&&r>=e&&r<=t}function tv(r,e){return r-e*Math.floor(r/e)}function De(r,e=2){const t=r<0;let s;return t?s="-"+(""+-r).padStart(e,"0"):s=(""+r).padStart(e,"0"),s}function dr(r){if(!(K(r)||r===null||r===""))return parseInt(r,10)}function Rr(r){if(!(K(r)||r===null||r===""))return parseFloat(r)}function Jo(r){if(!(K(r)||r===null||r==="")){const e=parseFloat("0."+r)*1e3;return Math.floor(e)}}function Ko(r,e,t=!1){const s=10**e;return(t?Math.trunc:Math.round)(r*s)/s}function gn(r){return r%4===0&&(r%100!==0||r%400===0)}function Vs(r){return gn(r)?366:365}function ai(r,e){const t=tv(e-1,12)+1,s=r+(e-t)/12;return t===2?gn(s)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function Fi(r){let e=Date.UTC(r.year,r.month-1,r.day,r.hour,r.minute,r.second,r.millisecond);return r.year<100&&r.year>=0&&(e=new Date(e),e.setUTCFullYear(r.year,r.month-1,r.day)),+e}function oi(r){const e=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7,t=r-1,s=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7;return e===4||s===3?53:52}function po(r){return r>99?r:r>Ce.twoDigitCutoffYear?1900+r:2e3+r}function ch(r,e,t,s=null){const n=new Date(r),i={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};s&&(i.timeZone=s);const a={timeZoneName:e,...i},o=new Intl.DateTimeFormat(t,a).formatToParts(n).find(c=>c.type.toLowerCase()==="timezonename");return o?o.value:null}function Ui(r,e){let t=parseInt(r,10);Number.isNaN(t)&&(t=0);const s=parseInt(e,10)||0,n=t<0||Object.is(t,-0)?-s:s;return t*60+n}function lh(r){const e=Number(r);if(typeof r=="boolean"||r===""||Number.isNaN(e))throw new ot(`Invalid unit value ${r}`);return e}function ci(r,e){const t={};for(const s in r)if(fs(r,s)){const n=r[s];if(n==null)continue;t[e(s)]=lh(n)}return t}function Hs(r,e){const t=Math.trunc(Math.abs(r/60)),s=Math.trunc(Math.abs(r%60)),n=r>=0?"+":"-";switch(e){case"short":return`${n}${De(t,2)}:${De(s,2)}`;case"narrow":return`${n}${t}${s>0?`:${s}`:""}`;case"techie":return`${n}${De(t,2)}${De(s,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function qi(r){return ev(r,["hour","minute","second","millisecond"])}const rv=["January","February","March","April","May","June","July","August","September","October","November","December"],dh=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],sv=["J","F","M","A","M","J","J","A","S","O","N","D"];function uh(r){switch(r){case"narrow":return[...sv];case"short":return[...dh];case"long":return[...rv];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const hh=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ph=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],nv=["M","T","W","T","F","S","S"];function fh(r){switch(r){case"narrow":return[...nv];case"short":return[...ph];case"long":return[...hh];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const mh=["AM","PM"],iv=["Before Christ","Anno Domini"],av=["BC","AD"],ov=["B","A"];function gh(r){switch(r){case"narrow":return[...ov];case"short":return[...av];case"long":return[...iv];default:return null}}function cv(r){return mh[r.hour<12?0:1]}function lv(r,e){return fh(e)[r.weekday-1]}function dv(r,e){return uh(e)[r.month-1]}function uv(r,e){return gh(e)[r.year<0?0:1]}function hv(r,e,t="always",s=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},i=["hours","minutes","seconds"].indexOf(r)===-1;if(t==="auto"&&i){const d=r==="days";switch(e){case 1:return d?"tomorrow":`next ${n[r][0]}`;case-1:return d?"yesterday":`last ${n[r][0]}`;case 0:return d?"today":`this ${n[r][0]}`}}const a=Object.is(e,-0)||e<0,o=Math.abs(e),c=o===1,u=n[r],l=s?c?u[1]:u[2]||u[1]:c?n[r][0]:r;return a?`${o} ${l} ago`:`in ${o} ${l}`}function Kl(r,e){let t="";for(const s of r)s.literal?t+=s.val:t+=e(s.val);return t}const pv={D:ii,DD:Bu,DDD:zu,DDDD:Vu,t:Hu,tt:Gu,ttt:Zu,tttt:Wu,T:Ju,TT:Ku,TTT:Yu,TTTT:Qu,f:Xu,ff:th,fff:sh,ffff:ih,F:eh,FF:rh,FFF:nh,FFFF:ah};class je{static create(e,t={}){return new je(e,t)}static parseFormat(e){let t=null,s="",n=!1;const i=[];for(let a=0;a<e.length;a++){const o=e.charAt(a);o==="'"?(s.length>0&&i.push({literal:n||/^\s+$/.test(s),val:s}),t=null,s="",n=!n):n||o===t?s+=o:(s.length>0&&i.push({literal:/^\s+$/.test(s),val:s}),s=o,t=o)}return s.length>0&&i.push({literal:n||/^\s+$/.test(s),val:s}),i}static macroTokenToFormatOpts(e){return pv[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return De(e,t);const s={...this.opts};return t>0&&(s.padTo=t),this.loc.numberFormatter(s).format(e)}formatDateTimeFromString(e,t){const s=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",i=(p,f)=>this.loc.extract(e,p,f),a=p=>e.isOffsetFixed&&e.offset===0&&p.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,p.format):"",o=()=>s?cv(e):i({hour:"numeric",hourCycle:"h12"},"dayperiod"),c=(p,f)=>s?dv(e,p):i(f?{month:p}:{month:p,day:"numeric"},"month"),u=(p,f)=>s?lv(e,p):i(f?{weekday:p}:{weekday:p,month:"long",day:"numeric"},"weekday"),l=p=>{const f=je.macroTokenToFormatOpts(p);return f?this.formatWithSystemDefault(e,f):p},d=p=>s?uv(e,p):i({era:p},"era"),h=p=>{switch(p){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return a({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return a({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return a({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return o();case"d":return n?i({day:"numeric"},"day"):this.num(e.day);case"dd":return n?i({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return u("short",!0);case"cccc":return u("long",!0);case"ccccc":return u("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return u("short",!1);case"EEEE":return u("long",!1);case"EEEEE":return u("narrow",!1);case"L":return n?i({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?i({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return c("short",!0);case"LLLL":return c("long",!0);case"LLLLL":return c("narrow",!0);case"M":return n?i({month:"numeric"},"month"):this.num(e.month);case"MM":return n?i({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return c("short",!1);case"MMMM":return c("long",!1);case"MMMMM":return c("narrow",!1);case"y":return n?i({year:"numeric"},"year"):this.num(e.year);case"yy":return n?i({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?i({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?i({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return l(p)}};return Kl(je.parseFormat(t),h)}formatDurationFromString(e,t){const s=c=>{switch(c[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=c=>u=>{const l=s(u);return l?this.num(c.get(l),u.length):u},i=je.parseFormat(t),a=i.reduce((c,{literal:u,val:l})=>u?c:c.concat(l),[]),o=e.shiftTo(...a.map(s).filter(c=>c));return Kl(i,n(o))}}class yt{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const _h=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function vs(...r){const e=r.reduce((t,s)=>t+s.source,"");return RegExp(`^${e}$`)}function Ss(...r){return e=>r.reduce(([t,s,n],i)=>{const[a,o,c]=i(e,n);return[{...t,...a},o||s,c]},[{},null,1]).slice(0,2)}function Rs(r,...e){if(r==null)return[null,null];for(const[t,s]of e){const n=t.exec(r);if(n)return s(n)}return[null,null]}function wh(...r){return(e,t)=>{const s={};let n;for(n=0;n<r.length;n++)s[r[n]]=dr(e[t+n]);return[s,null,t+n]}}const yh=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,fv=`(?:${yh.source}?(?:\\[(${_h.source})\\])?)?`,Yo=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,bh=RegExp(`${Yo.source}${fv}`),Qo=RegExp(`(?:T${bh.source})?`),mv=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,gv=/(\d{4})-?W(\d\d)(?:-?(\d))?/,_v=/(\d{4})-?(\d{3})/,wv=wh("weekYear","weekNumber","weekDay"),yv=wh("year","ordinal"),bv=/(\d{4})-(\d\d)-(\d\d)/,vh=RegExp(`${Yo.source} ?(?:${yh.source}|(${_h.source}))?`),vv=RegExp(`(?: ${vh.source})?`);function us(r,e,t){const s=r[e];return K(s)?t:dr(s)}function Sv(r,e){return[{year:us(r,e),month:us(r,e+1,1),day:us(r,e+2,1)},null,e+3]}function Ts(r,e){return[{hours:us(r,e,0),minutes:us(r,e+1,0),seconds:us(r,e+2,0),milliseconds:Jo(r[e+3])},null,e+4]}function _n(r,e){const t=!r[e]&&!r[e+1],s=Ui(r[e+1],r[e+2]),n=t?null:Fe.instance(s);return[{},n,e+3]}function wn(r,e){const t=r[e]?Yt.create(r[e]):null;return[{},t,e+1]}const Rv=RegExp(`^T?${Yo.source}$`),Tv=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Cv(r){const[e,t,s,n,i,a,o,c,u]=r,l=e[0]==="-",d=c&&c[0]==="-",h=(p,f=!1)=>p!==void 0&&(f||p&&l)?-p:p;return[{years:h(Rr(t)),months:h(Rr(s)),weeks:h(Rr(n)),days:h(Rr(i)),hours:h(Rr(a)),minutes:h(Rr(o)),seconds:h(Rr(c),c==="-0"),milliseconds:h(Jo(u),d)}]}const Dv={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Xo(r,e,t,s,n,i,a){const o={year:e.length===2?po(dr(e)):dr(e),month:dh.indexOf(t)+1,day:dr(s),hour:dr(n),minute:dr(i)};return a&&(o.second=dr(a)),r&&(o.weekday=r.length>3?hh.indexOf(r)+1:ph.indexOf(r)+1),o}const Ev=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function kv(r){const[,e,t,s,n,i,a,o,c,u,l,d]=r,h=Xo(e,n,s,t,i,a,o);let p;return c?p=Dv[c]:u?p=0:p=Ui(l,d),[h,new Fe(p)]}function Ov(r){return r.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const xv=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Pv=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Mv=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Yl(r){const[,e,t,s,n,i,a,o]=r;return[Xo(e,n,s,t,i,a,o),Fe.utcInstance]}function Iv(r){const[,e,t,s,n,i,a,o]=r;return[Xo(e,o,t,s,n,i,a),Fe.utcInstance]}const Lv=vs(mv,Qo),Nv=vs(gv,Qo),Av=vs(_v,Qo),jv=vs(bh),Sh=Ss(Sv,Ts,_n,wn),$v=Ss(wv,Ts,_n,wn),Fv=Ss(yv,Ts,_n,wn),Uv=Ss(Ts,_n,wn);function qv(r){return Rs(r,[Lv,Sh],[Nv,$v],[Av,Fv],[jv,Uv])}function Bv(r){return Rs(Ov(r),[Ev,kv])}function zv(r){return Rs(r,[xv,Yl],[Pv,Yl],[Mv,Iv])}function Vv(r){return Rs(r,[Tv,Cv])}const Hv=Ss(Ts);function Gv(r){return Rs(r,[Rv,Hv])}const Zv=vs(bv,vv),Wv=vs(vh),Jv=Ss(Ts,_n,wn);function Kv(r){return Rs(r,[Zv,Sh],[Wv,Jv])}const Ql="Invalid Duration",Rh={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Yv={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Rh},it=146097/400,is=146097/4800,Qv={years:{quarters:4,months:12,weeks:it/7,days:it,hours:it*24,minutes:it*24*60,seconds:it*24*60*60,milliseconds:it*24*60*60*1e3},quarters:{months:3,weeks:it/28,days:it/4,hours:it*24/4,minutes:it*24*60/4,seconds:it*24*60*60/4,milliseconds:it*24*60*60*1e3/4},months:{weeks:is/7,days:is,hours:is*24,minutes:is*24*60,seconds:is*24*60*60,milliseconds:is*24*60*60*1e3},...Rh},Cr=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Xv=Cr.slice(0).reverse();function lr(r,e,t=!1){const s={values:t?e.values:{...r.values,...e.values||{}},loc:r.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||r.conversionAccuracy,matrix:e.matrix||r.matrix};return new te(s)}function Th(r,e){let t=e.milliseconds??0;for(const s of Xv.slice(1))e[s]&&(t+=e[s]*r[s].milliseconds);return t}function Xl(r,e){const t=Th(r,e)<0?-1:1;Cr.reduceRight((s,n)=>{if(K(e[n]))return s;if(s){const i=e[s]*t,a=r[n][s],o=Math.floor(i/a);e[n]+=o*t,e[s]-=o*a*t}return n},null),Cr.reduce((s,n)=>{if(K(e[n]))return s;if(s){const i=e[s]%1;e[s]-=i,e[n]+=i*r[s][n]}return n},null)}function eS(r){const e={};for(const[t,s]of Object.entries(r))s!==0&&(e[t]=s);return e}class te{constructor(e){const t=e.conversionAccuracy==="longterm"||!1;let s=t?Qv:Yv;e.matrix&&(s=e.matrix),this.values=e.values,this.loc=e.loc||me.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=s,this.isLuxonDuration=!0}static fromMillis(e,t){return te.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new ot(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new te({values:ci(e,te.normalizeUnit),loc:me.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(kr(e))return te.fromMillis(e);if(te.isDuration(e))return e;if(typeof e=="object")return te.fromObject(e);throw new ot(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[s]=Vv(e);return s?te.fromObject(s,t):te.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[s]=Gv(e);return s?te.fromObject(s,t):te.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new ot("need to specify a reason the Duration is invalid");const s=e instanceof yt?e:new yt(e,t);if(Ce.throwOnInvalid)throw new Pb(s);return new te({invalid:s})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new qu(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const s={...t,floor:t.round!==!1&&t.floor!==!1};return this.isValid?je.create(this.loc,s).formatDurationFromString(this,e):Ql}toHuman(e={}){if(!this.isValid)return Ql;const t=Cr.map(s=>{const n=this.values[s];return K(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:s.slice(0,-1)}).format(n)}).filter(s=>s);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Ko(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();return t<0||t>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},B.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?Th(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=te.fromDurationLike(e),s={};for(const n of Cr)(fs(t.values,n)||fs(this.values,n))&&(s[n]=t.get(n)+this.get(n));return lr(this,{values:s},!0)}minus(e){if(!this.isValid)return this;const t=te.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const s of Object.keys(this.values))t[s]=lh(e(this.values[s],s));return lr(this,{values:t},!0)}get(e){return this[te.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const t={...this.values,...ci(e,te.normalizeUnit)};return lr(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:s,matrix:n}={}){const a={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:n,conversionAccuracy:s};return lr(this,a)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Xl(this.matrix,e),lr(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=eS(this.normalize().shiftToAll().toObject());return lr(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(a=>te.normalizeUnit(a));const t={},s={},n=this.toObject();let i;for(const a of Cr)if(e.indexOf(a)>=0){i=a;let o=0;for(const u in s)o+=this.matrix[u][a]*s[u],s[u]=0;kr(n[a])&&(o+=n[a]);const c=Math.trunc(o);t[a]=c,s[a]=(o*1e3-c*1e3)/1e3}else kr(n[a])&&(s[a]=n[a]);for(const a in s)s[a]!==0&&(t[i]+=a===i?s[a]:s[a]/this.matrix[i][a]);return Xl(this.matrix,t),lr(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return lr(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(s,n){return s===void 0||s===0?n===void 0||n===0:s===n}for(const s of Cr)if(!t(this.values[s],e.values[s]))return!1;return!0}}const as="Invalid Interval";function tS(r,e){return!r||!r.isValid?be.invalid("missing or invalid start"):!e||!e.isValid?be.invalid("missing or invalid end"):e<r?be.invalid("end before start",`The end of an interval must be after its start, but you had start=${r.toISO()} and end=${e.toISO()}`):null}class be{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new ot("need to specify a reason the Interval is invalid");const s=e instanceof yt?e:new yt(e,t);if(Ce.throwOnInvalid)throw new xb(s);return new be({invalid:s})}static fromDateTimes(e,t){const s=Us(e),n=Us(t),i=tS(s,n);return i??new be({start:s,end:n})}static after(e,t){const s=te.fromDurationLike(t),n=Us(e);return be.fromDateTimes(n,n.plus(s))}static before(e,t){const s=te.fromDurationLike(t),n=Us(e);return be.fromDateTimes(n.minus(s),n)}static fromISO(e,t){const[s,n]=(e||"").split("/",2);if(s&&n){let i,a;try{i=B.fromISO(s,t),a=i.isValid}catch{a=!1}let o,c;try{o=B.fromISO(n,t),c=o.isValid}catch{c=!1}if(a&&c)return be.fromDateTimes(i,o);if(a){const u=te.fromISO(n,t);if(u.isValid)return be.after(i,u)}else if(c){const u=te.fromISO(s,t);if(u.isValid)return be.before(o,u)}}return be.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const t=this.start.startOf(e),s=this.end.startOf(e);return Math.floor(s.diff(t,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?be.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(Us).filter(a=>this.contains(a)).sort(),s=[];let{s:n}=this,i=0;for(;n<this.e;){const a=t[i]||this.e,o=+a>+this.e?this.e:a;s.push(be.fromDateTimes(n,o)),n=o,i+=1}return s}splitBy(e){const t=te.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s}=this,n=1,i;const a=[];for(;s<this.e;){const o=this.start.plus(t.mapUnits(c=>c*n));i=+o>+this.e?this.e:o,a.push(be.fromDateTimes(s,i)),s=i,n+=1}return a}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,s=this.e<e.e?this.e:e.e;return t>=s?null:be.fromDateTimes(t,s)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,s=this.e>e.e?this.e:e.e;return be.fromDateTimes(t,s)}static merge(e){const[t,s]=e.sort((n,i)=>n.s-i.s).reduce(([n,i],a)=>i?i.overlaps(a)||i.abutsStart(a)?[n,i.union(a)]:[n.concat([i]),a]:[n,a],[[],null]);return s&&t.push(s),t}static xor(e){let t=null,s=0;const n=[],i=e.map(c=>[{time:c.s,type:"s"},{time:c.e,type:"e"}]),a=Array.prototype.concat(...i),o=a.sort((c,u)=>c.time-u.time);for(const c of o)s+=c.type==="s"?1:-1,s===1?t=c.time:(t&&+t!=+c.time&&n.push(be.fromDateTimes(t,c.time)),t=null);return be.merge(n)}difference(...e){return be.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:as}toLocaleString(e=ii,t={}){return this.isValid?je.create(this.s.loc.clone(t),e).formatInterval(this):as}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:as}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:as}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:as}toFormat(e,{separator:t=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:as}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):te.invalid(this.invalidReason)}mapEndpoints(e){return be.fromDateTimes(e(this.s),e(this.e))}}class zn{static hasDST(e=Ce.defaultZone){const t=B.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Yt.isValidZone(e)}static normalizeZone(e){return ur(e,Ce.defaultZone)}static months(e="long",{locale:t=null,numberingSystem:s=null,locObj:n=null,outputCalendar:i="gregory"}={}){return(n||me.create(t,s,i)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:s=null,locObj:n=null,outputCalendar:i="gregory"}={}){return(n||me.create(t,s,i)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:s=null,locObj:n=null}={}){return(n||me.create(t,s,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:s=null,locObj:n=null}={}){return(n||me.create(t,s,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return me.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return me.create(t,null,"gregory").eras(e)}static features(){return{relative:oh()}}}function ed(r,e){const t=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),s=t(e)-t(r);return Math.floor(te.fromMillis(s).as("days"))}function rS(r,e,t){const s=[["years",(c,u)=>u.year-c.year],["quarters",(c,u)=>u.quarter-c.quarter+(u.year-c.year)*4],["months",(c,u)=>u.month-c.month+(u.year-c.year)*12],["weeks",(c,u)=>{const l=ed(c,u);return(l-l%7)/7}],["days",ed]],n={},i=r;let a,o;for(const[c,u]of s)t.indexOf(c)>=0&&(a=c,n[c]=u(r,e),o=i.plus(n),o>e?(n[c]--,r=i.plus(n),r>e&&(o=r,n[c]--,r=i.plus(n))):r=o);return[r,n,o,a]}function sS(r,e,t,s){let[n,i,a,o]=rS(r,e,t);const c=e-n,u=t.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);u.length===0&&(a<e&&(a=n.plus({[o]:1})),a!==n&&(i[o]=(i[o]||0)+c/(a-n)));const l=te.fromObject(i,s);return u.length>0?te.fromMillis(c,s).shiftTo(...u).plus(l):l}const ec={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},td={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},nS=ec.hanidec.replace(/[\[|\]]/g,"").split("");function iS(r){let e=parseInt(r,10);if(isNaN(e)){e="";for(let t=0;t<r.length;t++){const s=r.charCodeAt(t);if(r[t].search(ec.hanidec)!==-1)e+=nS.indexOf(r[t]);else for(const n in td){const[i,a]=td[n];s>=i&&s<=a&&(e+=s-i)}}return parseInt(e,10)}else return e}function gt({numberingSystem:r},e=""){return new RegExp(`${ec[r||"latn"]}${e}`)}const aS="missing Intl.DateTimeFormat.formatToParts support";function ce(r,e=t=>t){return{regex:r,deser:([t])=>e(iS(t))}}const oS=String.fromCharCode(160),Ch=`[ ${oS}]`,Dh=new RegExp(Ch,"g");function cS(r){return r.replace(/\./g,"\\.?").replace(Dh,Ch)}function rd(r){return r.replace(/\./g,"").replace(Dh," ").toLowerCase()}function _t(r,e){return r===null?null:{regex:RegExp(r.map(cS).join("|")),deser:([t])=>r.findIndex(s=>rd(t)===rd(s))+e}}function sd(r,e){return{regex:r,deser:([,t,s])=>Ui(t,s),groups:e}}function Vn(r){return{regex:r,deser:([e])=>e}}function lS(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function dS(r,e){const t=gt(e),s=gt(e,"{2}"),n=gt(e,"{3}"),i=gt(e,"{4}"),a=gt(e,"{6}"),o=gt(e,"{1,2}"),c=gt(e,"{1,3}"),u=gt(e,"{1,6}"),l=gt(e,"{1,9}"),d=gt(e,"{2,4}"),h=gt(e,"{4,6}"),p=g=>({regex:RegExp(lS(g.val)),deser:([k])=>k,literal:!0}),_=(g=>{if(r.literal)return p(g);switch(g.val){case"G":return _t(e.eras("short"),0);case"GG":return _t(e.eras("long"),0);case"y":return ce(u);case"yy":return ce(d,po);case"yyyy":return ce(i);case"yyyyy":return ce(h);case"yyyyyy":return ce(a);case"M":return ce(o);case"MM":return ce(s);case"MMM":return _t(e.months("short",!0),1);case"MMMM":return _t(e.months("long",!0),1);case"L":return ce(o);case"LL":return ce(s);case"LLL":return _t(e.months("short",!1),1);case"LLLL":return _t(e.months("long",!1),1);case"d":return ce(o);case"dd":return ce(s);case"o":return ce(c);case"ooo":return ce(n);case"HH":return ce(s);case"H":return ce(o);case"hh":return ce(s);case"h":return ce(o);case"mm":return ce(s);case"m":return ce(o);case"q":return ce(o);case"qq":return ce(s);case"s":return ce(o);case"ss":return ce(s);case"S":return ce(c);case"SSS":return ce(n);case"u":return Vn(l);case"uu":return Vn(o);case"uuu":return ce(t);case"a":return _t(e.meridiems(),0);case"kkkk":return ce(i);case"kk":return ce(d,po);case"W":return ce(o);case"WW":return ce(s);case"E":case"c":return ce(t);case"EEE":return _t(e.weekdays("short",!1),1);case"EEEE":return _t(e.weekdays("long",!1),1);case"ccc":return _t(e.weekdays("short",!0),1);case"cccc":return _t(e.weekdays("long",!0),1);case"Z":case"ZZ":return sd(new RegExp(`([+-]${o.source})(?::(${s.source}))?`),2);case"ZZZ":return sd(new RegExp(`([+-]${o.source})(${s.source})?`),2);case"z":return Vn(/[a-z_+-/]{1,256}?/i);case" ":return Vn(/[^\S\n\r]/);default:return p(g)}})(r)||{invalidReason:aS};return _.token=r,_}const uS={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function hS(r,e,t){const{type:s,value:n}=r;if(s==="literal"){const c=/^\s+$/.test(n);return{literal:!c,val:c?" ":n}}const i=e[s];let a=s;s==="hour"&&(e.hour12!=null?a=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?a="hour12":a="hour24":a=t.hour12?"hour12":"hour24");let o=uS[a];if(typeof o=="object"&&(o=o[i]),o)return{literal:!1,val:o}}function pS(r){return[`^${r.map(t=>t.regex).reduce((t,s)=>`${t}(${s.source})`,"")}$`,r]}function fS(r,e,t){const s=r.match(e);if(s){const n={};let i=1;for(const a in t)if(fs(t,a)){const o=t[a],c=o.groups?o.groups+1:1;!o.literal&&o.token&&(n[o.token.val[0]]=o.deser(s.slice(i,i+c))),i+=c}return[s,n]}else return[s,{}]}function mS(r){const e=i=>{switch(i){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let t=null,s;return K(r.z)||(t=Yt.create(r.z)),K(r.Z)||(t||(t=new Fe(r.Z)),s=r.Z),K(r.q)||(r.M=(r.q-1)*3+1),K(r.h)||(r.h<12&&r.a===1?r.h+=12:r.h===12&&r.a===0&&(r.h=0)),r.G===0&&r.y&&(r.y=-r.y),K(r.u)||(r.S=Jo(r.u)),[Object.keys(r).reduce((i,a)=>{const o=e(a);return o&&(i[o]=r[a]),i},{}),t,s]}let qa=null;function gS(){return qa||(qa=B.fromMillis(1555555555555)),qa}function _S(r,e){if(r.literal)return r;const t=je.macroTokenToFormatOpts(r.val),s=Oh(t,e);return s==null||s.includes(void 0)?r:s}function Eh(r,e){return Array.prototype.concat(...r.map(t=>_S(t,e)))}function kh(r,e,t){const s=Eh(je.parseFormat(t),r),n=s.map(a=>dS(a,r)),i=n.find(a=>a.invalidReason);if(i)return{input:e,tokens:s,invalidReason:i.invalidReason};{const[a,o]=pS(n),c=RegExp(a,"i"),[u,l]=fS(e,c,o),[d,h,p]=l?mS(l):[null,null,void 0];if(fs(l,"a")&&fs(l,"H"))throw new qs("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:s,regex:c,rawMatches:u,matches:l,result:d,zone:h,specificOffset:p}}}function wS(r,e,t){const{result:s,zone:n,specificOffset:i,invalidReason:a}=kh(r,e,t);return[s,n,i,a]}function Oh(r,e){if(!r)return null;const s=je.create(e,r).dtFormatter(gS()),n=s.formatToParts(),i=s.resolvedOptions();return n.map(a=>hS(a,r,i))}const xh=[0,31,59,90,120,151,181,212,243,273,304,334],Ph=[0,31,60,91,121,152,182,213,244,274,305,335];function lt(r,e){return new yt("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${r}, which is invalid`)}function Mh(r,e,t){const s=new Date(Date.UTC(r,e-1,t));r<100&&r>=0&&s.setUTCFullYear(s.getUTCFullYear()-1900);const n=s.getUTCDay();return n===0?7:n}function Ih(r,e,t){return t+(gn(r)?Ph:xh)[e-1]}function Lh(r,e){const t=gn(r)?Ph:xh,s=t.findIndex(i=>i<e),n=e-t[s];return{month:s+1,day:n}}function fo(r){const{year:e,month:t,day:s}=r,n=Ih(e,t,s),i=Mh(e,t,s);let a=Math.floor((n-i+10)/7),o;return a<1?(o=e-1,a=oi(o)):a>oi(e)?(o=e+1,a=1):o=e,{weekYear:o,weekNumber:a,weekday:i,...qi(r)}}function nd(r){const{weekYear:e,weekNumber:t,weekday:s}=r,n=Mh(e,1,4),i=Vs(e);let a=t*7+s-n-3,o;a<1?(o=e-1,a+=Vs(o)):a>i?(o=e+1,a-=Vs(e)):o=e;const{month:c,day:u}=Lh(o,a);return{year:o,month:c,day:u,...qi(r)}}function Ba(r){const{year:e,month:t,day:s}=r,n=Ih(e,t,s);return{year:e,ordinal:n,...qi(r)}}function id(r){const{year:e,ordinal:t}=r,{month:s,day:n}=Lh(e,t);return{year:e,month:s,day:n,...qi(r)}}function yS(r){const e=$i(r.weekYear),t=Zt(r.weekNumber,1,oi(r.weekYear)),s=Zt(r.weekday,1,7);return e?t?s?!1:lt("weekday",r.weekday):lt("week",r.week):lt("weekYear",r.weekYear)}function bS(r){const e=$i(r.year),t=Zt(r.ordinal,1,Vs(r.year));return e?t?!1:lt("ordinal",r.ordinal):lt("year",r.year)}function Nh(r){const e=$i(r.year),t=Zt(r.month,1,12),s=Zt(r.day,1,ai(r.year,r.month));return e?t?s?!1:lt("day",r.day):lt("month",r.month):lt("year",r.year)}function Ah(r){const{hour:e,minute:t,second:s,millisecond:n}=r,i=Zt(e,0,23)||e===24&&t===0&&s===0&&n===0,a=Zt(t,0,59),o=Zt(s,0,59),c=Zt(n,0,999);return i?a?o?c?!1:lt("millisecond",n):lt("second",s):lt("minute",t):lt("hour",e)}const za="Invalid DateTime",ad=864e13;function Hn(r){return new yt("unsupported zone",`the zone "${r.name}" is not supported`)}function Va(r){return r.weekData===null&&(r.weekData=fo(r.c)),r.weekData}function Tr(r,e){const t={ts:r.ts,zone:r.zone,c:r.c,o:r.o,loc:r.loc,invalid:r.invalid};return new B({...t,...e,old:t})}function jh(r,e,t){let s=r-e*60*1e3;const n=t.offset(s);if(e===n)return[s,e];s-=(n-e)*60*1e3;const i=t.offset(s);return n===i?[s,n]:[r-Math.min(n,i)*60*1e3,Math.max(n,i)]}function Gn(r,e){r+=e*60*1e3;const t=new Date(r);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function ti(r,e,t){return jh(Fi(r),e,t)}function od(r,e){const t=r.o,s=r.c.year+Math.trunc(e.years),n=r.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,i={...r.c,year:s,month:n,day:Math.min(r.c.day,ai(s,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},a=te.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),o=Fi(i);let[c,u]=jh(o,t,r.zone);return a!==0&&(c+=a,u=r.zone.offset(c)),{ts:c,o:u}}function Fs(r,e,t,s,n,i){const{setZone:a,zone:o}=t;if(r&&Object.keys(r).length!==0||e){const c=e||o,u=B.fromObject(r,{...t,zone:c,specificOffset:i});return a?u:u.setZone(o)}else return B.invalid(new yt("unparsable",`the input "${n}" can't be parsed as ${s}`))}function Zn(r,e,t=!0){return r.isValid?je.create(me.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(r,e):null}function Ha(r,e){const t=r.c.year>9999||r.c.year<0;let s="";return t&&r.c.year>=0&&(s+="+"),s+=De(r.c.year,t?6:4),e?(s+="-",s+=De(r.c.month),s+="-",s+=De(r.c.day)):(s+=De(r.c.month),s+=De(r.c.day)),s}function cd(r,e,t,s,n,i){let a=De(r.c.hour);return e?(a+=":",a+=De(r.c.minute),(r.c.millisecond!==0||r.c.second!==0||!t)&&(a+=":")):a+=De(r.c.minute),(r.c.millisecond!==0||r.c.second!==0||!t)&&(a+=De(r.c.second),(r.c.millisecond!==0||!s)&&(a+=".",a+=De(r.c.millisecond,3))),n&&(r.isOffsetFixed&&r.offset===0&&!i?a+="Z":r.o<0?(a+="-",a+=De(Math.trunc(-r.o/60)),a+=":",a+=De(Math.trunc(-r.o%60))):(a+="+",a+=De(Math.trunc(r.o/60)),a+=":",a+=De(Math.trunc(r.o%60)))),i&&(a+="["+r.zone.ianaName+"]"),a}const $h={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},vS={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},SS={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Fh=["year","month","day","hour","minute","second","millisecond"],RS=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],TS=["year","ordinal","hour","minute","second","millisecond"];function ld(r){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[r.toLowerCase()];if(!e)throw new qu(r);return e}function dd(r,e){const t=ur(e.zone,Ce.defaultZone),s=me.fromObject(e),n=Ce.now();let i,a;if(K(r.year))i=n;else{for(const u of Fh)K(r[u])&&(r[u]=$h[u]);const o=Nh(r)||Ah(r);if(o)return B.invalid(o);const c=t.offset(n);[i,a]=ti(r,c,t)}return new B({ts:i,zone:t,loc:s,o:a})}function ud(r,e,t){const s=K(t.round)?!0:t.round,n=(a,o)=>(a=Ko(a,s||t.calendary?0:2,!0),e.loc.clone(t).relFormatter(t).format(a,o)),i=a=>t.calendary?e.hasSame(r,a)?0:e.startOf(a).diff(r.startOf(a),a).get(a):e.diff(r,a).get(a);if(t.unit)return n(i(t.unit),t.unit);for(const a of t.units){const o=i(a);if(Math.abs(o)>=1)return n(o,a)}return n(r>e?-0:0,t.units[t.units.length-1])}function hd(r){let e={},t;return r.length>0&&typeof r[r.length-1]=="object"?(e=r[r.length-1],t=Array.from(r).slice(0,r.length-1)):t=Array.from(r),[e,t]}class B{constructor(e){const t=e.zone||Ce.defaultZone;let s=e.invalid||(Number.isNaN(e.ts)?new yt("invalid input"):null)||(t.isValid?null:Hn(t));this.ts=K(e.ts)?Ce.now():e.ts;let n=null,i=null;if(!s)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[n,i]=[e.old.c,e.old.o];else{const o=t.offset(this.ts);n=Gn(this.ts,o),s=Number.isNaN(n.year)?new yt("invalid input"):null,n=s?null:n,i=s?null:o}this._zone=t,this.loc=e.loc||me.create(),this.invalid=s,this.weekData=null,this.c=n,this.o=i,this.isLuxonDateTime=!0}static now(){return new B({})}static local(){const[e,t]=hd(arguments),[s,n,i,a,o,c,u]=t;return dd({year:s,month:n,day:i,hour:a,minute:o,second:c,millisecond:u},e)}static utc(){const[e,t]=hd(arguments),[s,n,i,a,o,c,u]=t;return e.zone=Fe.utcInstance,dd({year:s,month:n,day:i,hour:a,minute:o,second:c,millisecond:u},e)}static fromJSDate(e,t={}){const s=Qb(e)?e.valueOf():NaN;if(Number.isNaN(s))return B.invalid("invalid input");const n=ur(t.zone,Ce.defaultZone);return n.isValid?new B({ts:s,zone:n,loc:me.fromObject(t)}):B.invalid(Hn(n))}static fromMillis(e,t={}){if(kr(e))return e<-ad||e>ad?B.invalid("Timestamp out of range"):new B({ts:e,zone:ur(t.zone,Ce.defaultZone),loc:me.fromObject(t)});throw new ot(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(kr(e))return new B({ts:e*1e3,zone:ur(t.zone,Ce.defaultZone),loc:me.fromObject(t)});throw new ot("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const s=ur(t.zone,Ce.defaultZone);if(!s.isValid)return B.invalid(Hn(s));const n=Ce.now(),i=K(t.specificOffset)?s.offset(n):t.specificOffset,a=ci(e,ld),o=!K(a.ordinal),c=!K(a.year),u=!K(a.month)||!K(a.day),l=c||u,d=a.weekYear||a.weekNumber,h=me.fromObject(t);if((l||o)&&d)throw new qs("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&o)throw new qs("Can't mix ordinal dates with month/day");const p=d||a.weekday&&!l;let f,_,g=Gn(n,i);p?(f=RS,_=vS,g=fo(g)):o?(f=TS,_=SS,g=Ba(g)):(f=Fh,_=$h);let k=!1;for(const de of f){const Me=a[de];K(Me)?k?a[de]=_[de]:a[de]=g[de]:k=!0}const P=p?yS(a):o?bS(a):Nh(a),D=P||Ah(a);if(D)return B.invalid(D);const C=p?nd(a):o?id(a):a,[y,R]=ti(C,i,s),Y=new B({ts:y,zone:s,o:R,loc:h});return a.weekday&&l&&e.weekday!==Y.weekday?B.invalid("mismatched weekday",`you can't specify both a weekday of ${a.weekday} and a date of ${Y.toISO()}`):Y}static fromISO(e,t={}){const[s,n]=qv(e);return Fs(s,n,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[s,n]=Bv(e);return Fs(s,n,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[s,n]=zv(e);return Fs(s,n,t,"HTTP",t)}static fromFormat(e,t,s={}){if(K(e)||K(t))throw new ot("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:i=null}=s,a=me.fromOpts({locale:n,numberingSystem:i,defaultToEN:!0}),[o,c,u,l]=wS(a,e,t);return l?B.invalid(l):Fs(o,c,s,`format ${t}`,e,u)}static fromString(e,t,s={}){return B.fromFormat(e,t,s)}static fromSQL(e,t={}){const[s,n]=Kv(e);return Fs(s,n,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new ot("need to specify a reason the DateTime is invalid");const s=e instanceof yt?e:new yt(e,t);if(Ce.throwOnInvalid)throw new Ob(s);return new B({invalid:s})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const s=Oh(e,me.fromObject(t));return s?s.map(n=>n?n.val:null).join(""):null}static expandFormat(e,t={}){return Eh(je.parseFormat(e),me.fromObject(t)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Va(this).weekYear:NaN}get weekNumber(){return this.isValid?Va(this).weekNumber:NaN}get weekday(){return this.isValid?Va(this).weekday:NaN}get ordinal(){return this.isValid?Ba(this.c).ordinal:NaN}get monthShort(){return this.isValid?zn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?zn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?zn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?zn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,s=Fi(this.c),n=this.zone.offset(s-e),i=this.zone.offset(s+e),a=this.zone.offset(s-n*t),o=this.zone.offset(s-i*t);if(a===o)return[this];const c=s-a*t,u=s-o*t,l=Gn(c,a),d=Gn(u,o);return l.hour===d.hour&&l.minute===d.minute&&l.second===d.second&&l.millisecond===d.millisecond?[Tr(this,{ts:c}),Tr(this,{ts:u})]:[this]}get isInLeapYear(){return gn(this.year)}get daysInMonth(){return ai(this.year,this.month)}get daysInYear(){return this.isValid?Vs(this.year):NaN}get weeksInWeekYear(){return this.isValid?oi(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:s,calendar:n}=je.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:s,outputCalendar:n}}toUTC(e=0,t={}){return this.setZone(Fe.instance(e),t)}toLocal(){return this.setZone(Ce.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:s=!1}={}){if(e=ur(e,Ce.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(t||s){const i=e.offset(this.ts),a=this.toObject();[n]=ti(a,i,e)}return Tr(this,{ts:n,zone:e})}else return B.invalid(Hn(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:s}={}){const n=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:s});return Tr(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=ci(e,ld),s=!K(t.weekYear)||!K(t.weekNumber)||!K(t.weekday),n=!K(t.ordinal),i=!K(t.year),a=!K(t.month)||!K(t.day),o=i||a,c=t.weekYear||t.weekNumber;if((o||n)&&c)throw new qs("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&n)throw new qs("Can't mix ordinal dates with month/day");let u;s?u=nd({...fo(this.c),...t}):K(t.ordinal)?(u={...this.toObject(),...t},K(t.day)&&(u.day=Math.min(ai(u.year,u.month),u.day))):u=id({...Ba(this.c),...t});const[l,d]=ti(u,this.o,this.zone);return Tr(this,{ts:l,o:d})}plus(e){if(!this.isValid)return this;const t=te.fromDurationLike(e);return Tr(this,od(this,t))}minus(e){if(!this.isValid)return this;const t=te.fromDurationLike(e).negate();return Tr(this,od(this,t))}startOf(e){if(!this.isValid)return this;const t={},s=te.normalizeUnit(e);switch(s){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0;break}if(s==="weeks"&&(t.weekday=1),s==="quarters"){const n=Math.ceil(this.month/3);t.month=(n-1)*3+1}return this.set(t)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?je.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):za}toLocaleString(e=ii,t={}){return this.isValid?je.create(this.loc.clone(t),e).formatDateTime(this):za}toLocaleParts(e={}){return this.isValid?je.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:s=!1,includeOffset:n=!0,extendedZone:i=!1}={}){if(!this.isValid)return null;const a=e==="extended";let o=Ha(this,a);return o+="T",o+=cd(this,a,t,s,n,i),o}toISODate({format:e="extended"}={}){return this.isValid?Ha(this,e==="extended"):null}toISOWeekDate(){return Zn(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:s=!0,includePrefix:n=!1,extendedZone:i=!1,format:a="extended"}={}){return this.isValid?(n?"T":"")+cd(this,a==="extended",t,e,s,i):null}toRFC2822(){return Zn(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Zn(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Ha(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:s=!0}={}){let n="HH:mm:ss.SSS";return(t||e)&&(s&&(n+=" "),t?n+="z":e&&(n+="ZZ")),Zn(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():za}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",s={}){if(!this.isValid||!e.isValid)return te.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...s},i=Xb(t).map(te.normalizeUnit),a=e.valueOf()>this.valueOf(),o=a?this:e,c=a?e:this,u=sS(o,c,i,n);return a?u.negate():u}diffNow(e="milliseconds",t={}){return this.diff(B.now(),e,t)}until(e){return this.isValid?be.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(t)<=s&&s<=n.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||B.fromObject({},{zone:this.zone}),s=e.padding?this<t?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],i=e.unit;return Array.isArray(e.unit)&&(n=e.unit,i=void 0),ud(t,this.plus(s),{...e,numeric:"always",units:n,unit:i})}toRelativeCalendar(e={}){return this.isValid?ud(e.base||B.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(B.isDateTime))throw new ot("min requires all arguments be DateTimes");return Jl(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(B.isDateTime))throw new ot("max requires all arguments be DateTimes");return Jl(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,s={}){const{locale:n=null,numberingSystem:i=null}=s,a=me.fromOpts({locale:n,numberingSystem:i,defaultToEN:!0});return kh(a,e,t)}static fromStringExplain(e,t,s={}){return B.fromFormatExplain(e,t,s)}static get DATE_SHORT(){return ii}static get DATE_MED(){return Bu}static get DATE_MED_WITH_WEEKDAY(){return Mb}static get DATE_FULL(){return zu}static get DATE_HUGE(){return Vu}static get TIME_SIMPLE(){return Hu}static get TIME_WITH_SECONDS(){return Gu}static get TIME_WITH_SHORT_OFFSET(){return Zu}static get TIME_WITH_LONG_OFFSET(){return Wu}static get TIME_24_SIMPLE(){return Ju}static get TIME_24_WITH_SECONDS(){return Ku}static get TIME_24_WITH_SHORT_OFFSET(){return Yu}static get TIME_24_WITH_LONG_OFFSET(){return Qu}static get DATETIME_SHORT(){return Xu}static get DATETIME_SHORT_WITH_SECONDS(){return eh}static get DATETIME_MED(){return th}static get DATETIME_MED_WITH_SECONDS(){return rh}static get DATETIME_MED_WITH_WEEKDAY(){return Ib}static get DATETIME_FULL(){return sh}static get DATETIME_FULL_WITH_SECONDS(){return nh}static get DATETIME_HUGE(){return ih}static get DATETIME_HUGE_WITH_SECONDS(){return ah}}function Us(r){if(B.isDateTime(r))return r;if(r&&r.valueOf&&kr(r.valueOf()))return B.fromJSDate(r);if(r&&typeof r=="object")return B.fromObject(r);throw new ot(`Unknown datetime argument: ${r}, of type ${typeof r}`)}class CS{constructor(){T(this,"_callbacks",[])}onUpdate(e){return this._callbacks.push(e),this}offUpdate(e){const t=this._callbacks.indexOf(e);return t>=0&&this._callbacks.splice(t,1),this}fireUpdate(e){this._callbacks.forEach(t=>t(e||[]))}}class tc extends Map{constructor(){super();T(this,"_callbacks",[])}onUpdate(t){return this._callbacks.push(t),this}offUpdate(t){const s=this._callbacks.indexOf(t);return s>=0&&this._callbacks.splice(s,1),this}fireUpdate(t){this._callbacks.forEach(s=>s(t||[]))}}class Tt extends CS{constructor(t,s){super();T(this,"client");T(this,"data");T(this,"deleted",!1);this.client=t,this.data=s}get source(){return this.data}get _id(){return this.id}get id(){return typeof this.source._id=="string"?this.source._id:this.source._id.user}get createdAt(){return Tf(this.id)}update(t={}){return Object.entries(t).forEach(s=>this.data[s[0]]=s[1]),this.fireUpdate(),this}toString(){return this.id}}class Xe extends Tt{constructor(e,t){super(e,t)}get name(){return this.source.filename}get contentType(){return this.source.content_type}get size(){return this.source.size}get metadata(){return this.source.metadata}get bucket(){return this.source.tag}generateURL(...e){const[t,s,n]=e,i=this.client.config.features.autumn;if(!(i!=null&&i.enabled)||this.metadata.type==="Image"&&(Math.min(this.metadata.width,this.metadata.height)<=0||this.contentType==="image/gif"&&Math.max(this.metadata.width,this.metadata.height)>=1024))return n;const a=t&&(!s||this.contentType!=="image/gif")?"?"+new URLSearchParams(Object.entries(t).map(o=>o.map(String))).toString():"";return`${i.url}/${this.bucket}/${this.id}${a}`}generateDownloadURL(){var e;return(e=this.generateURL())==null?void 0:e.replace("attachments","attachments/download")}}class rc{constructor(e){T(this,"$");this.$=e}isText(){return this.$=="Text"}isMedia(){return this.$=="Media"}isWeb(){return this.$=="Web"}}class ri extends rc{constructor(t,s){super("Text");T(this,"client");T(this,"color");T(this,"description");T(this,"iconURL");T(this,"media");T(this,"title");T(this,"url");this.client=t,this.color=s==null?void 0:s.colour,this.description=s==null?void 0:s.description,this.iconURL=s==null?void 0:s.icon_url,this.media=s!=null&&s.media&&this.client?new Xe(this.client,s.media):null,this.title=s==null?void 0:s.title,this.url=s==null?void 0:s.url}get proxyIconURL(){return this.client?this.client.proxyFile(this.iconURL):this.iconURL}setColor(t){return this.color=t,this}setDescription(t){return this.description=t,this}setIconURL(t){return this.iconURL=t,this}setMedia(t){return this.media=t,this}setTitle(t){return this.title=t,this}setUrl(t){return this.url=t,this}toJSON(){const t={colour:this.color,description:this.description,icon_url:this.iconURL,media:this.media?this.media.source:void 0,title:this.title,url:this.url};return Object.keys(t).forEach(s=>t[s]??delete t[s]),t}}function pd(r){return r.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")}function sc(r,e){let t={nonce:Zs()};return r instanceof ri?t.embeds=[r.toJSON()]:(typeof r!="string"&&(r.embed&&(r.embeds=[r.embed,...r.embeds||[]],delete r.embed),r.embeds&&(r.embeds=r.embeds.map(s=>s instanceof ri?s.toJSON():s)),t={...t,...r}),t.content=typeof r=="string"?r:r.content,e&&(t.content&&typeof r!="string"&&r.expandMentions&&e.isServerBased()&&e.server.members.filter(s=>s.user).forEach(s=>t.content=t.content.replace(new RegExp(pd(`@${s.user.tag}`),"g"),`<@${s.id}>`)),t.content&&typeof r!="string"&&!(r instanceof ri)&&r.expandEmojis&&e.client.emojis.known.forEach(s=>t.content=t.content.replace(new RegExp(pd(`:${s.uniqueName}:`),"g"),`:${s.id}:`)))),t}function DS(r,e){const t=sc(r,e),s={};return"content"in t&&(s.content=t.content),"embeds"in t&&(s.embeds=t.embeds),s}class Uh extends Tt{constructor(e,t){super(e,t)}isSystem(){return!!this.source.system}isUser(){return!this.isSystem()}get channelID(){return this.source.channel}get channel(){return this.client.channels.get(this.channelID)}get server(){return this.channel.isServerBased()?this.channel.server:null}async ack(){var e;await((e=this.channel)==null?void 0:e.ack(this))}async reply(e,t=!1){const s=sc(e,this.channel);return s.replies=[{id:this.id,mention:t}],await this.channel.send(s)}async delete(){await this.client.api.delete(`/channels/${this.channel.id}/messages/${this._id}`),this.channel.messages.delete(this.id)}}class ES extends rc{constructor(t,s){super("Media");T(this,"client");T(this,"source");this.client=t,this.source=s}get type(){return this.source.type}get url(){return this.source.url}get proxyURL(){return this.client.proxyFile(this.url)}get width(){return this.source.width}get height(){return this.source.height}get size(){return"size"in this.source?this.source.size:"Large"}}class kS extends rc{constructor(t,s){super("Web");T(this,"client");T(this,"source");T(this,"color");T(this,"description");T(this,"iconURL");T(this,"originalURL");T(this,"siteName");T(this,"special");T(this,"title");T(this,"url");T(this,"video");T(this,"_media");this.client=t,this.source=s,this.color=s.colour,this.description=s.description,this.iconURL=s.icon_url,this.originalURL=s.original_url,this.siteName=s.site_name,this.special=s.special,this.title=s.title,this.url=s.url,this._media=s.video||s.image}get proxyIconURL(){return this.client.proxyFile(this.iconURL)}get media(){if(this._media)return"size"in this._media?{type:"Image",height:this._media.height,proxyURL:this.client.proxyFile(this._media.url),size:this._media.size,url:this._media.url,width:this._media.width}:{type:"Video",height:this._media.height,proxyURL:this.client.proxyFile(this._media.url),url:this._media.url,width:this._media.width}}}class fd extends Uh{constructor(e,t){super(e,t)}get content(){return this.source.content??null}get attachments(){var e;return(e=this.source.attachments)!=null&&e.length?this.source.attachments.map(t=>new Xe(this.client,t)):null}get edited(){return this.source.edited?new Date(this.source.edited):null}get nonce(){return this.source.nonce??null}get masquerade(){return this.source.masquerade??null}generateMasqAvatarURL(){var t;const e=(t=this.masquerade)==null?void 0:t.avatar;return e?this.client.proxyFile(e):null}get authorID(){return this.source.author}get author(){return this.client.users.get(this.authorID)}async fetchAuthor(e=!1){return await this.client.users.fetch(this.authorID,e)}get member(){return this.channel.isServerBased()?this.channel.server.members.get(this.authorID)??null:null}async fetchMember(){return this.channel.isServerBased()?this.channel.server.members.fetch(this.authorID):null}get mentionIDs(){return this.source.mentions||[]}get mentions(){return this.mentionIDs.map(e=>this.client.users.get(e)).filter(e=>e)}async fetchMentions(){return(await Promise.all(this.mentionIDs.map(e=>this.client.users.fetch(e)))).filter(e=>e)}get replyIDs(){return this.source.replies||[]}get replies(){return this.replyIDs.map(e=>this.channel.messages.get(e)).filter(e=>e)}async fetchReplies(){return(await Promise.all(this.replyIDs.map(e=>this.channel.messages.fetch(e)))).filter(e=>e)}get embeds(){var e;return((e=this.source.embeds)==null?void 0:e.map(t=>{switch(t.type){case"Text":return new ri(this.client,t);case"Website":return new kS(this.client,t);case"Image":case"Video":return new ES(this.client,t)}}).filter(t=>t))||[]}get reactions(){return Object.entries(this.source.reactions).map(e=>({emoji:e[0],userIDs:e[1],users:e[1].map(t=>this.client.users.get(t)).filter(t=>t)}))}get restrictReactions(){var e;return!!((e=this.source.interactions)!=null&&e.restrict_reactions)}async react(e){await this.client.api.put(`/channels/${this.channel.id}/messages/${this._id}/reactions/${typeof e=="string"?e:e.id}`)}async unreact(e){await this.client.api.delete(`/channels/${this.channel.id}/messages/${this._id}/reactions/${typeof e=="string"?e:e.id}`)}async clearReactions(){await this.client.api.delete(`/channels/${this.channel.id}/messages/${this._id}/reactions`)}appendEmbed({embeds:e}){e&&this.update({embeds:[...this.source.embeds??[],...e]})}async edit(e){return this.update(await this.client.api.patch(`/channels/${this.channel.id}/messages/${this._id}`,DS(e,this.channel)))}}class OS extends Uh{constructor(e,t){super(e,t)}get detail(){const e=this.source.system,t=s=>this.client.users.get(s);switch(e.type){case"text":return{type:Ye.Text,content:e.content};case"user_added":return{type:Ye.UserAdded,user:t(e.id),by:t(e.by)};case"user_remove":return{type:Ye.UserRemoved,user:t(e.id),by:t(e.by)};case"user_joined":return{type:Ye.UserJoined,user:t(e.id)};case"user_left":return{type:Ye.UserLeft,user:t(e.id)};case"user_kicked":return{type:Ye.UserKicked,user:t(e.id)};case"user_banned":return{type:Ye.UserBanned,user:t(e.id)};case"channel_renamed":return{type:Ye.GroupRenamed,name:e.name,by:t(e.by)};case"channel_description_changed":return{type:Ye.GroupDescriptionChange,by:t(e.by)};case"channel_icon_changed":return{type:Ye.GroupIconChange,by:t(e.by)};case"channel_ownership_changed":return{type:Ye.GroupOwnershipChange,from:t(e.from),to:t(e.to)}}}}class Qt extends tc{constructor(){super()}set(e,t){return super.set(e,t),this.fireUpdate([t]),this}delete(e){const t=this.get(e);return t&&t.update({deleted:!0}),this.fireUpdate(t?[t]:[]),super.delete(e)}items(){return[...this.values()]}find(...e){return this.items().find(...e)}filter(...e){return this.items().filter(...e)}map(e){return this.items().map(e)}sort(...e){return this.items().sort(...e)}}class xS extends Qt{constructor(t,s){super();T(this,"client");T(this,"channel");this.client=t,this.channel=s}construct(t){const s=this.get(t._id);if(s)return s.update(t);{const n=new(t._id==ro||t.system?OS:fd)(this.client,t);return this.set(n.id,n),n.onUpdate(()=>this.fireUpdate([n])),n}}get ordered(){return this.items().sort((t,s)=>t.createdAt-s.createdAt)}async fetch(t){return this.construct(await this.client.api.get(`/channels/${this.channel.id}/messages/${t}`))}async fetchMultiple(t){const s=await this.client.api.get(`/channels/${this.channel.id}/messages`,{...t});if(t!=null&&t.include_users){const n=s;n.users.forEach(a=>this.client.users.construct(a));const i=this.channel;return i.isServerBased()&&n.members&&n.members.forEach(a=>i.server.members.construct(a)),n.messages.map(a=>this.construct(a))}else return s.map(n=>this.construct(n))}async search(t){const s=await this.client.api.post(`/channels/${this.channel.id}/search`,{...t});if(t!=null&&t.include_users){const n=s;n.users.forEach(a=>this.client.users.construct(a));const i=this.channel;return i.isServerBased()&&n.members&&n.members.forEach(a=>i.server.members.construct(a)),n.messages.map(a=>this.construct(a))}else return s.map(n=>this.construct(n))}async bulkDelete(t){t.length&&(t[0]instanceof fd&&(t=t.filter(s=>B.fromMillis(s.createdAt).diffNow("days").days<7)),await this.client.api.delete(`/channels/${this.channel.id}/messages/bulk`,{data:{ids:t}}),t.forEach(s=>this.delete(s)))}}class qh extends tc{constructor(t){super();T(this,"client");this.client=t}async sync(){const t=await this.client.api.get("/sync/unreads");for(const s of t){const{_id:n,...i}=s;this.set(n.channel,i)}this.fireUpdate()}async markRead(t,s,n=!0){const i=s??Zs();this.set(t.id,{last_id:i}),this.fireUpdate(),n&&await t.ack(i),this.fireUpdate()}markUnread(t,s){this.set(t.id,{...this.get(t.id),last_id:s}),this.fireUpdate()}markMention(t){const s=this.get(t.channelID);this.set(t.channelID,{last_id:"0",...s,mentions:[...(s==null?void 0:s.mentions)??[],t.id]}),this.fireUpdate()}}/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var dt=null;try{dt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function se(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}se.prototype.__isLong__;Object.defineProperty(se.prototype,"__isLong__",{value:!0});function $e(r){return(r&&r.__isLong__)===!0}function md(r){var e=Math.clz32(r&-r);return r?31-e:e}se.isLong=$e;var gd={},_d={};function Ir(r,e){var t,s,n;return e?(r>>>=0,(n=0<=r&&r<256)&&(s=_d[r],s)?s:(t=ne(r,0,!0),n&&(_d[r]=t),t)):(r|=0,(n=-128<=r&&r<128)&&(s=gd[r],s)?s:(t=ne(r,r<0?-1:0,!1),n&&(gd[r]=t),t))}se.fromInt=Ir;function ut(r,e){if(isNaN(r))return e?Wt:bt;if(e){if(r<0)return Wt;if(r>=Bh)return Hh}else{if(r<=-yd)return Ve;if(r+1>=yd)return Vh}return r<0?ut(-r,e).neg():ne(r%ms|0,r/ms|0,e)}se.fromNumber=ut;function ne(r,e,t){return new se(r,e,t)}se.fromBits=ne;var li=Math.pow;function nc(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?Wt:bt;if(t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=r.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return nc(r.substring(1),e,t).neg();for(var n=ut(li(t,8)),i=bt,a=0;a<r.length;a+=8){var o=Math.min(8,r.length-a),c=parseInt(r.substring(a,a+o),t);if(o<8){var u=ut(li(t,o));i=i.mul(u).add(ut(c))}else i=i.mul(n),i=i.add(ut(c))}return i.unsigned=e,i}se.fromString=nc;function Ct(r,e){return typeof r=="number"?ut(r,e):typeof r=="string"?nc(r,e):ne(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}se.fromValue=Ct;var wd=65536,PS=1<<24,ms=wd*wd,Bh=ms*ms,yd=Bh/2,bd=Ir(PS),bt=Ir(0);se.ZERO=bt;var Wt=Ir(0,!0);se.UZERO=Wt;var cs=Ir(1);se.ONE=cs;var zh=Ir(1,!0);se.UONE=zh;var mo=Ir(-1);se.NEG_ONE=mo;var Vh=ne(-1,2147483647,!1);se.MAX_VALUE=Vh;var Hh=ne(-1,-1,!0);se.MAX_UNSIGNED_VALUE=Hh;var Ve=ne(0,-2147483648,!1);se.MIN_VALUE=Ve;var E=se.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low};E.toNumber=function(){return this.unsigned?(this.high>>>0)*ms+(this.low>>>0):this.high*ms+(this.low>>>0)};E.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ve)){var t=ut(e),s=this.div(t),n=s.mul(t).sub(this);return s.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=ut(li(e,6),this.unsigned),a=this,o="";;){var c=a.div(i),u=a.sub(c.mul(i)).toInt()>>>0,l=u.toString(e);if(a=c,a.isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}};E.getHighBits=function(){return this.high};E.getHighBitsUnsigned=function(){return this.high>>>0};E.getLowBits=function(){return this.low};E.getLowBitsUnsigned=function(){return this.low>>>0};E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ve)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};E.isZero=function(){return this.high===0&&this.low===0};E.eqz=E.isZero;E.isNegative=function(){return!this.unsigned&&this.high<0};E.isPositive=function(){return this.unsigned||this.high>=0};E.isOdd=function(){return(this.low&1)===1};E.isEven=function(){return(this.low&1)===0};E.equals=function(e){return $e(e)||(e=Ct(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};E.eq=E.equals;E.notEquals=function(e){return!this.eq(e)};E.neq=E.notEquals;E.ne=E.notEquals;E.lessThan=function(e){return this.comp(e)<0};E.lt=E.lessThan;E.lessThanOrEqual=function(e){return this.comp(e)<=0};E.lte=E.lessThanOrEqual;E.le=E.lessThanOrEqual;E.greaterThan=function(e){return this.comp(e)>0};E.gt=E.greaterThan;E.greaterThanOrEqual=function(e){return this.comp(e)>=0};E.gte=E.greaterThanOrEqual;E.ge=E.greaterThanOrEqual;E.compare=function(e){if($e(e)||(e=Ct(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};E.comp=E.compare;E.negate=function(){return!this.unsigned&&this.eq(Ve)?Ve:this.not().add(cs)};E.neg=E.negate;E.add=function(e){$e(e)||(e=Ct(e));var t=this.high>>>16,s=this.high&65535,n=this.low>>>16,i=this.low&65535,a=e.high>>>16,o=e.high&65535,c=e.low>>>16,u=e.low&65535,l=0,d=0,h=0,p=0;return p+=i+u,h+=p>>>16,p&=65535,h+=n+c,d+=h>>>16,h&=65535,d+=s+o,l+=d>>>16,d&=65535,l+=t+a,l&=65535,ne(h<<16|p,l<<16|d,this.unsigned)};E.subtract=function(e){return $e(e)||(e=Ct(e)),this.add(e.neg())};E.sub=E.subtract;E.multiply=function(e){if(this.isZero())return this;if($e(e)||(e=Ct(e)),dt){var t=dt.mul(this.low,this.high,e.low,e.high);return ne(t,dt.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Wt:bt;if(this.eq(Ve))return e.isOdd()?Ve:bt;if(e.eq(Ve))return this.isOdd()?Ve:bt;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(bd)&&e.lt(bd))return ut(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,n=this.high&65535,i=this.low>>>16,a=this.low&65535,o=e.high>>>16,c=e.high&65535,u=e.low>>>16,l=e.low&65535,d=0,h=0,p=0,f=0;return f+=a*l,p+=f>>>16,f&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=a*u,h+=p>>>16,p&=65535,h+=n*l,d+=h>>>16,h&=65535,h+=i*u,d+=h>>>16,h&=65535,h+=a*c,d+=h>>>16,h&=65535,d+=s*l+n*u+i*c+a*o,d&=65535,ne(p<<16|f,d<<16|h,this.unsigned)};E.mul=E.multiply;E.divide=function(e){if($e(e)||(e=Ct(e)),e.isZero())throw Error("division by zero");if(dt){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?dt.div_u:dt.div_s)(this.low,this.high,e.low,e.high);return ne(t,dt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Wt:bt;var s,n,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Wt;if(e.gt(this.shru(1)))return zh;i=Wt}else{if(this.eq(Ve)){if(e.eq(cs)||e.eq(mo))return Ve;if(e.eq(Ve))return cs;var a=this.shr(1);return s=a.div(e).shl(1),s.eq(bt)?e.isNegative()?cs:mo:(n=this.sub(e.mul(s)),i=s.add(n.div(e)),i)}else if(e.eq(Ve))return this.unsigned?Wt:bt;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=bt}for(n=this;n.gte(e);){s=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(s)/Math.LN2),c=o<=48?1:li(2,o-48),u=ut(s),l=u.mul(e);l.isNegative()||l.gt(n);)s-=c,u=ut(s,this.unsigned),l=u.mul(e);u.isZero()&&(u=cs),i=i.add(u),n=n.sub(l)}return i};E.div=E.divide;E.modulo=function(e){if($e(e)||(e=Ct(e)),dt){var t=(this.unsigned?dt.rem_u:dt.rem_s)(this.low,this.high,e.low,e.high);return ne(t,dt.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};E.mod=E.modulo;E.rem=E.modulo;E.not=function(){return ne(~this.low,~this.high,this.unsigned)};E.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};E.clz=E.countLeadingZeros;E.countTrailingZeros=function(){return this.low?md(this.low):md(this.high)+32};E.ctz=E.countTrailingZeros;E.and=function(e){return $e(e)||(e=Ct(e)),ne(this.low&e.low,this.high&e.high,this.unsigned)};E.or=function(e){return $e(e)||(e=Ct(e)),ne(this.low|e.low,this.high|e.high,this.unsigned)};E.xor=function(e){return $e(e)||(e=Ct(e)),ne(this.low^e.low,this.high^e.high,this.unsigned)};E.shiftLeft=function(e){return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ne(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ne(0,this.low<<e-32,this.unsigned)};E.shl=E.shiftLeft;E.shiftRight=function(e){return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ne(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ne(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};E.shr=E.shiftRight;E.shiftRightUnsigned=function(e){return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ne(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?ne(this.high,0,this.unsigned):ne(this.high>>>e-32,0,this.unsigned)};E.shru=E.shiftRightUnsigned;E.shr_u=E.shiftRightUnsigned;E.rotateLeft=function(e){var t;return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ne(this.high,this.low,this.unsigned):e<32?(t=32-e,ne(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,ne(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};E.rotl=E.rotateLeft;E.rotateRight=function(e){var t;return $e(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ne(this.high,this.low,this.unsigned):e<32?(t=32-e,ne(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,ne(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};E.rotr=E.rotateRight;E.toSigned=function(){return this.unsigned?ne(this.low,this.high,!1):this};E.toUnsigned=function(){return this.unsigned?this:ne(this.low,this.high,!0)};E.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};E.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};E.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};se.fromBytes=function(e,t,s){return s?se.fromBytesLE(e,t):se.fromBytesBE(e,t)};se.fromBytesLE=function(e,t){return new se(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};se.fromBytesBE=function(e,t){return new se(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};function Gh(r){return r.reduce((e,t)=>e.or(t),se.fromNumber(0))}function MS(r,...e){const t=Gh(e);return t.and(r).eq(t)}class yn{constructor(e,t){T(this,"map");T(this,"bits");this.map=e,this.bits=t}has(e){return MS(this.bits,e)}add(e){return this.bits=se.fromNumber(e).or(this.bits).toNumber(),this}remove(e){return this.bits=Gh(this.all().filter(t=>t!=e)).toNumber(),this}mapAll(){return Object.values(this.map).filter(e=>typeof e=="number").map(Number)}all(){return this.mapAll().filter(e=>this.has(e))}}class IS extends Tt{constructor(t,s){super(t,s);T(this,"timeoutClearer");this.scheduleTimeoutClear(),this.onUpdate(()=>this.scheduleTimeoutClear())}get joinedAt(){return new Date(this.source.joined_at)}get nickname(){return this.source.nickname??null}get roles(){return this.source.roles?this.source.roles.map(t=>this.server.roles.get(t)).filter(t=>t).sort((t,s)=>s.rank-t.rank):[]}get hoistedRole(){return this.roles.filter(t=>t.hoist).slice(-1)[0]??null}get colorRole(){return this.roles.filter(t=>t.color).slice(-1)[0]??null}get timeoutEnds(){return this.source.timeout?new Date(this.source.timeout):null}get serverID(){return this.source._id.server}get server(){return this.client.servers.get(this.serverID)}get user(){return this.client.users.get(this.id)}async fetchUser(){return await this.client.users.fetch(this.id)}get avatar(){return this.source.avatar?new Xe(this.client,this.source.avatar):null}generateAvatarURL(...t){return this.avatar?this.avatar.generateURL(...t):null}get permissions(){return new vt(di(this.server,this))}get ranking(){if(this.id===this.server.ownerID)return-1/0;const t=this.roles;return t.length>0?t[t.length-1].rank:1/0}get inferior(){var t;return(((t=this.server.me)==null?void 0:t.ranking)??1/0)<this.ranking}get kickable(){return this.server.me.permissions.has(ge.KickMembers)&&this.inferior}get bannable(){return this.server.me.permissions.has(ge.BanMembers)&&this.inferior}inferiorTo(t){return t.ranking<this.ranking}async edit(t){this.update(await this.client.api.patch(`/servers/${this.serverID}/members/${this._id}`,t))}async addRole(t){const s=new Set(this.roles.map(n=>n.id));return s.add(t.id),await this.edit({roles:[...s]})}async removeRole(t){const s=new Set(this.roles.map(n=>n.id));return s.delete(t.id),await this.edit(s.size?{roles:[...s]}:{remove:["Roles"]})}async timeout(t){return await this.edit(t?{timeout:new Date(t).toISOString()}:{remove:["Timeout"]})}async kick(){await this.client.api.delete(`/servers/${this.serverID}/members/${this.id}`)}async ban(t){await this.server.members.ban(this,t)}scheduleTimeoutClear(){if(this.timeoutClearer&&clearTimeout(this.timeoutClearer),this.timeoutEnds){const t=+this.timeoutEnds-+new Date;t>0?this.timeoutClearer=setTimeout(()=>{this.update({timeout:null})},t):this.update({timeout:null})}}toString(){return`<@${this.id}>`}}class LS extends Qt{constructor(t,s){super();T(this,"client");T(this,"server");this.client=t,this.server=s}get self(){return this.items().find(t=>t.id==this.client.users.self.id)}async ban(t,s){await this.client.api.put(`/servers/${this.server.id}/bans/${typeof t=="string"?t:t.id}`,s)}async unban(t){await this.client.api.delete(`/servers/${this.server.id}/bans/${t}`)}construct(t){const s=this.get(t._id.user);if(s)return s.update(t);{const n=new IS(this.client,t);return this.set(n.id,n),n.onUpdate(()=>this.fireUpdate([n])),n}}async fetch(t,s=!1){return this.get(t)&&!s?this.get(t):this.construct(await this.client.api.get(`/servers/${this.server.id}/members/${t}`))}async fetchAll(t=!1){const s=await this.client.api.get(`/servers/${this.server.id}/members`,{exclude_offline:t});return s.users.forEach(n=>this.client.users.construct(n)),s.members.map(n=>this.server.members.construct(n))}}class NS extends Tt{constructor(t,s,n){super(t,n);T(this,"server");this.server=s}get name(){return this.source.name}get color(){return this.source.colour??null}get rank(){return this.source.rank||0}get hoist(){return!!this.source.hoist}get permissions(){return{allow:new vt(this.source.permissions.a),deny:new vt(this.source.permissions.d)}}async edit(t){return this.update(await this.client.api.patch(`/servers/${this.server.id}/roles/${this._id}`,t))}async delete(){await this.client.api.delete(`/servers/${this.server.id}/roles/${this._id}`),this.server.roles.delete(this.id)}toString(){return this.name}}class AS extends Qt{constructor(t,s){super();T(this,"client");T(this,"server");this.client=t,this.server=s,this.update()}get ordered(){return this.items().sort((t,s)=>t.rank-s.rank)}async create(t,s){const n=await this.client.api.post(`/servers/${this.server.id}/roles`,typeof s=="number"?{name:t,rank:s}:{name:t});return this.construct({_id:n.id,...n.role})}construct(t){const s=this.get(t._id);if(s)return s.update(t);{const n=new NS(this.client,this.server,t);return this.set(n.id,n),n.onUpdate(()=>this.fireUpdate([n])),n}}update(){if(!this.server.source.roles)this.clear();else{const t=Object.entries(this.server.source.roles).map(s=>({_id:s[0],...s[1]}));this.items().forEach(s=>{t.find(n=>n._id==s.id)||this.delete(s.id)}),t.forEach(s=>this.construct(s))}}}class jS extends Qt{constructor(t){super();T(this,"server");this.server=t}async create(t){return await this.server.client.channels.create(this.server,t)}}class $S extends Qt{constructor(t){super();T(this,"server");this.server=t}async create(t,s){return await this.server.client.emojis.create(this.server,t,s)}}var go;(function(r){r[r.Official=1]="Official",r[r.Verified=2]="Verified"})(go||(go={}));class FS extends yn{constructor(e){super(go,e)}has(e){return super.has(e)}all(){return super.all()}}class Ga extends Tt{constructor(t,s,n){super(t,s);T(this,"server");this.server=n}get createdAt(){return this.id=="default"?0:super.createdAt}get name(){return this.source.title}get channelIDs(){return this.source.channels}get channels(){return this.channelIDs.map(t=>this.server.channels.get(t)).filter(t=>t)}toString(){return this.name}}class Zh extends Tt{get createdAt(){return 0}constructor(e,t){super(e,t)}get type(){return this.source.type}get creatorID(){return this.source.creator}get creator(){return this.client.users.get(this.creatorID)}async fetchCreator(e=!1){return await this.client.users.fetch(this.creatorID,e)}get channelID(){return this.source.creator}get channel(){return this.client.channels.get(this.channelID)}async fetchChannel(){return await this.client.channels.fetch(this.channelID)}get serverID(){return this.source.type=="Server"?this.source.server:null}get server(){return this.serverID?this.client.servers.get(this.serverID):null}generateURL(e="https://rvlt.gg"){return`${e}/${this.id}`}async delete(){await this.client.api.delete(`/invites/${this._id}`)}}class Wh extends Tt{constructor(t,s){super(t,s);T(this,"members");T(this,"roles");this.members=new LS(this.client,this),this.roles=new AS(this.client,this),this.members.onUpdate(()=>this.fireUpdate())}update(t){return super.update(t),this.roles.update(),this}get channels(){const t=new jS(this);return this.client.channels.forEach(s=>s.isServerBased()&&s.serverID==this.id&&t.set(s.id,s)),t}get emojis(){const t=new $S(this);return this.client.emojis.forEach(s=>s.parentID==this.id&&t.set(s.id,s)),t}get categories(){var t;return((t=this.source.categories)==null?void 0:t.map(s=>new Ga(this.client,{_id:s.id,...s},this)))||[]}get orderedChannels(){const t=new Set(this.channels.items().map(i=>i.id)),s=[];let n;if(this.categories)for(const i of this.categories){const a=[];for(const c of i.channelIDs)t.delete(c)&&a.push(this.channels.get(c));const o=new Ga(this.client,{_id:i.id,title:i.name,channels:a.map(c=>c.id)},this);if(o.id==="default"){if(a.length==0)continue;n=o}s.push(o)}return t.size>0&&(n?n.update({channels:[...n.channelIDs,...t]}):s.unshift(new Ga(this.client,{_id:"default",title:"Default",channels:[...t]},this))),s}get name(){return this.source.name}get description(){return this.source.description??null}get nsfw(){return!!this.source.nsfw}get flags(){return new FS(this.source.flags||0)}get ownerID(){return this.source.owner}get owner(){return this.client.users.get(this.ownerID)??null}async fetchOwner(t=!1){return await this.client.users.fetch(this.ownerID,t)}get me(){return this.members.get(this.client.users.self.id)??null}async fetchMe(){return await this.members.fetch(this.client.users.self.id)}get defaultPermissions(){return new vt(this.source.default_permissions)}get systemMessages(){return this.source.system_messages??null}get icon(){return this.source.icon?new Xe(this.client,this.source.icon):null}generateIconURL(...t){return this.icon?this.icon.generateURL(...t):null}get banner(){return this.source.banner?new Xe(this.client,this.source.banner):null}generateBannerURL(...t){return this.banner?this.banner.generateURL(...t):null}async edit(t){this.update(await this.client.api.patch(`/servers/${this._id}`,t))}async leave(t){await this.client.api.delete(`/servers/${this._id}`,{leave_silently:t}),this.client.servers.delete(this.id)}async fetchInvites(){return(await this.client.api.get(`/servers/${this._id}/invites`)).map(t=>new Zh(this.client,t))}async fetchBans(){const t=await this.client.api.get(`/servers/${this._id}/bans`);return t.bans.map(s=>{const n=t.users.find(i=>i._id==s._id.user);return{userID:(n==null?void 0:n._id)??null,userUsername:(n==null?void 0:n.username)??null,userAvatar:n!=null&&n.avatar?new Xe(this.client,n.avatar):null,reason:s.reason??null}})}isUnread(t){return t(this)?!1:!!this.channels.find(s=>!t(s)&&s.unread)}getMentions(t){return t(this)?[]:this.channels.filter(n=>!t(n)).map(n=>n.mentions).flat(1)}async ack(){await this.client.api.put(`/servers/${this._id}/ack`)}async setRolePermissions(t,s){this.update(await this.client.api.put(`/servers/${this._id}/permissions/${t}`,{permissions:s}))}}var Gt;(function(r){r[r.Access=1]="Access",r[r.ViewProfile=2]="ViewProfile",r[r.SendMessage=4]="SendMessage",r[r.Invite=8]="Invite"})(Gt||(Gt={}));var ge;(function(r){r[r.ManageChannel=1]="ManageChannel",r[r.ManageServer=2]="ManageServer",r[r.ManagePermissions=4]="ManagePermissions",r[r.ManageRole=8]="ManageRole",r[r.ManageCustomisation=16]="ManageCustomisation",r[r.KickMembers=64]="KickMembers",r[r.BanMembers=128]="BanMembers",r[r.TimeoutMembers=256]="TimeoutMembers",r[r.AssignRoles=512]="AssignRoles",r[r.ChangeNickname=1024]="ChangeNickname",r[r.ManageNicknames=2048]="ManageNicknames",r[r.ChangeAvatar=4096]="ChangeAvatar",r[r.RemoveAvatars=8192]="RemoveAvatars",r[r.ViewChannel=1048576]="ViewChannel",r[r.ReadMessageHistory=2097152]="ReadMessageHistory",r[r.SendMessage=4194304]="SendMessage",r[r.ManageMessages=8388608]="ManageMessages",r[r.ManageWebhooks=16777216]="ManageWebhooks",r[r.InviteOthers=33554432]="InviteOthers",r[r.SendEmbeds=67108864]="SendEmbeds",r[r.UploadFiles=134217728]="UploadFiles",r[r.Masquerade=268435456]="Masquerade",r[r.React=536870912]="React",r[r.Connect=1073741824]="Connect",r[r.Speak=2147483648]="Speak",r[r.Video=4294967296]="Video",r[r.MuteMembers=8589934592]="MuteMembers",r[r.DeafenMembers=17179869184]="DeafenMembers",r[r.MoveMembers=34359738368]="MoveMembers",r[r.GrantAllSafe=0xfffffffffffff]="GrantAllSafe"})(ge||(ge={}));const US=2**32-1,vd=ge.ViewChannel+ge.ReadMessageHistory,Jh=ge.ViewChannel+ge.ReadMessageHistory,Kh=Jh+ge.SendMessage+ge.InviteOthers+ge.SendEmbeds+ge.UploadFiles+ge.Connect+ge.Speak;ge.GrantAllSafe;const Za=Kh+ge.React+ge.ManageChannel;Kh+ge.React+ge.ChangeNickname+ge.ChangeAvatar;function di(r,e){const t=e?e.user:r.client.user;if(t!=null&&t.privileged)return ge.GrantAllSafe;if(r instanceof Wh){if(r.ownerID==(t==null?void 0:t.id))return ge.GrantAllSafe;{const s=e??r.members.get(t.id)??{roles:null,timeoutEnds:null};if(!s)return 0;let n=se.fromNumber(r.defaultPermissions.bits);if(s.roles&&r.roles){const i=s.roles.map(a=>a.permissions);for(const a of i)n=n.or(a.allow.bits).and(se.fromNumber(a.deny.bits).not())}return s.timeoutEnds&&s.timeoutEnds>new Date&&(n=n.and(vd)),n.toNumber()}}else{if(r.isSavedMessages())return ge.GrantAllSafe;if(r.isDM())return r.recipient.permissionsAgainst.has(Gt.SendMessage)?Za:Jh;if(r.isGroupDM())return r.ownerID==(t==null?void 0:t.id)?Za:r.permissions.bits??Za;if(r.isServerBased()){const s=r.server;if(!s)return 0;if(s.ownerID==(t==null?void 0:t.id))return ge.GrantAllSafe;{const n=e??s.members.get(t.id)??{roles:null,timeoutEnds:null};if(!n)return 0;let i=se.fromNumber(di(s,e));if(r.defaultPermissions&&(i=i.or(r.defaultPermissions.allow.bits).and(se.fromNumber(r.defaultPermissions.deny.bits).not())),n.roles&&r.rolePermissions&&s.roles)for(const a of n.roles.map(o=>o.id)){const o=r.rolePermissions.find(c=>c.id==a);o&&(i=i.or(o.allow.bits).and(se.fromNumber(o.deny.bits).not()))}return n.timeoutEnds&&n.timeoutEnds>new Date&&(i=i.and(vd)),i.toNumber()}}}}class vt extends yn{constructor(e){super(ge,e)}has(e){return super.has(e)}add(e){return super.add(e)}remove(e){return super.remove(e)}all(){return super.all()}}var ct;(function(r){r.DM="DirectMessage",r.GroupDM="Group",r.SavedMessages="SavedMessages",r.Text="TextChannel",r.Voice="VoiceChannel"})(ct||(ct={}));class Bi extends Tt{constructor(t,s){super(t,s);T(this,"messages");T(this,"typingIDs",new Set);this.isTextBased()&&(this.messages=new xS(this.client,this))}get type(){return this.source.channel_type}isText(){return this.type==ct.Text}isVoice(){return this.type==ct.Voice}isDM(){return this.type==ct.DM}isGroupDM(){return this.type==ct.GroupDM}isSavedMessages(){return this.type==ct.SavedMessages}isTextBased(){return this.isText()||this.isDM()||this.isGroupDM()||this.isSavedMessages()}isDMBased(){return this.isDM()||this.isGroupDM()}isServerBased(){return this.isText()||this.isVoice()}get name(){return this.source.channel_type=="SavedMessages"?"Saved Notes":this.source.channel_type=="DirectMessage"?this.isDM()?this.recipient.username:"":this.source.name}get description(){return this.source.channel_type=="SavedMessages"||this.source.channel_type=="DirectMessage"?null:this.source.description??null}get nsfw(){return this.source.channel_type=="DirectMessage"||this.source.channel_type=="SavedMessages"?!1:!!this.source.nsfw}get icon(){return this.source.channel_type=="SavedMessages"?null:this.source.channel_type=="DirectMessage"?this.isDM()?this.recipient.avatar:null:this.source.icon?new Xe(this.client,this.source.icon):null}generateIconURL(...t){return this.icon?this.icon.generateURL(...t):null}async setPermissions(t,s){await this.client.api.put(`/channels/${this._id}/permissions/${typeof t=="string"?t:t.id}`,{permissions:s})}get permissions(){return new vt(di(this))}permissionsFor(t){return new vt(di(this,t))}async createInvite(){return new Zh(this.client,await this.client.api.post(`/channels/${this._id}/invites`))}get lastMessageID(){return this.source.channel_type=="SavedMessages"||this.source.channel_type=="VoiceChannel"?null:this.source.last_message_id??null}get lastMessage(){return this.lastMessageID?this.messages.get(this.lastMessageID)??null:null}async fetchLastMessage(){return this.lastMessageID?await this.fetchMessage(this.lastMessageID):null}lastMessageBy(t){return this.messages.ordered.reverse().find(s=>s.isUser()&&s.authorID==t.id)??null}get typing(){return[...this.typingIDs.values()].filter(t=>t!==this.client.user.id).map(t=>this.client.users.get(t)).filter(t=>t)}startTyping(){this.client.ws.send({type:"BeginTyping",channel:this.id})}stopTyping(){this.client.ws.send({type:"EndTyping",channel:this.id})}checkUnread(t){return t(this)?!1:this.unread}get unread(){var t;return!this.lastMessageID||!this.isTextBased()||this.isSavedMessages()?!1:(((t=this.client.unreads.get(this.id))==null?void 0:t.last_id)??Zs()).localeCompare(this.lastMessageID)===-1}getMentions(t){return t(this)?[]:this.mentions}get mentions(){var t;return!this.isTextBased()||this.isSavedMessages()?[]:((t=this.client.unreads.get(this.id))==null?void 0:t.mentions)??[]}async ack(t){const s=(typeof t=="string"?t:t==null?void 0:t.id)??this.lastMessageID??Zs();await this.client.api.put(`/channels/${this._id}/ack/${s}`)}async markRead(t=!1){var s,n;if(this.lastMessageID)if(t){(s=this.client.unreads)==null||s.markRead(this,this.lastMessageID);const i=new qh(this.client);await i.sync(),(((n=i.get(this.id))==null?void 0:n.last_id)??"0").localeCompare(this.lastMessageID)===-1&&this.ack()}else await this.client.unreads.sync(),this.unread&&await this.ack()}async send(t){return this.messages.construct(await this.client.api.post(`/channels/${this._id}/messages`,sc(t,this)))}async fetchMessage(t){return await this.messages.fetch(t)}async edit(t){return this.update(await this.client.api.patch(`/channels/${this._id}`,t))}async delete(t){await this.client.api.delete(`/channels/${this._id}`,{leave_silently:t}),this.isDM()&&this.update({active:!1}),this.client.channels.delete(this.id)}toString(){return`<#${this.id}>`}}class qS extends Bi{get type(){return ct.DM}get source(){return super.source}constructor(e,t){super(e,t)}get active(){return this.source.active}get recipientID(){return this.source.recipients.find(e=>e!=this.client.user.id)}get recipient(){return this.recipientID?this.client.users.get(this.recipientID):null}async fetchRecipient(){return this.recipientID?await this.client.users.fetch(this.recipientID):null}async joinCall(){return(await this.client.api.post(`/channels/${this.id}/join_call`)).token}}class BS extends Bi{get type(){return ct.GroupDM}get source(){return super.source}constructor(e,t){super(e,t)}get ownerID(){return this.source.owner}get owner(){return this.client.users.get(this.ownerID)}async fetchOwner(e=!1){return await this.client.users.fetch(this.ownerID,e)}get recipientIDs(){return this.source.recipients.filter(e=>e!==this.client.user.id)}get recipients(){return this.recipientIDs.map(e=>this.client.users.get(e)).filter(e=>e)}async fetchRecipients(){return(await this.client.api.get(`/channels/${this._id}/members`)).map(e=>this.client.users.construct(e)).filter(e=>e.id!==this.client.user.id)}async addRecipient(e){await this.client.api.put(`/channels/${this._id}/recipients/${typeof e=="string"?e:e.id}`)}async removeRecipient(e){await this.client.api.delete(`/channels/${this._id}/recipients/${typeof e=="string"?e:e.id}`)}async joinCall(){return(await this.client.api.post(`/channels/${this.id}/join_call`)).token}get permissions(){return new vt(this.source.permissions||0)}}class zS extends Bi{get type(){return ct.SavedMessages}constructor(e,t){super(e,t)}}class Yh extends Bi{get type(){return super.type}get source(){return super.source}constructor(e,t){super(e,t)}get serverID(){return this.source.server}get server(){return this.client.servers.get(this.source.server)}get defaultPermissions(){var e,t;return{allow:new vt(((e=this.source.default_permissions)==null?void 0:e.a)||0),deny:new vt(((t=this.source.default_permissions)==null?void 0:t.d)||0)}}get rolePermissions(){return this.source.role_permissions?Object.entries(this.source.role_permissions).map(([e,t])=>({id:e,allow:new vt(t.a||0),deny:new vt(t.d||0)})):[]}}class VS extends Yh{get type(){return ct.Text}constructor(e,t){super(e,t)}}const HS=(r,e)=>r;class GS extends HS(Yh){constructor(t,s){super(t,s);T(this,"type",ct.Voice)}async joinCall(){return(await this.client.api.post(`/channels/${this.id}/join_call`)).token}}class ZS extends Qt{constructor(t){super();T(this,"client");this.client=t}construct(t){const s=this.get(t._id);if(s)return s.update(t);{const n=(()=>{switch(t.channel_type){case"DirectMessage":return new qS(this.client,t);case"Group":return new BS(this.client,t);case"SavedMessages":return new zS(this.client,t);case"TextChannel":return new VS(this.client,t);case"VoiceChannel":return new GS(this.client,t)}})();return this.set(n.id,n),n.onUpdate(()=>this.fireUpdate([n])),n}}async fetch(t,s){return this.has(t)?this.get(t).update(s):this.construct(s??await this.client.api.get(`/channels/${t}`))}async create(t,s){return this.construct(await this.client.api.post(`/servers/${t.id}/channels`,s))}}class WS{constructor(e){T(this,"name");T(this,"pack","mutant");this.name=e}get id(){return this.name}get imageURL(){return KS(Qh[this.name],this.pack)}get parent(){return null}get uniqueName(){return this.name}setPack(e){return this.pack=e,this}toString(){return`:${this.id}:`}}function JS(r){r=r.indexOf(String.fromCharCode(8205))<0?r.replace(/\uFE0F/g,""):r;const e=[];let t=0,s=0;for(;s<r.length;){const n=r.charCodeAt(s++);t?(e.push(65536+(t-55296<<10)+(n-56320)),t=0):55296<=n&&n<=56319?t=n:e.push(n)}return e.map(n=>n.toString(16)).join("-")}function KS(r,e="mutant"){return`https://static.revolt.chat/emoji/${e}/${JS(r)}.svg?rev=3`}const Qh={100:"💯",1234:"🔢",grinning:"😀",smiley:"😃",smile:"😄",grin:"😁",laughing:"😆",satisfied:"😆",sweat_smile:"😅",rofl:"🤣",joy:"😂",slightly_smiling_face:"🙂",upside_down_face:"🙃",wink:"😉",blush:"😊",innocent:"😇",smiling_face_with_three_hearts:"🥰",heart_eyes:"😍",star_struck:"🤩",kissing_heart:"😘",kissing:"😗",relaxed:"☺️",kissing_closed_eyes:"😚",kissing_smiling_eyes:"😙",smiling_face_with_tear:"🥲",yum:"😋",stuck_out_tongue:"😛",stuck_out_tongue_winking_eye:"😜",zany_face:"🤪",stuck_out_tongue_closed_eyes:"😝",money_mouth_face:"🤑",hugs:"🤗",hand_over_mouth:"🤭",shushing_face:"🤫",thinking:"🤔",zipper_mouth_face:"🤐",raised_eyebrow:"🤨",neutral_face:"😐",expressionless:"😑",no_mouth:"😶",smirk:"😏",unamused:"😒",roll_eyes:"🙄",grimacing:"😬",lying_face:"🤥",relieved:"😌",pensive:"😔",sleepy:"😪",drooling_face:"🤤",sleeping:"😴",mask:"😷",face_with_thermometer:"🤒",face_with_head_bandage:"🤕",nauseated_face:"🤢",vomiting_face:"🤮",sneezing_face:"🤧",hot_face:"🥵",cold_face:"🥶",woozy_face:"🥴",dizzy_face:"😵",exploding_head:"🤯",cowboy_hat_face:"🤠",partying_face:"🥳",disguised_face:"🥸",sunglasses:"😎",nerd_face:"🤓",monocle_face:"🧐",confused:"😕",worried:"😟",slightly_frowning_face:"🙁",frowning_face:"☹️",open_mouth:"😮",hushed:"😯",astonished:"😲",flushed:"😳",pleading_face:"🥺",frowning:"😦",anguished:"😧",fearful:"😨",cold_sweat:"😰",disappointed_relieved:"😥",cry:"😢",sob:"😭",scream:"😱",confounded:"😖",persevere:"😣",disappointed:"😞",sweat:"😓",weary:"😩",tired_face:"😫",yawning_face:"🥱",triumph:"😤",rage:"😡",pout:"😡",angry:"😠",cursing_face:"🤬",smiling_imp:"😈",imp:"👿",skull:"💀",skull_and_crossbones:"☠️",hankey:"💩",poop:"💩",shit:"💩",clown_face:"🤡",japanese_ogre:"👹",japanese_goblin:"👺",ghost:"👻",alien:"👽",space_invader:"👾",robot:"🤖",smiley_cat:"😺",smile_cat:"😸",joy_cat:"😹",heart_eyes_cat:"😻",smirk_cat:"😼",kissing_cat:"😽",scream_cat:"🙀",crying_cat_face:"😿",pouting_cat:"😾",see_no_evil:"🙈",hear_no_evil:"🙉",speak_no_evil:"🙊",kiss:"💋",love_letter:"💌",cupid:"💘",gift_heart:"💝",sparkling_heart:"💖",heartpulse:"💗",heartbeat:"💓",revolving_hearts:"💞",two_hearts:"💕",heart_decoration:"💟",heavy_heart_exclamation:"❣️",broken_heart:"💔",heart:"❤️",orange_heart:"🧡",yellow_heart:"💛",green_heart:"💚",blue_heart:"💙",purple_heart:"💜",brown_heart:"🤎",black_heart:"🖤",white_heart:"🤍",anger:"💢",boom:"💥",collision:"💥",dizzy:"💫",sweat_drops:"💦",dash:"💨",hole:"🕳️",bomb:"💣",speech_balloon:"💬",left_speech_bubble:"🗨️",right_anger_bubble:"🗯️",thought_balloon:"💭",zzz:"💤",wave:"👋",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐️",hand:"✋",raised_hand:"✋",vulcan_salute:"🖖",ok_hand:"👌",pinched_fingers:"🤌",pinching_hand:"🤏",v:"✌️",crossed_fingers:"🤞",love_you_gesture:"🤟",metal:"🤘",call_me_hand:"🤙",point_left:"👈",point_right:"👉",point_up_2:"👆",middle_finger:"🖕",fu:"🖕",point_down:"👇",point_up:"☝️","+1":"👍",thumbsup:"👍","-1":"👎",thumbsdown:"👎",fist_raised:"✊",fist:"✊",fist_oncoming:"👊",facepunch:"👊",punch:"👊",fist_left:"🤛",fist_right:"🤜",clap:"👏",raised_hands:"🙌",open_hands:"👐",palms_up_together:"🤲",handshake:"🤝",pray:"🙏",writing_hand:"✍️",nail_care:"💅",selfie:"🤳",muscle:"💪",mechanical_arm:"🦾",mechanical_leg:"🦿",leg:"🦵",foot:"🦶",ear:"👂",ear_with_hearing_aid:"🦻",nose:"👃",brain:"🧠",anatomical_heart:"🫀",lungs:"🫁",tooth:"🦷",bone:"🦴",eyes:"👀",eye:"👁️",tongue:"👅",lips:"👄",baby:"👶",child:"🧒",boy:"👦",girl:"👧",adult:"🧑",blond_haired_person:"👱",man:"👨",bearded_person:"🧔",red_haired_man:"👨‍🦰",curly_haired_man:"👨‍🦱",white_haired_man:"👨‍🦳",bald_man:"👨‍🦲",woman:"👩",red_haired_woman:"👩‍🦰",person_red_hair:"🧑‍🦰",curly_haired_woman:"👩‍🦱",person_curly_hair:"🧑‍🦱",white_haired_woman:"👩‍🦳",person_white_hair:"🧑‍🦳",bald_woman:"👩‍🦲",person_bald:"🧑‍🦲",blond_haired_woman:"👱‍♀️",blonde_woman:"👱‍♀️",blond_haired_man:"👱‍♂️",older_adult:"🧓",older_man:"👴",older_woman:"👵",frowning_person:"🙍",frowning_man:"🙍‍♂️",frowning_woman:"🙍‍♀️",pouting_face:"🙎",pouting_man:"🙎‍♂️",pouting_woman:"🙎‍♀️",no_good:"🙅",no_good_man:"🙅‍♂️",ng_man:"🙅‍♂️",no_good_woman:"🙅‍♀️",ng_woman:"🙅‍♀️",ok_person:"🙆",ok_man:"🙆‍♂️",ok_woman:"🙆‍♀️",tipping_hand_person:"💁",information_desk_person:"💁",tipping_hand_man:"💁‍♂️",sassy_man:"💁‍♂️",tipping_hand_woman:"💁‍♀️",sassy_woman:"💁‍♀️",raising_hand:"🙋",raising_hand_man:"🙋‍♂️",raising_hand_woman:"🙋‍♀️",deaf_person:"🧏",deaf_man:"🧏‍♂️",deaf_woman:"🧏‍♀️",bow:"🙇",bowing_man:"🙇‍♂️",bowing_woman:"🙇‍♀️",facepalm:"🤦",man_facepalming:"🤦‍♂️",woman_facepalming:"🤦‍♀️",shrug:"🤷",man_shrugging:"🤷‍♂️",woman_shrugging:"🤷‍♀️",health_worker:"🧑‍⚕️",man_health_worker:"👨‍⚕️",woman_health_worker:"👩‍⚕️",student:"🧑‍🎓",man_student:"👨‍🎓",woman_student:"👩‍🎓",teacher:"🧑‍🏫",man_teacher:"👨‍🏫",woman_teacher:"👩‍🏫",judge:"🧑‍⚖️",man_judge:"👨‍⚖️",woman_judge:"👩‍⚖️",farmer:"🧑‍🌾",man_farmer:"👨‍🌾",woman_farmer:"👩‍🌾",cook:"🧑‍🍳",man_cook:"👨‍🍳",woman_cook:"👩‍🍳",mechanic:"🧑‍🔧",man_mechanic:"👨‍🔧",woman_mechanic:"👩‍🔧",factory_worker:"🧑‍🏭",man_factory_worker:"👨‍🏭",woman_factory_worker:"👩‍🏭",office_worker:"🧑‍💼",man_office_worker:"👨‍💼",woman_office_worker:"👩‍💼",scientist:"🧑‍🔬",man_scientist:"👨‍🔬",woman_scientist:"👩‍🔬",technologist:"🧑‍💻",man_technologist:"👨‍💻",woman_technologist:"👩‍💻",singer:"🧑‍🎤",man_singer:"👨‍🎤",woman_singer:"👩‍🎤",artist:"🧑‍🎨",man_artist:"👨‍🎨",woman_artist:"👩‍🎨",pilot:"🧑‍✈️",man_pilot:"👨‍✈️",woman_pilot:"👩‍✈️",astronaut:"🧑‍🚀",man_astronaut:"👨‍🚀",woman_astronaut:"👩‍🚀",firefighter:"🧑‍🚒",man_firefighter:"👨‍🚒",woman_firefighter:"👩‍🚒",police_officer:"👮",cop:"👮",policeman:"👮‍♂️",policewoman:"👮‍♀️",detective:"🕵️",male_detective:"🕵️‍♂️",female_detective:"🕵️‍♀️",guard:"💂",guardsman:"💂‍♂️",guardswoman:"💂‍♀️",ninja:"🥷",construction_worker:"👷",construction_worker_man:"👷‍♂️",construction_worker_woman:"👷‍♀️",prince:"🤴",princess:"👸",person_with_turban:"👳",man_with_turban:"👳‍♂️",woman_with_turban:"👳‍♀️",man_with_gua_pi_mao:"👲",woman_with_headscarf:"🧕",person_in_tuxedo:"🤵",man_in_tuxedo:"🤵‍♂️",woman_in_tuxedo:"🤵‍♀️",person_with_veil:"👰",man_with_veil:"👰‍♂️",woman_with_veil:"👰‍♀️",bride_with_veil:"👰‍♀️",pregnant_woman:"🤰",breast_feeding:"🤱",woman_feeding_baby:"👩‍🍼",man_feeding_baby:"👨‍🍼",person_feeding_baby:"🧑‍🍼",angel:"👼",santa:"🎅",mrs_claus:"🤶",mx_claus:"🧑‍🎄",superhero:"🦸",superhero_man:"🦸‍♂️",superhero_woman:"🦸‍♀️",supervillain:"🦹",supervillain_man:"🦹‍♂️",supervillain_woman:"🦹‍♀️",mage:"🧙",mage_man:"🧙‍♂️",mage_woman:"🧙‍♀️",fairy:"🧚",fairy_man:"🧚‍♂️",fairy_woman:"🧚‍♀️",vampire:"🧛",vampire_man:"🧛‍♂️",vampire_woman:"🧛‍♀️",merperson:"🧜",merman:"🧜‍♂️",mermaid:"🧜‍♀️",elf:"🧝",elf_man:"🧝‍♂️",elf_woman:"🧝‍♀️",genie:"🧞",genie_man:"🧞‍♂️",genie_woman:"🧞‍♀️",zombie:"🧟",zombie_man:"🧟‍♂️",zombie_woman:"🧟‍♀️",massage:"💆",massage_man:"💆‍♂️",massage_woman:"💆‍♀️",haircut:"💇",haircut_man:"💇‍♂️",haircut_woman:"💇‍♀️",walking:"🚶",walking_man:"🚶‍♂️",walking_woman:"🚶‍♀️",standing_person:"🧍",standing_man:"🧍‍♂️",standing_woman:"🧍‍♀️",kneeling_person:"🧎",kneeling_man:"🧎‍♂️",kneeling_woman:"🧎‍♀️",person_with_probing_cane:"🧑‍🦯",man_with_probing_cane:"👨‍🦯",woman_with_probing_cane:"👩‍🦯",person_in_motorized_wheelchair:"🧑‍🦼",man_in_motorized_wheelchair:"👨‍🦼",woman_in_motorized_wheelchair:"👩‍🦼",person_in_manual_wheelchair:"🧑‍🦽",man_in_manual_wheelchair:"👨‍🦽",woman_in_manual_wheelchair:"👩‍🦽",runner:"🏃",running:"🏃",running_man:"🏃‍♂️",running_woman:"🏃‍♀️",woman_dancing:"💃",dancer:"💃",man_dancing:"🕺",business_suit_levitating:"🕴️",dancers:"👯",dancing_men:"👯‍♂️",dancing_women:"👯‍♀️",sauna_person:"🧖",sauna_man:"🧖‍♂️",sauna_woman:"🧖‍♀️",climbing:"🧗",climbing_man:"🧗‍♂️",climbing_woman:"🧗‍♀️",person_fencing:"🤺",horse_racing:"🏇",skier:"⛷️",snowboarder:"🏂",golfing:"🏌️",golfing_man:"🏌️‍♂️",golfing_woman:"🏌️‍♀️",surfer:"🏄",surfing_man:"🏄‍♂️",surfing_woman:"🏄‍♀️",rowboat:"🚣",rowing_man:"🚣‍♂️",rowing_woman:"🚣‍♀️",swimmer:"🏊",swimming_man:"🏊‍♂️",swimming_woman:"🏊‍♀️",bouncing_ball_person:"⛹️",bouncing_ball_man:"⛹️‍♂️",basketball_man:"⛹️‍♂️",bouncing_ball_woman:"⛹️‍♀️",basketball_woman:"⛹️‍♀️",weight_lifting:"🏋️",weight_lifting_man:"🏋️‍♂️",weight_lifting_woman:"🏋️‍♀️",bicyclist:"🚴",biking_man:"🚴‍♂️",biking_woman:"🚴‍♀️",mountain_bicyclist:"🚵",mountain_biking_man:"🚵‍♂️",mountain_biking_woman:"🚵‍♀️",cartwheeling:"🤸",man_cartwheeling:"🤸‍♂️",woman_cartwheeling:"🤸‍♀️",wrestling:"🤼",men_wrestling:"🤼‍♂️",women_wrestling:"🤼‍♀️",water_polo:"🤽",man_playing_water_polo:"🤽‍♂️",woman_playing_water_polo:"🤽‍♀️",handball_person:"🤾",man_playing_handball:"🤾‍♂️",woman_playing_handball:"🤾‍♀️",juggling_person:"🤹",man_juggling:"🤹‍♂️",woman_juggling:"🤹‍♀️",lotus_position:"🧘",lotus_position_man:"🧘‍♂️",lotus_position_woman:"🧘‍♀️",bath:"🛀",sleeping_bed:"🛌",people_holding_hands:"🧑‍🤝‍🧑",two_women_holding_hands:"👭",couple:"👫",two_men_holding_hands:"👬",couplekiss:"💏",couplekiss_man_woman:"👩‍❤️‍💋‍👨",couplekiss_man_man:"👨‍❤️‍💋‍👨",couplekiss_woman_woman:"👩‍❤️‍💋‍👩",couple_with_heart:"💑",couple_with_heart_woman_man:"👩‍❤️‍👨",couple_with_heart_man_man:"👨‍❤️‍👨",couple_with_heart_woman_woman:"👩‍❤️‍👩",family:"👪",family_man_woman_boy:"👨‍👩‍👦",family_man_woman_girl:"👨‍👩‍👧",family_man_woman_girl_boy:"👨‍👩‍👧‍👦",family_man_woman_boy_boy:"👨‍👩‍👦‍👦",family_man_woman_girl_girl:"👨‍👩‍👧‍👧",family_man_man_boy:"👨‍👨‍👦",family_man_man_girl:"👨‍👨‍👧",family_man_man_girl_boy:"👨‍👨‍👧‍👦",family_man_man_boy_boy:"👨‍👨‍👦‍👦",family_man_man_girl_girl:"👨‍👨‍👧‍👧",family_woman_woman_boy:"👩‍👩‍👦",family_woman_woman_girl:"👩‍👩‍👧",family_woman_woman_girl_boy:"👩‍👩‍👧‍👦",family_woman_woman_boy_boy:"👩‍👩‍👦‍👦",family_woman_woman_girl_girl:"👩‍👩‍👧‍👧",family_man_boy:"👨‍👦",family_man_boy_boy:"👨‍👦‍👦",family_man_girl:"👨‍👧",family_man_girl_boy:"👨‍👧‍👦",family_man_girl_girl:"👨‍👧‍👧",family_woman_boy:"👩‍👦",family_woman_boy_boy:"👩‍👦‍👦",family_woman_girl:"👩‍👧",family_woman_girl_boy:"👩‍👧‍👦",family_woman_girl_girl:"👩‍👧‍👧",speaking_head:"🗣️",bust_in_silhouette:"👤",busts_in_silhouette:"👥",people_hugging:"🫂",footprints:"👣",monkey_face:"🐵",monkey:"🐒",gorilla:"🦍",orangutan:"🦧",dog:"🐶",dog2:"🐕",guide_dog:"🦮",service_dog:"🐕‍🦺",poodle:"🐩",wolf:"🐺",fox_face:"🦊",raccoon:"🦝",cat:"🐱",cat2:"🐈",black_cat:"🐈‍⬛",lion:"🦁",tiger:"🐯",tiger2:"🐅",leopard:"🐆",horse:"🐴",racehorse:"🐎",unicorn:"🦄",zebra:"🦓",deer:"🦌",bison:"🦬",cow:"🐮",ox:"🐂",water_buffalo:"🐃",cow2:"🐄",pig:"🐷",pig2:"🐖",boar:"🐗",pig_nose:"🐽",ram:"🐏",sheep:"🐑",goat:"🐐",dromedary_camel:"🐪",camel:"🐫",llama:"🦙",giraffe:"🦒",elephant:"🐘",mammoth:"🦣",rhinoceros:"🦏",hippopotamus:"🦛",mouse:"🐭",mouse2:"🐁",rat:"🐀",hamster:"🐹",rabbit:"🐰",rabbit2:"🐇",chipmunk:"🐿️",beaver:"🦫",hedgehog:"🦔",bat:"🦇",bear:"🐻",polar_bear:"🐻‍❄️",koala:"🐨",panda_face:"🐼",sloth:"🦥",otter:"🦦",skunk:"🦨",kangaroo:"🦘",badger:"🦡",feet:"🐾",paw_prints:"🐾",turkey:"🦃",chicken:"🐔",rooster:"🐓",hatching_chick:"🐣",baby_chick:"🐤",hatched_chick:"🐥",bird:"🐦",penguin:"🐧",dove:"🕊️",eagle:"🦅",duck:"🦆",swan:"🦢",owl:"🦉",dodo:"🦤",feather:"🪶",flamingo:"🦩",peacock:"🦚",parrot:"🦜",frog:"🐸",crocodile:"🐊",turtle:"🐢",lizard:"🦎",snake:"🐍",dragon_face:"🐲",dragon:"🐉",sauropod:"🦕","t-rex":"🦖",whale:"🐳",whale2:"🐋",dolphin:"🐬",flipper:"🐬",seal:"🦭",fish:"🐟",tropical_fish:"🐠",blowfish:"🐡",shark:"🦈",octopus:"🐙",shell:"🐚",snail:"🐌",butterfly:"🦋",bug:"🐛",ant:"🐜",bee:"🐝",honeybee:"🐝",beetle:"🪲",lady_beetle:"🐞",cricket:"🦗",cockroach:"🪳",spider:"🕷️",spider_web:"🕸️",scorpion:"🦂",mosquito:"🦟",fly:"🪰",worm:"🪱",microbe:"🦠",bouquet:"💐",cherry_blossom:"🌸",white_flower:"💮",rosette:"🏵️",rose:"🌹",wilted_flower:"🥀",hibiscus:"🌺",sunflower:"🌻",blossom:"🌼",tulip:"🌷",seedling:"🌱",potted_plant:"🪴",evergreen_tree:"🌲",deciduous_tree:"🌳",palm_tree:"🌴",cactus:"🌵",ear_of_rice:"🌾",herb:"🌿",shamrock:"☘️",four_leaf_clover:"🍀",maple_leaf:"🍁",fallen_leaf:"🍂",leaves:"🍃",grapes:"🍇",melon:"🍈",watermelon:"🍉",tangerine:"🍊",orange:"🍊",mandarin:"🍊",lemon:"🍋",banana:"🍌",nanner:"🍌",pineapple:"🍍",mango:"🥭",apple:"🍎",green_apple:"🍏",pear:"🍐",peach:"🍑",cherries:"🍒",strawberry:"🍓",blueberries:"🫐",kiwi_fruit:"🥝",tomato:"🍅",olive:"🫒",coconut:"🥥",avocado:"🥑",eggplant:"🍆",potato:"🥔",carrot:"🥕",corn:"🌽",hot_pepper:"🌶️",bell_pepper:"🫑",cucumber:"🥒",leafy_green:"🥬",broccoli:"🥦",garlic:"🧄",onion:"🧅",mushroom:"🍄",peanuts:"🥜",chestnut:"🌰",bread:"🍞",croissant:"🥐",baguette_bread:"🥖",flatbread:"🫓",pretzel:"🥨",bagel:"🥯",pancakes:"🥞",waffle:"🧇",cheese:"🧀",meat_on_bone:"🍖",poultry_leg:"🍗",cut_of_meat:"🥩",bacon:"🥓",hamburger:"🍔",fries:"🍟",pizza:"🍕",hotdog:"🌭",sandwich:"🥪",taco:"🌮",burrito:"🌯",tamale:"🫔",stuffed_flatbread:"🥙",falafel:"🧆",egg:"🥚",fried_egg:"🍳",shallow_pan_of_food:"🥘",stew:"🍲",fondue:"🫕",bowl_with_spoon:"🥣",green_salad:"🥗",popcorn:"🍿",butter:"🧈",salt:"🧂",canned_food:"🥫",bento:"🍱",rice_cracker:"🍘",rice_ball:"🍙",rice:"🍚",curry:"🍛",ramen:"🍜",spaghetti:"🍝",sweet_potato:"🍠",oden:"🍢",sushi:"🍣",fried_shrimp:"🍤",fish_cake:"🍥",moon_cake:"🥮",dango:"🍡",dumpling:"🥟",fortune_cookie:"🥠",takeout_box:"🥡",crab:"🦀",lobster:"🦞",shrimp:"🦐",squid:"🦑",oyster:"🦪",icecream:"🍦",shaved_ice:"🍧",ice_cream:"🍨",doughnut:"🍩",cookie:"🍪",birthday:"🎂",cake:"🍰",cupcake:"🧁",pie:"🥧",chocolate_bar:"🍫",candy:"🍬",lollipop:"🍭",custard:"🍮",honey_pot:"🍯",baby_bottle:"🍼",milk_glass:"🥛",coffee:"☕",teapot:"🫖",tea:"🍵",sake:"🍶",champagne:"🍾",wine_glass:"🍷",cocktail:"🍸",tropical_drink:"🍹",beer:"🍺",beers:"🍻",clinking_glasses:"🥂",tumbler_glass:"🥃",cup_with_straw:"🥤",bubble_tea:"🧋",beverage_box:"🧃",mate:"🧉",ice_cube:"🧊",chopsticks:"🥢",plate_with_cutlery:"🍽️",fork_and_knife:"🍴",spoon:"🥄",hocho:"🔪",knife:"🔪",amphora:"🏺",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",globe_with_meridians:"🌐",world_map:"🗺️",japan:"🗾",compass:"🧭",mountain_snow:"🏔️",mountain:"⛰️",volcano:"🌋",mount_fuji:"🗻",camping:"🏕️",beach_umbrella:"🏖️",desert:"🏜️",desert_island:"🏝️",national_park:"🏞️",stadium:"🏟️",classical_building:"🏛️",building_construction:"🏗️",bricks:"🧱",rock:"🪨",wood:"🪵",hut:"🛖",houses:"🏘️",derelict_house:"🏚️",house:"🏠",house_with_garden:"🏡",office:"🏢",post_office:"🏣",european_post_office:"🏤",hospital:"🏥",bank:"🏦",hotel:"🏨",love_hotel:"🏩",convenience_store:"🏪",school:"🏫",department_store:"🏬",factory:"🏭",japanese_castle:"🏯",european_castle:"🏰",wedding:"💒",tokyo_tower:"🗼",statue_of_liberty:"🗽",church:"⛪",mosque:"🕌",hindu_temple:"🛕",synagogue:"🕍",shinto_shrine:"⛩️",kaaba:"🕋",fountain:"⛲",tent:"⛺",foggy:"🌁",night_with_stars:"🌃",cityscape:"🏙️",sunrise_over_mountains:"🌄",sunrise:"🌅",city_sunset:"🌆",city_sunrise:"🌇",bridge_at_night:"🌉",hotsprings:"♨️",carousel_horse:"🎠",ferris_wheel:"🎡",roller_coaster:"🎢",barber:"💈",circus_tent:"🎪",steam_locomotive:"🚂",railway_car:"🚃",bullettrain_side:"🚄",bullettrain_front:"🚅",train2:"🚆",metro:"🚇",light_rail:"🚈",station:"🚉",tram:"🚊",monorail:"🚝",mountain_railway:"🚞",train:"🚋",bus:"🚌",oncoming_bus:"🚍",trolley:"🚎",trolleybus:"🚎",minibus:"🚐",ambulance:"🚑",fire_engine:"🚒",police_car:"🚓",oncoming_police_car:"🚔",taxi:"🚕",oncoming_taxi:"🚖",car:"🚗",red_car:"🚗",oncoming_automobile:"🚘",blue_car:"🚙",pickup_truck:"🛻",truck:"🚚",articulated_lorry:"🚛",tractor:"🚜",racing_car:"🏎️",motorcycle:"🏍️",motor_scooter:"🛵",manual_wheelchair:"🦽",motorized_wheelchair:"🦼",auto_rickshaw:"🛺",bike:"🚲",kick_scooter:"🛴",skateboard:"🛹",roller_skate:"🛼",busstop:"🚏",motorway:"🛣️",railway_track:"🛤️",oil_drum:"🛢️",fuelpump:"⛽",rotating_light:"🚨",traffic_light:"🚥",vertical_traffic_light:"🚦",stop_sign:"🛑",construction:"🚧",anchor:"⚓",boat:"⛵",sailboat:"⛵",canoe:"🛶",speedboat:"🚤",passenger_ship:"🛳️",ferry:"⛴️",motor_boat:"🛥️",ship:"🚢",airplane:"✈️",small_airplane:"🛩️",flight_departure:"🛫",flight_arrival:"🛬",parachute:"🪂",seat:"💺",helicopter:"🚁",suspension_railway:"🚟",mountain_cableway:"🚠",aerial_tramway:"🚡",artificial_satellite:"🛰️",rocket:"🚀",flying_saucer:"🛸",bellhop_bell:"🛎️",luggage:"🧳",hourglass:"⌛",hourglass_flowing_sand:"⏳",watch:"⌚",alarm_clock:"⏰",stopwatch:"⏱️",timer_clock:"⏲️",mantelpiece_clock:"🕰️",clock12:"🕛",clock1230:"🕧",clock1:"🕐",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock630:"🕡",clock7:"🕖",clock730:"🕢",clock8:"🕗",clock830:"🕣",clock9:"🕘",clock930:"🕤",clock10:"🕙",clock1030:"🕥",clock11:"🕚",clock1130:"🕦",new_moon:"🌑",waxing_crescent_moon:"🌒",first_quarter_moon:"🌓",moon:"🌔",waxing_gibbous_moon:"🌔",full_moon:"🌕",waning_gibbous_moon:"🌖",last_quarter_moon:"🌗",waning_crescent_moon:"🌘",crescent_moon:"🌙",new_moon_with_face:"🌚",first_quarter_moon_with_face:"🌛",last_quarter_moon_with_face:"🌜",thermometer:"🌡️",sunny:"☀️",full_moon_with_face:"🌝",sun_with_face:"🌞",ringed_planet:"🪐",star:"⭐",star2:"🌟",stars:"🌠",milky_way:"🌌",cloud:"☁️",partly_sunny:"⛅",cloud_with_lightning_and_rain:"⛈️",sun_behind_small_cloud:"🌤️",sun_behind_large_cloud:"🌥️",sun_behind_rain_cloud:"🌦️",cloud_with_rain:"🌧️",cloud_with_snow:"🌨️",cloud_with_lightning:"🌩️",tornado:"🌪️",fog:"🌫️",wind_face:"🌬️",cyclone:"🌀",rainbow:"🌈",closed_umbrella:"🌂",open_umbrella:"☂️",umbrella:"☔",parasol_on_ground:"⛱️",zap:"⚡",snowflake:"❄️",snowman_with_snow:"☃️",snowman:"⛄",comet:"☄️",fire:"🔥",droplet:"💧",ocean:"🌊",jack_o_lantern:"🎃",christmas_tree:"🎄",fireworks:"🎆",sparkler:"🎇",firecracker:"🧨",sparkles:"✨",balloon:"🎈",tada:"🎉",confetti_ball:"🎊",tanabata_tree:"🎋",bamboo:"🎍",dolls:"🎎",flags:"🎏",wind_chime:"🎐",rice_scene:"🎑",red_envelope:"🧧",ribbon:"🎀",gift:"🎁",reminder_ribbon:"🎗️",tickets:"🎟️",ticket:"🎫",medal_military:"🎖️",trophy:"🏆",medal_sports:"🏅","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉",soccer:"⚽",baseball:"⚾",softball:"🥎",basketball:"🏀",volleyball:"🏐",football:"🏈",rugby_football:"🏉",tennis:"🎾",flying_disc:"🥏",bowling:"🎳",cricket_game:"🏏",field_hockey:"🏑",ice_hockey:"🏒",lacrosse:"🥍",ping_pong:"🏓",badminton:"🏸",boxing_glove:"🥊",martial_arts_uniform:"🥋",goal_net:"🥅",golf:"⛳",ice_skate:"⛸️",fishing_pole_and_fish:"🎣",diving_mask:"🤿",running_shirt_with_sash:"🎽",ski:"🎿",sled:"🛷",curling_stone:"🥌",dart:"🎯",yo_yo:"🪀",kite:"🪁","8ball":"🎱",crystal_ball:"🔮",magic_wand:"🪄",nazar_amulet:"🧿",video_game:"🎮",joystick:"🕹️",slot_machine:"🎰",game_die:"🎲",jigsaw:"🧩",teddy_bear:"🧸",pinata:"🪅",nesting_dolls:"🪆",spades:"♠️",hearts:"♥️",diamonds:"♦️",clubs:"♣️",chess_pawn:"♟️",black_joker:"🃏",mahjong:"🀄",flower_playing_cards:"🎴",performing_arts:"🎭",framed_picture:"🖼️",art:"🎨",thread:"🧵",sewing_needle:"🪡",yarn:"🧶",knot:"🪢",eyeglasses:"👓",dark_sunglasses:"🕶️",goggles:"🥽",lab_coat:"🥼",safety_vest:"🦺",necktie:"👔",shirt:"👕",tshirt:"👕",jeans:"👖",scarf:"🧣",gloves:"🧤",coat:"🧥",socks:"🧦",dress:"👗",kimono:"👘",sari:"🥻",one_piece_swimsuit:"🩱",swim_brief:"🩲",shorts:"🩳",bikini:"👙",womans_clothes:"👚",purse:"👛",handbag:"👜",pouch:"👝",shopping:"🛍️",school_satchel:"🎒",thong_sandal:"🩴",mans_shoe:"👞",shoe:"👞",athletic_shoe:"👟",hiking_boot:"🥾",flat_shoe:"🥿",high_heel:"👠",sandal:"👡",ballet_shoes:"🩰",boot:"👢",crown:"👑",womans_hat:"👒",tophat:"🎩",mortar_board:"🎓",billed_cap:"🧢",military_helmet:"🪖",rescue_worker_helmet:"⛑️",prayer_beads:"📿",lipstick:"💄",ring:"💍",gem:"💎",mute:"🔇",speaker:"🔈",sound:"🔉",loud_sound:"🔊",loudspeaker:"📢",mega:"📣",postal_horn:"📯",bell:"🔔",no_bell:"🔕",musical_score:"🎼",musical_note:"🎵",notes:"🎶",studio_microphone:"🎙️",level_slider:"🎚️",control_knobs:"🎛️",microphone:"🎤",headphones:"🎧",radio:"📻",saxophone:"🎷",accordion:"🪗",guitar:"🎸",musical_keyboard:"🎹",trumpet:"🎺",violin:"🎻",banjo:"🪕",drum:"🥁",long_drum:"🪘",iphone:"📱",calling:"📲",phone:"☎️",telephone:"☎️",telephone_receiver:"📞",pager:"📟",fax:"📠",battery:"🔋",electric_plug:"🔌",computer:"💻",desktop_computer:"🖥️",printer:"🖨️",keyboard:"⌨️",computer_mouse:"🖱️",trackball:"🖲️",minidisc:"💽",floppy_disk:"💾",cd:"💿",dvd:"📀",abacus:"🧮",movie_camera:"🎥",film_strip:"🎞️",film_projector:"📽️",clapper:"🎬",tv:"📺",camera:"📷",camera_flash:"📸",video_camera:"📹",vhs:"📼",mag:"🔍",mag_right:"🔎",candle:"🕯️",bulb:"💡",flashlight:"🔦",izakaya_lantern:"🏮",lantern:"🏮",diya_lamp:"🪔",notebook_with_decorative_cover:"📔",closed_book:"📕",book:"📖",open_book:"📖",green_book:"📗",blue_book:"📘",orange_book:"📙",books:"📚",notebook:"📓",ledger:"📒",page_with_curl:"📃",scroll:"📜",page_facing_up:"📄",newspaper:"📰",newspaper_roll:"🗞️",bookmark_tabs:"📑",bookmark:"🔖",label:"🏷️",moneybag:"💰",coin:"🪙",yen:"💴",dollar:"💵",euro:"💶",pound:"💷",money_with_wings:"💸",credit_card:"💳",receipt:"🧾",chart:"💹",envelope:"✉️",email:"📧","e-mail":"📧",incoming_envelope:"📨",envelope_with_arrow:"📩",outbox_tray:"📤",inbox_tray:"📥",package:"📦",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",postbox:"📮",ballot_box:"🗳️",pencil2:"✏️",black_nib:"✒️",fountain_pen:"🖋️",pen:"🖊️",paintbrush:"🖌️",crayon:"🖍️",memo:"📝",pencil:"📝",briefcase:"💼",file_folder:"📁",open_file_folder:"📂",card_index_dividers:"🗂️",date:"📅",calendar:"📆",spiral_notepad:"🗒️",spiral_calendar:"🗓️",card_index:"📇",chart_with_upwards_trend:"📈",chart_with_downwards_trend:"📉",bar_chart:"📊",clipboard:"📋",pushpin:"📌",round_pushpin:"📍",paperclip:"📎",paperclips:"🖇️",straight_ruler:"📏",triangular_ruler:"📐",scissors:"✂️",card_file_box:"🗃️",file_cabinet:"🗄️",wastebasket:"🗑️",lock:"🔒",unlock:"🔓",lock_with_ink_pen:"🔏",closed_lock_with_key:"🔐",key:"🔑",old_key:"🗝️",hammer:"🔨",axe:"🪓",pick:"⛏️",hammer_and_pick:"⚒️",hammer_and_wrench:"🛠️",dagger:"🗡️",crossed_swords:"⚔️",gun:"🔫",boomerang:"🪃",bow_and_arrow:"🏹",shield:"🛡️",carpentry_saw:"🪚",wrench:"🔧",screwdriver:"🪛",nut_and_bolt:"🔩",gear:"⚙️",clamp:"🗜️",balance_scale:"⚖️",probing_cane:"🦯",link:"🔗",chains:"⛓️",hook:"🪝",toolbox:"🧰",magnet:"🧲",ladder:"🪜",alembic:"⚗️",test_tube:"🧪",petri_dish:"🧫",dna:"🧬",microscope:"🔬",telescope:"🔭",satellite:"📡",syringe:"💉",drop_of_blood:"🩸",pill:"💊",adhesive_bandage:"🩹",stethoscope:"🩺",door:"🚪",elevator:"🛗",mirror:"🪞",window:"🪟",bed:"🛏️",couch_and_lamp:"🛋️",chair:"🪑",toilet:"🚽",plunger:"🪠",shower:"🚿",bathtub:"🛁",mouse_trap:"🪤",razor:"🪒",lotion_bottle:"🧴",safety_pin:"🧷",broom:"🧹",basket:"🧺",roll_of_paper:"🧻",bucket:"🪣",soap:"🧼",toothbrush:"🪥",sponge:"🧽",fire_extinguisher:"🧯",shopping_cart:"🛒",smoking:"🚬",coffin:"⚰️",headstone:"🪦",funeral_urn:"⚱️",moyai:"🗿",placard:"🪧",atm:"🏧",put_litter_in_its_place:"🚮",potable_water:"🚰",wheelchair:"♿",mens:"🚹",womens:"🚺",restroom:"🚻",baby_symbol:"🚼",wc:"🚾",passport_control:"🛂",customs:"🛃",baggage_claim:"🛄",left_luggage:"🛅",warning:"⚠️",children_crossing:"🚸",no_entry:"⛔",no_entry_sign:"🚫",no_bicycles:"🚳",no_smoking:"🚭",do_not_litter:"🚯","non-potable_water":"🚱",no_pedestrians:"🚷",no_mobile_phones:"📵",underage:"🔞",radioactive:"☢️",biohazard:"☣️",arrow_up:"⬆️",arrow_upper_right:"↗️",arrow_right:"➡️",arrow_lower_right:"↘️",arrow_down:"⬇️",arrow_lower_left:"↙️",arrow_left:"⬅️",arrow_upper_left:"↖️",arrow_up_down:"↕️",left_right_arrow:"↔️",leftwards_arrow_with_hook:"↩️",arrow_right_hook:"↪️",arrow_heading_up:"⤴️",arrow_heading_down:"⤵️",arrows_clockwise:"🔃",arrows_counterclockwise:"🔄",back:"🔙",end:"🔚",on:"🔛",soon:"🔜",top:"🔝",place_of_worship:"🛐",atom_symbol:"⚛️",om:"🕉️",star_of_david:"✡️",wheel_of_dharma:"☸️",yin_yang:"☯️",latin_cross:"✝️",orthodox_cross:"☦️",star_and_crescent:"☪️",peace_symbol:"☮️",menorah:"🕎",six_pointed_star:"🔯",aries:"♈",taurus:"♉",gemini:"♊",cancer:"♋",leo:"♌",virgo:"♍",libra:"♎",scorpius:"♏",sagittarius:"♐",capricorn:"♑",aquarius:"♒",pisces:"♓",ophiuchus:"⛎",twisted_rightwards_arrows:"🔀",repeat:"🔁",repeat_one:"🔂",arrow_forward:"▶️",fast_forward:"⏩",next_track_button:"⏭️",play_or_pause_button:"⏯️",arrow_backward:"◀️",rewind:"⏪",previous_track_button:"⏮️",arrow_up_small:"🔼",arrow_double_up:"⏫",arrow_down_small:"🔽",arrow_double_down:"⏬",pause_button:"⏸️",stop_button:"⏹️",record_button:"⏺️",eject_button:"⏏️",cinema:"🎦",low_brightness:"🔅",high_brightness:"🔆",signal_strength:"📶",vibration_mode:"📳",mobile_phone_off:"📴",female_sign:"♀️",male_sign:"♂️",transgender_symbol:"⚧️",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",heavy_minus_sign:"➖",heavy_division_sign:"➗",infinity:"♾️",bangbang:"‼️",interrobang:"⁉️",question:"❓",grey_question:"❔",grey_exclamation:"❕",exclamation:"❗",heavy_exclamation_mark:"❗",wavy_dash:"〰️",currency_exchange:"💱",heavy_dollar_sign:"💲",medical_symbol:"⚕️",recycle:"♻️",fleur_de_lis:"⚜️",trident:"🔱",name_badge:"📛",beginner:"🔰",o:"⭕",white_check_mark:"✅",ballot_box_with_check:"☑️",heavy_check_mark:"✔️",x:"❌",negative_squared_cross_mark:"❎",curly_loop:"➰",loop:"➿",part_alternation_mark:"〽️",eight_spoked_asterisk:"✳️",eight_pointed_black_star:"✴️",sparkle:"❇️",copyright:"©️",registered:"®️",tm:"™️",hash:"#️⃣",asterisk:"*️⃣",zero:"0️⃣",one:"1️⃣",two:"2️⃣",three:"3️⃣",four:"4️⃣",five:"5️⃣",six:"6️⃣",seven:"7️⃣",eight:"8️⃣",nine:"9️⃣",keycap_ten:"🔟",capital_abcd:"🔠",abcd:"🔡",symbols:"🔣",abc:"🔤",a:"🅰️",ab:"🆎",b:"🅱️",cl:"🆑",cool:"🆒",free:"🆓",information_source:"ℹ️",id:"🆔",m:"Ⓜ️",new:"🆕",ng:"🆖",o2:"🅾️",ok:"🆗",parking:"🅿️",sos:"🆘",up:"🆙",vs:"🆚",koko:"🈁",sa:"🈂️",u6708:"🈷️",u6709:"🈶",u6307:"🈯",ideograph_advantage:"🉐",u5272:"🈹",u7121:"🈚",u7981:"🈲",accept:"🉑",u7533:"🈸",u5408:"🈴",u7a7a:"🈳",congratulations:"㊗️",secret:"㊙️",u55b6:"🈺",u6e80:"🈵",red_circle:"🔴",orange_circle:"🟠",yellow_circle:"🟡",green_circle:"🟢",large_blue_circle:"🔵",purple_circle:"🟣",brown_circle:"🟤",black_circle:"⚫",white_circle:"⚪",red_square:"🟥",orange_square:"🟧",yellow_square:"🟨",green_square:"🟩",blue_square:"🟦",purple_square:"🟪",brown_square:"🟫",black_large_square:"⬛",white_large_square:"⬜",black_medium_square:"◼️",white_medium_square:"◻️",black_medium_small_square:"◾",white_medium_small_square:"◽",black_small_square:"▪️",white_small_square:"▫️",large_orange_diamond:"🔶",large_blue_diamond:"🔷",small_orange_diamond:"🔸",small_blue_diamond:"🔹",small_red_triangle:"🔺",small_red_triangle_down:"🔻",diamond_shape_with_a_dot_inside:"💠",radio_button:"🔘",white_square_button:"🔳",black_square_button:"🔲",checkered_flag:"🏁",triangular_flag_on_post:"🚩",crossed_flags:"🎌",black_flag:"🏴",white_flag:"🏳️",rainbow_flag:"🏳️‍🌈",transgender_flag:"🏳️‍⚧️",pirate_flag:"🏴‍☠️",ascension_island:"🇦🇨",andorra:"🇦🇩",united_arab_emirates:"🇦🇪",afghanistan:"🇦🇫",antigua_barbuda:"🇦🇬",anguilla:"🇦🇮",albania:"🇦🇱",armenia:"🇦🇲",angola:"🇦🇴",antarctica:"🇦🇶",argentina:"🇦🇷",american_samoa:"🇦🇸",austria:"🇦🇹",australia:"🇦🇺",aruba:"🇦🇼",aland_islands:"🇦🇽",azerbaijan:"🇦🇿",bosnia_herzegovina:"🇧🇦",barbados:"🇧🇧",bangladesh:"🇧🇩",belgium:"🇧🇪",burkina_faso:"🇧🇫",bulgaria:"🇧🇬",bahrain:"🇧🇭",burundi:"🇧🇮",benin:"🇧🇯",st_barthelemy:"🇧🇱",bermuda:"🇧🇲",brunei:"🇧🇳",bolivia:"🇧🇴",caribbean_netherlands:"🇧🇶",brazil:"🇧🇷",bahamas:"🇧🇸",bhutan:"🇧🇹",bouvet_island:"🇧🇻",botswana:"🇧🇼",belarus:"🇧🇾",belize:"🇧🇿",canada:"🇨🇦",cocos_islands:"🇨🇨",congo_kinshasa:"🇨🇩",central_african_republic:"🇨🇫",congo_brazzaville:"🇨🇬",switzerland:"🇨🇭",cote_divoire:"🇨🇮",cook_islands:"🇨🇰",chile:"🇨🇱",cameroon:"🇨🇲",cn:"🇨🇳",colombia:"🇨🇴",clipperton_island:"🇨🇵",costa_rica:"🇨🇷",cuba:"🇨🇺",cape_verde:"🇨🇻",curacao:"🇨🇼",christmas_island:"🇨🇽",cyprus:"🇨🇾",czech_republic:"🇨🇿",de:"🇩🇪",diego_garcia:"🇩🇬",djibouti:"🇩🇯",denmark:"🇩🇰",dominica:"🇩🇲",dominican_republic:"🇩🇴",algeria:"🇩🇿",ceuta_melilla:"🇪🇦",ecuador:"🇪🇨",estonia:"🇪🇪",egypt:"🇪🇬",western_sahara:"🇪🇭",eritrea:"🇪🇷",es:"🇪🇸",ethiopia:"🇪🇹",eu:"🇪🇺",european_union:"🇪🇺",finland:"🇫🇮",fiji:"🇫🇯",falkland_islands:"🇫🇰",micronesia:"🇫🇲",faroe_islands:"🇫🇴",fr:"🇫🇷",gabon:"🇬🇦",gb:"🇬🇧",uk:"🇬🇧",grenada:"🇬🇩",georgia:"🇬🇪",french_guiana:"🇬🇫",guernsey:"🇬🇬",ghana:"🇬🇭",gibraltar:"🇬🇮",greenland:"🇬🇱",gambia:"🇬🇲",guinea:"🇬🇳",guadeloupe:"🇬🇵",equatorial_guinea:"🇬🇶",greece:"🇬🇷",south_georgia_south_sandwich_islands:"🇬🇸",guatemala:"🇬🇹",guam:"🇬🇺",guinea_bissau:"🇬🇼",guyana:"🇬🇾",hong_kong:"🇭🇰",heard_mcdonald_islands:"🇭🇲",honduras:"🇭🇳",croatia:"🇭🇷",haiti:"🇭🇹",hungary:"🇭🇺",canary_islands:"🇮🇨",indonesia:"🇮🇩",ireland:"🇮🇪",israel:"🇮🇱",isle_of_man:"🇮🇲",india:"🇮🇳",british_indian_ocean_territory:"🇮🇴",iraq:"🇮🇶",iran:"🇮🇷",iceland:"🇮🇸",it:"🇮🇹",jersey:"🇯🇪",jamaica:"🇯🇲",jordan:"🇯🇴",jp:"🇯🇵",kenya:"🇰🇪",kyrgyzstan:"🇰🇬",cambodia:"🇰🇭",kiribati:"🇰🇮",comoros:"🇰🇲",st_kitts_nevis:"🇰🇳",north_korea:"🇰🇵",kr:"🇰🇷",kuwait:"🇰🇼",cayman_islands:"🇰🇾",kazakhstan:"🇰🇿",laos:"🇱🇦",lebanon:"🇱🇧",st_lucia:"🇱🇨",liechtenstein:"🇱🇮",sri_lanka:"🇱🇰",liberia:"🇱🇷",lesotho:"🇱🇸",lithuania:"🇱🇹",luxembourg:"🇱🇺",latvia:"🇱🇻",libya:"🇱🇾",morocco:"🇲🇦",monaco:"🇲🇨",moldova:"🇲🇩",montenegro:"🇲🇪",st_martin:"🇲🇫",madagascar:"🇲🇬",marshall_islands:"🇲🇭",macedonia:"🇲🇰",mali:"🇲🇱",myanmar:"🇲🇲",mongolia:"🇲🇳",macau:"🇲🇴",northern_mariana_islands:"🇲🇵",martinique:"🇲🇶",mauritania:"🇲🇷",montserrat:"🇲🇸",malta:"🇲🇹",mauritius:"🇲🇺",maldives:"🇲🇻",malawi:"🇲🇼",mexico:"🇲🇽",malaysia:"🇲🇾",mozambique:"🇲🇿",namibia:"🇳🇦",new_caledonia:"🇳🇨",niger:"🇳🇪",norfolk_island:"🇳🇫",nigeria:"🇳🇬",nicaragua:"🇳🇮",netherlands:"🇳🇱",norway:"🇳🇴",nepal:"🇳🇵",nauru:"🇳🇷",niue:"🇳🇺",new_zealand:"🇳🇿",oman:"🇴🇲",panama:"🇵🇦",peru:"🇵🇪",french_polynesia:"🇵🇫",papua_new_guinea:"🇵🇬",philippines:"🇵🇭",pakistan:"🇵🇰",poland:"🇵🇱",st_pierre_miquelon:"🇵🇲",pitcairn_islands:"🇵🇳",puerto_rico:"🇵🇷",palestinian_territories:"🇵🇸",portugal:"🇵🇹",palau:"🇵🇼",paraguay:"🇵🇾",qatar:"🇶🇦",reunion:"🇷🇪",romania:"🇷🇴",serbia:"🇷🇸",ru:"🇷🇺",rwanda:"🇷🇼",saudi_arabia:"🇸🇦",solomon_islands:"🇸🇧",seychelles:"🇸🇨",sudan:"🇸🇩",sweden:"🇸🇪",singapore:"🇸🇬",st_helena:"🇸🇭",slovenia:"🇸🇮",svalbard_jan_mayen:"🇸🇯",slovakia:"🇸🇰",sierra_leone:"🇸🇱",san_marino:"🇸🇲",senegal:"🇸🇳",somalia:"🇸🇴",suriname:"🇸🇷",south_sudan:"🇸🇸",sao_tome_principe:"🇸🇹",el_salvador:"🇸🇻",sint_maarten:"🇸🇽",syria:"🇸🇾",swaziland:"🇸🇿",tristan_da_cunha:"🇹🇦",turks_caicos_islands:"🇹🇨",chad:"🇹🇩",french_southern_territories:"🇹🇫",togo:"🇹🇬",thailand:"🇹🇭",tajikistan:"🇹🇯",tokelau:"🇹🇰",timor_leste:"🇹🇱",turkmenistan:"🇹🇲",tunisia:"🇹🇳",tonga:"🇹🇴",tr:"🇹🇷",trinidad_tobago:"🇹🇹",tuvalu:"🇹🇻",taiwan:"🇹🇼",tanzania:"🇹🇿",ukraine:"🇺🇦",uganda:"🇺🇬",us_outlying_islands:"🇺🇲",united_nations:"🇺🇳",us:"🇺🇸",uruguay:"🇺🇾",uzbekistan:"🇺🇿",vatican_city:"🇻🇦",st_vincent_grenadines:"🇻🇨",venezuela:"🇻🇪",british_virgin_islands:"🇻🇬",us_virgin_islands:"🇻🇮",vietnam:"🇻🇳",vanuatu:"🇻🇺",wallis_futuna:"🇼🇫",samoa:"🇼🇸",kosovo:"🇽🇰",yemen:"🇾🇪",mayotte:"🇾🇹",south_africa:"🇿🇦",zambia:"🇿🇲",zimbabwe:"🇿🇼",england:"🏴󠁧󠁢󠁥󠁮󠁧󠁿",scotland:"🏴󠁧󠁢󠁳󠁣󠁴󠁿",wales:"🏴󠁧󠁢󠁷󠁬󠁳󠁿"},YS=Object.keys(Qh).map(r=>new WS(String(r)));class QS extends Tt{constructor(e,t){super(e,t)}get name(){return this.source.name}get animated(){return!!this.source.animated}get nsfw(){return!!this.source.nsfw}get creatorID(){return this.source.creator_id}get creator(){return this.client.users.get(this.creatorID)}async fetchCreator(e=!1){return await this.client.users.fetch(this.creatorID,e)}get imageURL(){var e;return`${(e=this.client.config)==null?void 0:e.features.autumn.url}/emojis/${this.id}${this.animated?"":"?max_side=128"}`}get parentID(){return this.source.parent.type=="Server"?this.source.parent.id:""}get parent(){return this.parentID?this.client.servers.get(this.parentID)??null:null}get uniqueName(){const e=[...YS,...this.client.emojis.ordered],t=e.filter(s=>s.name==this.name).findIndex(s=>s.id==this.id);return t<=0?this.name:`${this.name}~${t+1}`}async delete(){await this.client.api.delete(`/custom/emoji/${this._id}`),this.client.emojis.delete(this.id)}toString(){return`:${this.id}:`}}class XS extends Qt{constructor(t){super();T(this,"client");T(this,"orderCache",[]);this.client=t,this.onUpdate(()=>this.orderCache=[])}get ordered(){return this.orderCache.length?this.orderCache:this.orderCache=this.sort((t,s)=>t.createdAt-s.createdAt)}get known(){return this.filter(t=>t.parentID&&this.client.servers.has(t.parentID))}construct(t){const s=this.get(t._id);if(s)return s.update(t);{const n=new QS(this.client,t);return this.set(n.id,n),n.onUpdate(()=>this.fireUpdate([n])),n}}async fetch(t,s=!1){return this.get(t)&&!s?this.get(t):this.construct(await this.client.api.get(`/custom/emoji/${t}`))}async create(t,s,n){return this.construct(await this.client.api.put(`/custom/emoji/${s}`,{name:n,parent:{type:"Server",id:t.id}}))}}class eR extends Qt{constructor(t){super();T(this,"client");this.client=t}construct(t){const s=this.get(t._id);if(s)return s.update(t);{const n=new Wh(this.client,t);return this.set(n.id,n),n.onUpdate(()=>this.fireUpdate([n])),n}}async fetch(t,s,n){if(this.has(t))return this.get(t).update(s);const i=s??await this.client.api.get(`/servers/${t}`);if(n)for(const a of n)await this.client.channels.fetch(a._id,a);else for(const a of i.channels)try{await this.client.channels.fetch(a)}catch{}return this.construct(i)}}var Be;(function(r){r[r.Developer=1]="Developer",r[r.Translator=2]="Translator",r[r.Supporter=4]="Supporter",r[r.ResponsibleDisclosure=8]="ResponsibleDisclosure",r[r.Founder=16]="Founder",r[r.PlatformModeration=32]="PlatformModeration",r[r.ActiveSupporter=64]="ActiveSupporter",r[r.Paw=128]="Paw",r[r.EarlyAdopter=256]="EarlyAdopter",r[r.ReservedRelevantJokeBadge1=512]="ReservedRelevantJokeBadge1",r[r.ReservedRelevantJokeBadge2=1024]="ReservedRelevantJokeBadge2"})(Be||(Be={}));class tR extends yn{constructor(e){super(Be,e)}has(e){return super.has(e)}all(){return super.all()}}Be.Developer+"",Be.Translator+"",Be.Supporter+"",Be.ResponsibleDisclosure+"",Be.Founder+"",Be.PlatformModeration+"",Be.ActiveSupporter+"",Be.Paw+"",Be.EarlyAdopter+"",Be.ReservedRelevantJokeBadge1+"",Be.ReservedRelevantJokeBadge2+"";var _o;(function(r){r[r.Suspended=1]="Suspended",r[r.Deleted=2]="Deleted",r[r.Banned=4]="Banned"})(_o||(_o={}));class rR extends yn{constructor(e){super(_o,e)}has(e){return super.has(e)}all(){return super.all()}}class Wa extends yn{constructor(e){super(Gt,e)}has(e){return super.has(e)}all(){return super.all()}}class sR{constructor(e){T(this,"parent");this.parent=e}get ownerID(){return this.parent.source.bot.owner}get owner(){return this.parent.client.users.get(this.ownerID)}async fetchOwner(e=!1){return await this.parent.client.users.fetch(this.ownerID,e)}}class nR extends Tt{constructor(e,t){super(e,t)}get username(){return this.source.username}get discriminator(){return this.source.discriminator}get tag(){return`${this.username}#${this.discriminator}`}get displayName(){return this.source.display_name}get bot(){return this.source.bot?new sR(this):null}get online(){return!!this.source.online}get privileged(){return!!this.source.privileged}get badges(){return new tR(this.source.badges||0)}get flags(){return new rR(this.source.flags||0)}get avatar(){return this.source.avatar?new Xe(this.client,this.source.avatar):null}get defaultAvatarURL(){return this.client.users.defaultAvatarURL(this.id)}generateAvatarURL(...e){return e[2]||(e[2]=this.defaultAvatarURL),this.avatar?this.avatar.generateURL(...e):this.defaultAvatarURL}get relationship(){return this.source.relationship}get status(){var e;return((e=this.source.status)==null?void 0:e.text)??null}get presence(){var e;return((e=this.source.status)==null?void 0:e.presence)??null}async addFriend(){this.client.users.construct(await this.client.api.post("/users/friend",{username:this.username}))}async removeFriend(){this.client.users.construct(await this.client.api.delete(`/users/${this._id}/friend`))}async block(){this.client.users.construct(await this.client.api.put(`/users/${this._id}/block`))}async unblock(){this.client.users.construct(await this.client.api.delete(`/users/${this._id}/block`))}async openDM(){let e=this.client.channels.find(t=>t.isDM()&&t.recipientID==this.id);if(!e){const t=await this.client.api.get(`/users/${this._id}/dm`);e=await this.client.channels.fetch(t._id,t)}return e.update({active:!0})}async fetchProfile(){const e=await this.client.api.get(`/users/${this._id}/profile`),t=this.client;return{background:e.background?new Xe(this.client,e.background):null,bio:e.content??null,generateBackgroundURL(...s){return e.background?new Xe(t,e.background).generateURL(...s):null}}}async fetchMutual(){const e=await this.client.api.get(`/users/${this._id}/mutual`);return{friends:e.users,servers:e.servers}}get permissionsAgainst(){let e=0;switch(this.relationship){case At.Friend:case At.Self:return new Wa(US);case At.Blocked:case At.SelfBlocked:return new Wa(Gt.Access);case At.Incoming:case At.Outgoing:e=Gt.Access}return(this.client.channels.find(t=>t.isDM()&&t.recipientID==this.id||t.isGroupDM()&&t.recipientIDs.includes(this.id))||this.client.servers.find(t=>t.members.find(s=>s.id==this.client.user.id)))&&((this.client.user.bot||this.bot)&&(e|=Gt.SendMessage),e|=Gt.Access|Gt.ViewProfile),new Wa(e)}toString(){return`<@${this.id}>`}}class iR extends Qt{constructor(t){super();T(this,"client");this.client=t}get self(){return this.items().find(t=>t.relationship==At.Self)}defaultAvatarURL(t){return`${this.client.options.apiURL}/users/${t}/default_avatar`}construct(t){const s=this.get(t._id);if(s)return s.update(t);{const n=new nR(this.client,t);return this.set(n.id,n),n.onUpdate(()=>this.fireUpdate([n])),n}}async fetch(t,s=!1){if(this.has(t)&&!s)return this.get(t);const n=await this.client.api.get(`/users/${t}`);return this.construct(t=="@me"?{...n,relationship:At.Self}:n)}}class aR extends Tt{get createdAt(){return 0}constructor(e,t){super(e,t)}get type(){return this.source.type}get creator(){return{name:this.source.user_name,avatar:this.source.user_avatar?new Xe(this.client,this.source.user_avatar):null}}get channel(){return{id:this.source.channel_id,name:this.source.channel_name,description:this.source.channel_description??null}}get server(){return this.source.type=="Server"?{id:this.source.server_id,name:this.source.server_name,icon:this.source.server_icon?new Xe(this.client,this.source.server_icon):null,banner:this.source.server_banner?new Xe(this.client,this.source.server_banner):null,members:this.source.member_count}:null}async accept(){return await this.client.acceptInvite(this)}}const oR={delayFirstAttempt:!1,jitter:"none",maxDelay:1/0,numOfAttempts:10,retry:()=>!0,startingDelay:100,timeMultiple:2};function cR(r){const e=Object.assign(Object.assign({},oR),r);return e.numOfAttempts<1&&(e.numOfAttempts=1),e}function lR(r){const e=Math.random()*r;return Math.round(e)}function dR(r){return r}function uR(r){switch(r.jitter){case"full":return lR;case"none":default:return dR}}class Xh{constructor(e){this.options=e,this.attempt=0}apply(){return new Promise(e=>setTimeout(e,this.jitteredDelay))}setAttemptNumber(e){this.attempt=e}get jitteredDelay(){return uR(this.options)(this.delay)}get delay(){const e=this.options.startingDelay,t=this.options.timeMultiple,s=this.numOfDelayedAttempts,n=e*Math.pow(t,s);return Math.min(n,this.options.maxDelay)}get numOfDelayedAttempts(){return this.attempt}}var hR=globalThis&&globalThis.__awaiter||function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{u(s.next(l))}catch(d){a(d)}}function c(l){try{u(s.throw(l))}catch(d){a(d)}}function u(l){l.done?i(l.value):n(l.value).then(o,c)}u((s=s.apply(r,e||[])).next())})};class pR extends Xh{apply(){const e=Object.create(null,{apply:{get:()=>super.apply}});return hR(this,void 0,void 0,function*(){return this.isFirstAttempt?!0:e.apply.call(this)})}get isFirstAttempt(){return this.attempt===0}get numOfDelayedAttempts(){return this.attempt-1}}class fR extends Xh{}function mR(r,e){const t=gR(r);return t.setAttemptNumber(e),t}function gR(r){return r.delayFirstAttempt?new fR(r):new pR(r)}var wo=globalThis&&globalThis.__awaiter||function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{u(s.next(l))}catch(d){a(d)}}function c(l){try{u(s.throw(l))}catch(d){a(d)}}function u(l){l.done?i(l.value):n(l.value).then(o,c)}u((s=s.apply(r,e||[])).next())})};function _R(r,e={}){return wo(this,void 0,void 0,function*(){const t=cR(e);return yield new wR(r,t).execute()})}class wR{constructor(e,t){this.request=e,this.options=t,this.attemptNumber=0}execute(){return wo(this,void 0,void 0,function*(){for(;!this.attemptLimitReached;)try{return yield this.applyDelay(),yield this.request()}catch(e){if(this.attemptNumber++,!(yield this.options.retry(e,this.attemptNumber))||this.attemptLimitReached)throw e}throw new Error("Something went wrong.")})}get attemptLimitReached(){return this.attemptNumber>=this.options.numOfAttempts}applyDelay(){return wo(this,void 0,void 0,function*(){yield mR(this.options,this.attemptNumber).apply()})}}var os=null;typeof WebSocket<"u"?os=WebSocket:typeof MozWebSocket<"u"?os=MozWebSocket:typeof global<"u"?os=global.WebSocket||global.MozWebSocket:typeof window<"u"?os=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(os=self.WebSocket||self.MozWebSocket);const Dr=os;class yR{constructor(e){T(this,"client");T(this,"ws");T(this,"heartbeat");T(this,"connected",!1);T(this,"ready",!1);T(this,"ping");this.client=e}disconnect(){clearInterval(this.heartbeat),this.connected=this.ready=!1,this.ws&&this.ws.readyState===Dr.OPEN&&this.ws.close()}send(e){if(typeof this.ws>"u"||this.ws.readyState!==Dr.OPEN)return;const t=JSON.stringify(e);this.client.options.debug&&console.debug("[<<] Outgoing Packet",t),this.ws.send(t)}connect(e){return this.client.emit("connecting"),new Promise((t,s)=>{let n=!1;const i=d=>{n||(n=!0,s(d))};if(this.disconnect(),!this.client.config)throw new Error("Attempted to open WebSocket without syncing configuration from server.");if(!this.client.session)throw new Error("Attempted to open WebSocket without valid session.");this.ws=new Dr(this.client.config.ws),this.ws.onopen=()=>this.send({type:"Authenticate",token:this.client.session.token});const a=async d=>{var h,p,f,_,g,k,P,D,C;this.client.emit("packet",d);try{switch(d.type){case"Bulk":{for(const y of d.v)await a(y);break}case"Error":{i(d.error);break}case"Authenticated":{e=!1,this.client.emit("connected"),this.connected=!0;break}case"Ready":{if(d.type!=="Ready")throw 0;for(const y of d.users)this.client.users.construct(y);for(const y of d.channels)this.client.channels.construct(y);for(const y of d.servers)this.client.servers.construct(y);for(const y of d.members)(h=this.client.servers.get(y._id.server))==null||h.members.construct(y);if(d.emojis)for(const y of d.emojis)this.client.emojis.construct(y);this.client.emit("ready"),this.ready=!0,t(),this.client.unreads.sync(),this.client.options.heartbeat>0&&(this.send({type:"Ping",data:+new Date}),this.heartbeat=setInterval(()=>{if(this.send({type:"Ping",data:+new Date}),this.client.options.pingTimeout){let y=!1;this.client.once("packet",R=>{R.type=="Pong"&&(y=!0)}),setTimeout(()=>{if(!y){if(this.client.options.exitOnTimeout)throw"Client did not receive a pong in time.";console.warn("Warning: Client did not receive a pong in time. Reconnecting."),this.disconnect(),this.connect(e)}},this.client.options.pingTimeout*1e3)}},this.client.options.heartbeat*1e3));break}case"Message":{if(d.author===ro){if(d.system)switch(d.system.type){case"user_added":case"user_remove":await this.client.users.fetch(d.system.by);break;case"user_joined":await this.client.users.fetch(d.system.id);break;case"channel_description_changed":case"channel_icon_changed":case"channel_renamed":await this.client.users.fetch(d.system.by);break}}else await this.client.users.fetch(d.author);const y=await this.client.channels.fetch(d.channel);if(y.isServerBased()){const Y=await this.client.servers.fetch(y.serverID);d.author!==ro&&await Y.members.fetch(d.author)}const R=y.messages.construct(d);y.isDM()&&y.update({active:!0}),y.update({last_message_id:R.id}),this.client.emit("message",R),R.isUser()&&R.mentionIDs.includes(this.client.user.id)&&this.client.unreads.markMention(R);break}case"MessageUpdate":{const y=this.client.channels.get(d.channel),R=y==null?void 0:y.messages.get(d.id);R&&(R.update(d.data),this.client.emit("messageUpdate",R));break}case"MessageAppend":{const y=this.client.channels.get(d.channel),R=y==null?void 0:y.messages.get(d.id);R!=null&&R.isUser()&&(R.appendEmbed(d.append),this.client.emit("messageUpdate",R));break}case"MessageDelete":{const y=this.client.channels.get(d.channel);if(y){const R=y.messages.get(d.id);y.messages.delete(d.id),this.client.emit("messageDelete",d.id,R)}break}case"MessageReact":{const y=this.client.channels.get(d.channel_id),R=y==null?void 0:y.messages.get(d.id);R&&(R.update({reactions:{...R.source.reactions,[d.emoji_id]:[...new Set([...((p=R.source.reactions)==null?void 0:p[d.emoji_id])||[],d.user_id])]}}),this.client.emit("messageUpdate",R));break}case"MessageUnreact":{const y=this.client.channels.get(d.channel_id),R=y==null?void 0:y.messages.get(d.id);if(R){const Y=(f=R.source.reactions)==null?void 0:f[d.emoji_id];if(Y){const de=new Set(Y);de.delete(d.user_id),de.size?R.update({reactions:{...R.source.reactions,[d.emoji_id]:[...de]}}):(delete R.source.reactions[d.emoji_id],R.update({reactions:R.source.reactions}))}this.client.emit("messageUpdate",R)}break}case"MessageRemoveReaction":{const y=this.client.channels.get(d.channel_id),R=y==null?void 0:y.messages.get(d.id);R&&(delete R.source.reactions[d.emoji_id],R.update({reactions:R.source.reactions}),this.client.emit("messageUpdate",R));break}case"BulkMessageDelete":{const y=this.client.channels.get(d.channel);if(y)for(const R of d.ids){const Y=y.messages.get(R);y.messages.delete(R),this.client.emit("messageDelete",R,Y)}break}case"ChannelCreate":{if(d.channel_type==="TextChannel"||d.channel_type==="VoiceChannel"){const y=await this.client.servers.fetch(d.server);y.update({channels:[...y.source.channels||[],d._id]})}this.client.emit("channelCreate",this.client.channels.construct(d));break}case"ChannelUpdate":{const y=this.client.channels.get(d.id);y&&((_=d.clear)==null||_.forEach(R=>delete y.source[R]),this.client.emit("channelUpdate",y.update(d.data)));break}case"ChannelDelete":{const y=this.client.channels.get(d.id);this.client.channels.delete(d.id),this.client.emit("channelDelete",d.id,y);break}case"ChannelGroupJoin":{const y=this.client.channels.get(d.id);if(y!=null&&y.isGroupDM()){const R=await this.client.users.fetch(d.user);if(R){const Y=new Set(y.source.recipients);Y.add(d.user),y.update({recipients:[...Y]}),this.client.emit("groupMemberJoin",y,R)}}break}case"ChannelGroupLeave":{const y=this.client.channels.get(d.id);if(y!=null&&y.isGroupDM())if(d.user===this.client.user.id)this.client.channels.delete(y.id),this.client.emit("groupExited",y);else{const R=await this.client.users.fetch(d.user);if(R){const Y=new Set(y.source.recipients);Y.delete(d.user),y.update({recipients:[...Y]}),this.client.emit("groupMemberLeave",y,R)}}break}case"ServerCreate":{for(const y of d.channels)await this.client.channels.fetch(y._id,y);this.client.emit("serverCreate",await this.client.servers.fetch(d.id,d.server));break}case"ServerUpdate":{const y=await this.client.servers.fetch(d.id);y&&((g=d.clear)==null||g.forEach(R=>delete y.source[R]),this.client.emit("serverUpdate",y.update(d.data)));break}case"ServerDelete":{const y=this.client.servers.get(d.id);this.client.servers.delete(d.id),this.client.emit("serverExited",d.id,y);break}case"ServerMemberJoin":{const y=await this.client.servers.fetch(d.id);await this.client.users.fetch(d.user),this.client.emit("serverMemberJoin",y.members.construct({_id:{server:d.id,user:d.user},joined_at:new Date().toISOString()}));break}case"ServerMemberLeave":{const y=this.client.servers.get(d.id);d.user==this.client.user.id?(this.client.servers.delete(d.id),this.client.emit("serverExited",d.id,y)):(y.members.delete(d.id),this.client.emit("serverMemberLeave",y,await this.client.users.fetch(d.id)));break}case"ServerMemberUpdate":{const y=await this.client.servers.fetch(d.id.server),R=y.members.get(d.id.user);R&&((k=d.clear)==null||k.forEach(Y=>delete R.source[Y]),this.client.emit("serverMemberUpdate",R.update(d.data)));break}case"ServerRoleUpdate":{const y=await this.client.servers.fetch(d.id);if(y){const R=!y.roles.get(d.role_id);y.update({roles:{...y.source.roles,[d.role_id]:{...(P=y.source.roles)==null?void 0:P[d.role_id],...d.data}}}),this.client.emit(R?"serverRoleCreate":"serverRoleUpdate",y.roles.get(d.role_id))}break}case"ServerRoleDelete":{const y=await this.client.servers.fetch(d.id);if(y){const R=y.roles.get(d.role_id);R&&((D=y.source.roles)==null||delete D[d.role_id],y.update({roles:y.source.roles}),this.client.emit("serverRoleDelete",R))}break}case"UserUpdate":{const y=this.client.users.get(d.id);y&&((C=d.clear)==null||C.forEach(R=>delete y.source[R]),y.update(d.data),this.client.emit("userUpdate",y));break}case"UserRelationship":{const y=this.client.users.get(d.user._id);y?(y.update({...d.user,relationship:d.status}),this.client.emit("userRelationshipUpdate",y)):this.client.emit("userRelationshipUpdate",this.client.users.construct(d.user));break}case"EmojiCreate":{this.client.emit("emojiCreate",this.client.emojis.construct(d));break}case"EmojiDelete":{const y=this.client.emojis.get(d.id);this.client.emojis.delete(d.id),this.client.emit("emojiDelete",d.id,y);break}case"ChannelAck":{const y=this.client.channels.get(d.id);y&&this.client.unreads.markRead(y,d.message_id,!1);break}case"ChannelStartTyping":{const y=this.client.channels.get(d.id),R=await this.client.users.fetch(d.user);y&&R&&(y.typingIDs.add(R.id),clearTimeout(o[y.id+R.id]),o[y.id+R.id]=setTimeout(()=>{y.typingIDs.delete(R.id)},3e3),this.client.emit("channelStartTyping",y,R));break}case"ChannelStopTyping":{const y=this.client.channels.get(d.id),R=await this.client.users.fetch(d.user);y&&R&&(y.typingIDs.delete(R.id),clearTimeout(o[y.id+R.id]),this.client.emit("channelStopTyping",y,R));break}case"Pong":{this.ping=+new Date-d.data;break}default:this.client.options.debug&&console.warn(`Warning: Unhandled packet! ${d.type}`)}}catch(y){console.error(y)}},o={},c=async d=>{const h=d.data;if(typeof h!="string")return;this.client.options.debug&&console.debug("[>>] Incoming Packet",h);const p=JSON.parse(h);await a(p)};let u=!1;const l=[];this.ws.onmessage=async d=>{if(l.push(d),!u){for(u=!0;l.length>0;)await c(l.shift());u=!1}},this.ws.onerror=d=>i(d),this.ws.onclose=()=>{this.client.emit("disconnected"),this.connected=!1,this.ready=!1,Object.keys(o).map(d=>o[d]).forEach(clearTimeout),this.client.users.forEach(d=>d.update({online:!1})),this.client.channels.forEach(d=>(d.typingIDs.clear(),d.update())),!e&&this.client.options.reconnect&&_R(()=>this.connect(!0)).catch(i)}})}}const bR={apiURL:"https://api.revolt.chat",debug:!1,heartbeat:30,reconnect:!0};class Ja extends Xs{constructor(t){super();T(this,"api");T(this,"options");T(this,"config");T(this,"session");T(this,"ws");T(this,"channels");T(this,"emojis");T(this,"servers");T(this,"unreads");T(this,"users");this.options={...bR,...t},this.setup(),this.api=new Ol({baseURL:this.options.apiURL}),this.ws=new yR(this)}get user(){return this.users.self}async uploadAttachment(t,s,n="attachments"){var o,c;if(await this.fetchConfiguration(),!this.config.features.autumn.enabled)throw"Autumn is not enabled!";const i=new kb;return i.append("file",s,t),(c=(await Un.post(`${this.config.features.autumn.url}/${n}`,i,{headers:((o=i.getHeaders)==null?void 0:o.call(i))||{},data:i})).data)==null?void 0:c.id}proxyFile(t){var s;return(s=this.config)!=null&&s.features.january.enabled?`${this.config.features.january.url}/proxy?url=${encodeURIComponent(t)}`:null}async createServer(t){const{server:s,channels:n}=await this.api.post("/servers/create",t);return await this.servers.fetch(s._id,s,n)}async createGroup(t){const s=await this.api.post("/channels/create",t);return await this.channels.fetch(s._id,s)}async editUser(t){return this.user.update(await this.api.patch("/users/@me",t))}async changeUsername(t){return this.user.update(await this.api.patch("/users/@me/username",t))}async fetchInvite(t){const s=await this.api.get(`/invites/${t}`);return new aR(this,{_id:s.code,...s})}async acceptInvite(t){if(typeof t!="string")switch(t.type){case"Group":{const n=this.channels.get(t.channel.id);if(n!=null&&n.isGroupDM())return n;break}case"Server":{const n=this.servers.get(t.server.id);if(n)return n}}const s=await this.api.post(`/invites/${typeof t=="string"?t:t.id}`);return s.type==="Server"?await this.servers.fetch(s.server._id,s.server,s.channels):null}async login(t,s,n=!0,i){this.session={token:t,type:s,id:(i==null?void 0:i.id)||Zs(),name:(i==null?void 0:i.name)||""},this.api=new Ol({baseURL:this.options.apiURL,authentication:{revolt:s=="user"?{token:t}:t}}),await this.fetchConfiguration(),n&&await this.ws.connect()}async authenticate(t){await this.fetchConfiguration();const s=this,n=await this.api.post("/auth/session/login",t);if(n.result==="Success"){await this.login(n.token,"user",!1);const{onboarding:i}=await this.api.get("/onboard/hello");return i?{type:"onboard",async respond(a,o=!0){await s.api.post("/onboard/complete",{username:a}),o&&await s.login(n.token,"user",!0,{name:n.name,id:n._id})}}:(await this.login(n.token,"user",!0,{name:n.name,id:n._id}),{type:"none"})}else if(n.result=="MFA")return{type:"mfa",ticket:n.ticket,methods:n.allowed_methods,async respond(i){return await s.authenticate({mfa_ticket:n.ticket,mfa_response:{totp_code:i},friendly_name:t.friendly_name})}}}get mfa(){const t=this;function s(i){return{headers:{"X-MFA-Ticket":i}}}const n={async status(){return{hasRecovery:(await t.api.get("/auth/mfa/")).recovery_active}},async allowedMethods(){return await t.api.get("/auth/mfa/methods")},async generateTicket(i){const a=await t.api.put("/auth/mfa/ticket",i);return{id:a._id,accountID:a.account_id,token:a.token,validated:a.validated,authorized:!!a.authorised,lastTOTPCode:a.last_totp_code??null}},async generateTOTPSecret(i){return(await t.api.post("/auth/mfa/totp",void 0,s(i))).secret},async enableTOTP(i,a){return await t.api.put("/auth/mfa/totp",{totp_code:a},s(i))},async disableTOTP(i){await t.api.delete("/auth/mfa/totp",{},s(i))},async fetchRecoveryCodes(i){return(await n.status()).hasRecovery?await t.api.post("/auth/mfa/recovery",void 0,s(i)):await n.generateRecoveryCodes(i)},async generateRecoveryCodes(i){return await t.api.patch("/auth/mfa/recovery",void 0,s(i))}};return n}async syncFetchSettings(t){return await this.api.post("/sync/settings/fetch",{keys:t})}async syncSetSettings(t,s){const n={};for(const i of Object.keys(t)){const a=t[i];n[i]=typeof a=="string"?a:JSON.stringify(a)}await this.api.post("/sync/settings/set",{...n,timestamp:s})}async fetchConfiguration(t=!1){(!this.config||t)&&(this.config=await this.api.get("/"))}async fetchAutumnConfiguration(){return await this.fetchConfiguration(),this.config.features.autumn.enabled?(await Un.get(this.config.features.autumn.url)).data:null}async fetchJanuaryConfiguration(){return await this.fetchConfiguration(),this.config.features.january.enabled?(await Un.get(this.config.features.january.url)).data:null}async fetchVortexConfiguration(){return await this.fetchConfiguration(),this.config.features.voso.enabled?(await Un.get(this.config.features.voso.url)).data:null}setup(){this.channels=new ZS(this),this.emojis=new XS(this),this.servers=new eR(this),this.unreads=new qh(this),this.users=new iR(this)}async destroy(t=!1){this.emit("destroyed"),t&&await this.api.post("/auth/session/logout"),this.ws.disconnect(),delete this.session,this.setup()}on(t,s,n){return super.on(t,s,n)}once(t,s,n){return super.once(t,s,n)}}var Gs;(function(r){r[r.CHANNEL=0]="CHANNEL",r[r.EMOJI=1]="EMOJI",r[r.USER=2]="USER"})(Gs||(Gs={}));Gs.CHANNEL,Gs.EMOJI,Gs.USER;var Sd;(function(r){r["01:37"]="t",r["01:37:42"]="T",r["22 September 2022"]="D",r["22 September 2022 01:37"]="f",r["Thursday, 22 September 2022 01:37"]="F",r["in 9 months"]="R"})(Sd||(Sd={}));var ls;(function(r){r.UserJoined="UserJoined",r.UserLeft="UserLeft",r.UserStartProduce="UserStartProduce",r.UserStopProduce="UserStopProduce"})(ls||(ls={}));var wt;(function(r){r.Authenticate="Authenticate",r.RoomInfo="RoomInfo",r.InitializeTransports="InitializeTransports",r.ConnectTransport="ConnectTransport",r.StartProduce="StartProduce",r.StopProduce="StopProduce",r.StartConsume="StartConsume",r.StopConsume="StopConsume",r.SetConsumerPause="SetConsumerPause"})(wt||(wt={}));var yo;(function(r){r[r.NotConnected=0]="NotConnected",r[r.NotFound=404]="NotFound",r[r.TransportConnectionFailure=601]="TransportConnectionFailure",r[r.ProducerFailure=611]="ProducerFailure",r[r.ProducerNotFound=614]="ProducerNotFound",r[r.ConsumerFailure=621]="ConsumerFailure",r[r.ConsumerNotFound=624]="ConsumerNotFound"})(yo||(yo={}));var Rd;(function(r){r[r.InvalidData=1003]="InvalidData",r[r.Unauthorized=4001]="Unauthorized",r[r.RoomClosed=4004]="RoomClosed",r[r.InvalidState=1002]="InvalidState",r[r.ServerError=1011]="ServerError"})(Rd||(Rd={}));var qe;(function(r){r[r.UNAVAILABLE=0]="UNAVAILABLE",r[r.UNLOADED=1]="UNLOADED",r[r.LOADING=2]="LOADING",r[r.READY=3]="READY",r[r.CONNECTING=4]="CONNECTING",r[r.AUTHENTICATING=5]="AUTHENTICATING",r[r.RTC_CONNECTING=6]="RTC_CONNECTING",r[r.CONNECTED=7]="CONNECTED"})(qe||(qe={}));class vR extends Xs{constructor(){super();T(this,"ws",null);T(this,"index",0);T(this,"pending",new Map)}get connected(){return!!this.ws&&this.ws.readyState!==Dr.CLOSING&&this.ws.readyState!==Dr.CLOSED}connect(t){this.disconnect(),this.ws=new Dr(t),this.ws.onopen=n=>this.emit("open",n),this.ws.onclose=n=>this.emit("close",n),this.ws.onerror=n=>this.emit("error",n),this.ws.onmessage=n=>this.parseData(n);let s=!1;return new Promise((n,i)=>{this.once("open",()=>{s||(s=!0,n())}),this.once("error",()=>{s||(s=!0,i())})})}disconnect(){var t;this.connected&&((t=this.ws)==null||t.close(1e3))}parseData(t){if(typeof t.data!="string")return;const s=JSON.parse(t.data),n=this.pending.get(s.id);if(n===void 0){this.emit("data",s);return}n(s)}sendRequest(t,s){if(!this.ws||this.ws.readyState!==Dr.OPEN)return Promise.reject({error:yo.NotConnected});const n=this.ws;return new Promise((i,a)=>{for(this.index>=2**32&&(this.index=0);this.pending.has(this.index);)this.index++;const o=l=>{a({error:l.code,message:l.reason})},c=l=>{this.removeListener("close",o),l.error&&a({error:l.error,message:l.message,data:l.data}),i(l.data)};this.pending.set(this.index,c),this.once("close",o);const u={id:this.index,type:t,data:s};n.send(`${JSON.stringify(u)}
`),this.index++})}authenticate(t,s){return this.sendRequest(wt.Authenticate,{token:t,roomId:s})}async roomInfo(){const t=await this.sendRequest(wt.RoomInfo);return{id:t.id,videoAllowed:t.videoAllowed,users:t.users}}initializeTransports(t){return this.sendRequest(wt.InitializeTransports,{mode:"SplitWebRTC",rtpCapabilities:t})}connectTransport(t,s){return this.sendRequest(wt.ConnectTransport,{id:t,dtlsParameters:s})}async startProduce(t,s){return(await this.sendRequest(wt.StartProduce,{type:t,rtpParameters:s})).producerId}stopProduce(t){return this.sendRequest(wt.StopProduce,{type:t})}startConsume(t,s){return this.sendRequest(wt.StartConsume,{type:s,userId:t})}stopConsume(t){return this.sendRequest(wt.StopConsume,{id:t})}setConsumerPause(t,s){return this.sendRequest(wt.SetConsumerPause,{id:t,paused:s})}}let SR=class extends Xs{constructor(t,s,n,i,a){super();T(this,"platform");T(this,"msc");T(this,"createDevice");T(this,"consumeTrack");T(this,"supported",!1);T(this,"device");T(this,"signaling",new vR);T(this,"sendTransport",null);T(this,"recvTransport",null);T(this,"consumers",new Map);T(this,"audioProducer");T(this,"_deafened",!1);T(this,"participants",new tc);T(this,"status",qe.UNLOADED);T(this,"sessionDetails",null);T(this,"client",new Ja);T(this,"channelID",null);this.platform=t,this.msc=n,this.createDevice=i,this.consumeTrack=a,this.supported=this.msc.detectDevice()!==void 0,s instanceof Ja?this.client=s:(this.client=new Ja(s.apiURL?{apiURL:s.apiURL}:void 0),this.sessionDetails={token:s.token,type:s.type}),this.signaling.on("data",async({type:o,data:c})=>{switch(o){case ls.UserJoined:{const u=await this.client.users.fetch(c.id);if(u){const l={user:u,audio:!1};this.participants.set(c.id,l),this.participants.fireUpdate([l]),this.emit("userJoined",l)}else this.emit("error",new Error(`Invalid voice channel participant: ${c.id}`));break}case ls.UserLeft:{const u=this.participants.get(c.id);if(!u)return;this.participants.delete(c.id),this.participants.fireUpdate([u]),this.recvTransport&&this.stopConsume(c.id),this.emit("userLeft",u);break}case ls.UserStartProduce:{const u=this.participants.get(c.id);if(!u||u.user.id==this.client.user.id||!c.type)return;c.type in u&&(u[c.type]=!0),this.participants.fireUpdate([u]),this.recvTransport&&await this.startConsume(c.id,c.type),this.emit("userStartProduce",u,c.type);break}case ls.UserStopProduce:{const u=this.participants.get(c.id);if(!u||!c.type)return;c.type in u&&(u[c.type]=!1),this.participants.fireUpdate([u]),this.recvTransport&&this.stopConsume(c.id,c.type),this.emit("userStopProduce",u,c.type);break}}},this),this.signaling.on("error",()=>{this.emit("error",new Error("Signaling error"))},this),this.signaling.on("close",o=>{this.disconnectTransport({error:o.code,message:o.reason},!0)},this),this.supported?this.setStatus(qe.READY):this.setStatus(qe.UNAVAILABLE)}get deafened(){return this._deafened}get connected(){return this.status==qe.CONNECTED&&!!this.channelID}get channel(){return this.channelID?this.client.channels.get(this.channelID):void 0}throwIfUnsupported(){if(!this.supported)throw new this.msc.types.UnsupportedError("RTC not supported")}connectTransport(t,s){return this.throwIfUnsupported(),this.device=this.createDevice(),this.channelID=s,this.signaling.connect(t)}disconnectTransport(t,s=!1){!this.signaling.connected&&!s||(this.signaling.disconnect(),this.participants.clear(),this.participants.fireUpdate([]),this.consumers.clear(),this.channelID=null,this.audioProducer=void 0,this.sendTransport&&this.sendTransport.close(),this.recvTransport&&this.recvTransport.close(),this.sendTransport=null,this.recvTransport=null,this.emit("close",t))}async authenticate(t){var i;if(this.throwIfUnsupported(),!this.device||!this.channelID)throw new ReferenceError("Voice client is in an invalid state");const s=await this.signaling.authenticate(t,this.channelID),[n]=await Promise.all([this.signaling.roomInfo(),this.device.load({routerRtpCapabilities:s.rtpCapabilities})]);s.userId!==((i=this.client.user)==null?void 0:i.id)&&this.emit("error",new Error("Authenticated user ID does not match client user ID.")),await Promise.all(Object.entries(n.users).map(async([a,o])=>{const c=await this.client.users.fetch(a);c?this.participants.set(a,{user:c,audio:!!o.audio}):this.emit("error",new Error(`Invalid voice user: ${a}`))})),this.participants.fireUpdate([...this.participants.values()])}async initializeTransports(){if(this.throwIfUnsupported(),!this.device)throw new ReferenceError("Voice client is in an invalid state");const t=await this.signaling.initializeTransports(this.device.rtpCapabilities);this.sendTransport=this.device.createSendTransport(t.sendTransport),this.recvTransport=this.device.createRecvTransport(t.recvTransport);const s=n=>{n.on("connect",({dtlsParameters:i},a,o)=>{this.signaling.connectTransport(n.id,i).then(a).catch(o)})};s(this.sendTransport),s(this.recvTransport),this.sendTransport.on("produce",(n,i,a)=>{const o=n.appData.type;if(n.kind==="audio"&&o!=="audio"&&o!=="saudio")return a==null?void 0:a(new Error("err"));if(n.kind==="video"&&o!=="video"&&o!=="svideo")return a==null?void 0:a(new Error("err"));this.signaling.startProduce(o,n.rtpParameters).then(c=>i({id:c})).catch(a)}),this.emit("ready"),this.participants.forEach(async n=>{n.audio&&n.user.id!==this.client.user.id&&(await this.startConsume(n.user.id,"audio"),this.emit("userStartProduce",n,"audio"))})}async startConsume(t,s){if(!this.consumeTrack)return;if(!this.recvTransport)throw new Error("Receive transport undefined");const n=this.consumers.get(t)||{},i=await this.signaling.startConsume(t,s),a=await this.recvTransport.consume(i);switch(s){case"audio":this.deafened&&a.pause(),n.audio={consumer:a,callback:this.consumeTrack(s,a.track)}}await this.signaling.setConsumerPause(a.id,!1),this.consumers.set(t,n)}async stopConsume(t,s){const n=this.consumers.get(t);if(n)if(!s)n.audio&&(n.audio.consumer.close(),n.audio.callback()),this.consumers.delete(t);else{switch(s){case"audio":{n.audio&&(n.audio.consumer.close(),n.audio.callback(),this.signaling.stopConsume(n.audio.consumer.id)),n.audio=void 0;break}}this.consumers.set(t,n)}}async startProduce(t,s){if(!this.sendTransport)throw new Error("Send transport undefined");const n=await this.sendTransport.produce({track:s,appData:{type:t}});switch(t){case"audio":this.audioProducer=n;break}const i=this.participants.get(this.client.user.id);i&&(i[t]=!0,this.participants.set(this.client.user.id,i),this.participants.fireUpdate([i])),this.emit("startProduce",t)}async stopProduce(t){let s;switch(t){case"audio":s=this.audioProducer,this.audioProducer=void 0;break}s&&!s.closed&&(s.close(),this.emit("stopProduce",t));const n=this.participants.get(this.client.user.id);n&&(n[t]=!1,this.participants.set(this.client.user.id,n),this.participants.fireUpdate([n]));try{await this.signaling.stopProduce(t)}catch(i){if(i.error==="ProducerNotFound")return;this.emit("error",i)}}setStatus(t){this.status=t,this.emit("status",t)}async connect(t){var i,a;this.client.session||this.sessionDetails&&(await this.client.login(this.sessionDetails.token,this.sessionDetails.type,!1),await this.client.users.fetch("@me"));const s=typeof t=="string"?await this.client.channels.fetch(t):t;if(this.status>qe.READY)return;if(!this.supported)throw new Error("RTC is unavailable.");if(!s.isVoice()&&!s.isDMBased())throw new Error("Not a voice or (Group) DM channel.");if(await this.client.fetchConfiguration(),!((a=(i=this.client.config)==null?void 0:i.features.voso)!=null&&a.enabled?this.client.config.features.voso.ws:null))throw this.setStatus(qe.UNAVAILABLE),new Error("Vortex is not enabled on target server.");this.setStatus(qe.CONNECTING);try{const o=await s.joinCall();await this.connectTransport(s.client.config.features.voso.ws,s.id),this.setStatus(qe.AUTHENTICATING),await this.authenticate(o),this.setStatus(qe.RTC_CONNECTING),await this.initializeTransports()}catch(o){return this.emit("error",o instanceof Error?o:new Error(String(o))),this.setStatus(qe.READY),this}return this.setStatus(qe.CONNECTED),this.emit("connected"),this}disconnect(){this.disconnectTransport(),this.setStatus(qe.READY)}isProducing(t){switch(t){case"audio":return!!this.audioProducer;default:return!1}}async startDeafen(){this.deafened||(this._deafened=!0,this.consumers.forEach(t=>{var s;(s=t.audio)==null||s.consumer.pause()}),this.emit("selfDeafenUpdate",!0))}async stopDeafen(){this.deafened&&(this._deafened=!1,this.consumers.forEach(t=>{var s;(s=t.audio)==null||s.consumer.resume()}),this.emit("selfDeafenUpdate",!1))}};const RR=(r,e)=>{if(r=="audio"){const t=new MediaStream([e]),s=new Audio;return s.srcObject=t,s.load(),s.play(),()=>s.pause()}return()=>{}};class TR extends SR{constructor(e,t){super("browser",e,cw,()=>new ui.Device,t)}async play(e,t){switch(e){case"audio":{if(this.audioProducer)throw"Already producing audio.";try{if(!(t instanceof MediaStreamTrack)){if(navigator.mediaDevices===void 0)throw"No media devices.";t=(await navigator.mediaDevices.getUserMedia({audio:t?{deviceId:t}:!0})).getAudioTracks()[0]}await this.startProduce("audio",t)}catch(s){throw"WebRTC Error: "+s}break}}}}function CR(r){return{c:ze,l:ze,m:ze,p:ze,i:ze,o:ze,d:ze}}function DR(r){let e;const t=r[5].default,s=cf(t,r,r[4],null);return{c(){s&&s.c()},l(n){s&&s.l(n)},m(n,i){s&&s.m(n,i),e=!0},p(n,i){s&&s.p&&(!e||i&16)&&lf(s,t,n,n[4],e?uf(t,n[4],i,null):df(n[4]),null)},i(n){e||(Dd(s,n),e=!0)},o(n){Ed(s,n),e=!1},d(n){s&&s.d(n)}}}function ER(r){return{c:ze,l:ze,m:ze,p:ze,i:ze,o:ze,d:ze}}function kR(r){let e,t,s={ctx:r,current:null,token:null,hasCatch:!1,pending:ER,then:DR,catch:CR,blocks:[,,,]};return hf(Rf(),s),{c(){e=wc(),s.block.c()},l(n){e=wc(),s.block.l(n)},m(n,i){af(n,e,i),s.block.m(n,s.anchor=i),s.mount=()=>e.parentNode,s.anchor=e,t=!0},p(n,[i]){r=n,pf(s,r,i)},i(n){t||(Dd(s.block),t=!0)},o(n){for(let i=0;i<3;i+=1){const a=s.blocks[i];Ed(a)}t=!1},d(n){n&&of(e),s.block.d(n),s.token=null,s=null}}}function OR(r,e,t){let s,n,{$$slots:i={},$$scope:a}=e;const o=na(wf);En(yf,o);const c=na(JSON.parse(localStorage.getItem("session")||"null"));yc(r,c,d=>t(2,s=d)),En(bf,c);const u=new Mf;En(vf,u);const l=na();return yc(r,l,d=>t(3,n=d)),En(Sf,l),r.$$set=d=>{"$$scope"in d&&t(4,a=d.$$scope)},r.$$.update=()=>{if(r.$$.dirty&12)if(s==null)u.websocket.disconnect(),n==null||n.disconnect(),l.set(null);else{const{token:d}=s;u.authenticate(d),l.set(new TR({token:d,type:"user"},RR))}r.$$.dirty&4&&s==null&&kd(`${Od}/login`)},[c,l,s,n,a,i]}class JR extends ff{constructor(e){super(),mf(this,e,OR,kR,nf,{})}}export{JR as component,VR as universal};
